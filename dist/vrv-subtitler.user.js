// ==UserScript==
// @name         VRV Subtitler
// @namespace    http://tampermonkey.net/
// @version      0.1.12
// @description  Display SRT format subtitles on VRV
// @author       sheodox
// @match        https://static.vrv.co/vilos/player.html
// @grant        GM_getValue
// @grant        GM_setValue
// ==/UserScript==

!function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){t.exports=class{constructor(t){this.format=t,this.subs=[]}getSubs(t){return this.subs.filter(e=>e.start<=t&&e.end>=t)}timeToMs(t){const[e,n,s]=t.split(":");return 36e5*+e+6e4*+n+1e3*parseFloat(s)}firstSubtitle(){return this.subs.reduce((t,e)=>e.start<t.start?e:t,{start:1/0})}}},function(t,e,n){const s=n(0),r=t=>(t.charAt(0).toLowerCase()+t.substring(1)).replace(" ",""),o=t=>{if(t){t=(t=t.replace(/[&H]/g,"")).padStart(8,"0");const[e,n,s,r,o]=t.match(/([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i),i=t=>parseInt(t,16);return`rgba(${i(o)}, ${i(r)}, ${i(s)}, ${255-i(n)})`}},i=(t,e,n="transparent",s=0)=>{const r=t||n,o=`${void 0===e?1:e}px`;return`text-shadow: ${r} ${o} ${o}, ${r} ${o} -${o}, ${r} -${o} ${o}, ${r} -${o} -${o}, ${r} ${o} 0, ${r} 0 ${o}, ${r} -${o} 0, ${r} 0 -${o}, ${s}px ${s}px ${n}`};function l(t,e,n=!1){const s=new RegExp(n?`\\\\${e}\\((.*?)\\)`:`\\\\${e}([^\\\\}]*)`),r=t.match(s);if(r)return{overrides:t.replace(r[0],""),params:n?r[1].split(","):r[1]}}t.exports=class extends s{constructor(t){super("ass"),t=t.replace(/\r\n/g,"\n");try{this.blocks=this.parseBlocks(t),this.subs=this.parseBlock(this.blocks.subs),this.parseInfo(this.blocks.info),this.parseSubTimings(),this.parseStyles(this.parseBlock(this.blocks.styles)),this.parseSubOverrideTags()}catch(t){console.error("ASS PARSE ERROR",t),this.subs=[]}}parseInfo(){this.info={},this.blocks.info.split("\n").forEach(t=>{const[e,n]=t.split(": ");this.info[r(e)]=n})}parseBlocks(t){const e=t.split(/\n(?=\[)/),n=t=>e.find(e=>{e=e.trim();const[n,s]=e.match(/^\[(.*?)]/);return s===t}).replace(/.*\n/,"").trim();return{info:n("Script Info"),styles:n("V4+ Styles"),subs:n("Events")}}parseBlock(t){const[e,...n]=t.split("\n"),s=(t,e=1/0)=>{let[n,s,r]=t.match(/(\w*): (.*)/);return r=r.split(","),r.length>e&&(r[e-1]=r.slice(e-1).join(","),r.splice(e,1/0)),{type:s,attributes:r}},o=s(e);return n.reduce((t,e)=>{if(!e||";"===e.charAt(0)||0===e.indexOf("Comment: "))return t;const n=s(e,o.attributes.length),i={dataType:n.type.toLowerCase()};return o.attributes.forEach((t,e)=>{t=t.trim();const s=r(t);i[s]=n.attributes[e]}),i.style="*Default"===i.style?"Default":i.style,t.push(i),t},[])}parseSubTimings(){this.subs.forEach(t=>{t.start=this.timeToMs(t.start),t.end=this.timeToMs(t.end)})}parseStyles(t){const e={};t.forEach(t=>{for(const e of Object.keys(t).filter(t=>/colour/i.test(t)))t[e]=o(t[e]);t.name="*Default"===t.name?"Default":t.name;const n=[],{primaryColour:s,secondaryColour:r,outlineColour:l,backColour:a,borderStyle:c,outline:u,shadow:d,fontname:f,fontsize:p,bold:h,italic:m,underline:v,strikeOut:b}=t;s&&n.push(`color: ${s}`),f&&n.push(`font-family: "${f}"`),p&&n.push(`font-size: ${p}pt`),"1"===c?n.push(i(l,u,a,d)):"3"===c&&n.push(`background-color: ${a}`),"-1"===h&&n.push("font-weight: bold"),"-1"===m&&n.push("font-style: italic"),"-1"!==v&&"-1"!==b||n.push(`text-decoration: ${"-1"===v?"underline":""} ${"-1"===b?"line-through":""}`),e[t.name]={inline:n.join(";"),raw:t}}),this.styles=e}parseSubOverrideTags(){this.subs.forEach(t=>{if(t.rawText=t.text,t.text=t.text.replace("\\N","\n"),!/{.+?}/.test(t.text))return;const e=t=>t.replace(/{.*?}/g,"");t.styledText=[];const n=function*(t){const e=/({.*?}[^{]*)/g;let n;for(;null!==(n=e.exec(t));)yield n[1]}(t.text);let s=[];for(const a of n){const n=[],c={text:e(a),fadeIn:0,fadeOut:0,inline:""};let u,d,f,p,[h]=a.match(/{.*?}/);function r(t,e=!1,n=(()=>{})){const s=l(h,t,e);s&&(n(s.params),h=s.overrides)}if(r("fscx"),r("fscy"),r("blur"),r("shad"),r("pos",!0,([t,e])=>{t=+t/+this.info.playResX*100,e=+e/+this.info.playResY*100,n.push(`position: fixed; left: ${t}vw; top: ${e}vh`)}),r("fad",!0,([e,n])=>{c.fadeIn=e,c.fadeOut=n,t.end-=n}),r("fsp",!1,t=>{s.push(`letter-spacing: ${t}px`)}),r("fs",!1,t=>{s.push(`font-size: ${t}pt`)}),r("u",!1,t=>{s.push(`text-decoration: ${t?"underline":"none"}`)}),r("s",!1,t=>{s.push(`text-decoration: ${t?"line-through":"none"}`)}),r("b",!1,t=>{s.push(`font-weight: ${t?"bold":"normal"}`)}),r("i",!1,t=>{s.push(`font-style: ${t?"italic":"normal"}`)}),r("fn",!1,t=>{s.push(`font-family: "${t}"`)}),r("1c",!1,t=>{s.push(`color: ${o(t)}`)}),r("3c",!1,t=>{u=t}),r("4c",!1,t=>{d=t}),r("bord",!1,t=>{f=t}),r("shad",!1,t=>{p=t}),[u,d,f,p].some(t=>void 0!==t)){const e=this.styles[t.style],n=(t,n)=>void 0!==t?t:e.raw[n];e&&(u=n(o(u),"outlineColour"),d=n(o(d),"backColour"),f=n(f,"outline"),p=n(p,"shadow"),s.push(i(u,f,d,p)))}r("r",!1,t=>{s=t?[this.styles[t].inline]:[]}),c.inline=s.join(";"),t.styledText.push(c),n.length&&(t.inline=n.join(";"))}t.text=e(t.text)})}}},function(t,e,n){"use strict";function s(){}n.r(e);const r=t=>t;function o(t){return t()}function i(){return Object.create(null)}function l(t){t.forEach(o)}function a(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}const u="undefined"!=typeof window;let d=u?()=>window.performance.now():()=>Date.now(),f=u?t=>requestAnimationFrame(t):s;const p=new Set;function h(t){p.forEach(e=>{e.c(t)||(p.delete(e),e.f())}),0!==p.size&&f(h)}function m(t){let e;return 0===p.size&&f(h),{promise:new Promise(n=>{p.add(e={c:t,f:n})}),abort(){p.delete(e)}}}function v(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function g(t){t.parentNode.removeChild(t)}function y(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function $(t){return document.createElement(t)}function x(t){return document.createTextNode(t)}function w(){return x(" ")}function k(){return x("")}function S(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function C(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function E(t,e){e=""+e,t.data!==e&&(t.data=e)}function _(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let T,j,O=0,P={};function R(t,e,n,s,r,o,i,l=0){const a=16.666/s;let c="{\n";for(let t=0;t<=1;t+=a){const s=e+(n-e)*o(t);c+=100*t+`%{${i(s,1-s)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${l}`;if(!P[d]){if(!T){const t=$("style");document.head.appendChild(t),T=t.sheet}P[d]=!0,T.insertRule(`@keyframes ${d} ${u}`,T.cssRules.length)}const f=t.style.animation||"";return t.style.animation=`${f?`${f}, `:""}${d} ${s}ms linear ${r}ms 1 both`,O+=1,d}function M(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--O&&f(()=>{if(O)return;let t=T.cssRules.length;for(;t--;)T.deleteRule(t);P={}})}function A(t){j=t}function I(){if(!j)throw new Error("Function called outside component initialization");return j}function q(){const t=I();return(e,n)=>{const s=t.$$.callbacks[e];if(s){const r=_(e,n);s.slice().forEach(e=>{e.call(t,r)})}}}const B=[],z=[],F=[],N=[],L=Promise.resolve();let V=!1;function D(){V||(V=!0,L.then(J))}function H(t){F.push(t)}let U=!1;const G=new Set;function J(){if(!U){U=!0;do{for(let t=0;t<B.length;t+=1){const e=B[t];A(e),Y(e.$$)}for(B.length=0;z.length;)z.pop()();for(let t=0;t<F.length;t+=1){const e=F[t];G.has(e)||(G.add(e),e())}F.length=0}while(B.length);for(;N.length;)N.pop()();V=!1,U=!1,G.clear()}}function Y(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(H)}}let X;function Z(){return X||(X=Promise.resolve(),X.then(()=>{X=null})),X}function K(t,e,n){t.dispatchEvent(_(`${e?"intro":"outro"}${n}`))}const Q=new Set;let W;function tt(){W={r:0,c:[],p:W}}function et(){W.r||l(W.c),W=W.p}function nt(t,e){t&&t.i&&(Q.delete(t),t.i(e))}function st(t,e,n,s){if(t&&t.o){if(Q.has(t))return;Q.add(t),W.c.push(()=>{Q.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}}const rt={duration:0};function ot(t,e,n){let o,i,l=e(t,n),c=!1,u=0;function f(){o&&M(t,o)}function p(){const{delay:e=0,duration:n=300,easing:a=r,tick:p=s,css:h}=l||rt;h&&(o=R(t,0,1,n,e,a,h,u++)),p(0,1);const v=d()+e,b=v+n;i&&i.abort(),c=!0,H(()=>K(t,!0,"start")),i=m(e=>{if(c){if(e>=b)return p(1,0),K(t,!0,"end"),f(),c=!1;if(e>=v){const t=a((e-v)/n);p(t,1-t)}}return c})}let h=!1;return{start(){h||(M(t),a(l)?(l=l(),Z().then(p)):p())},invalidate(){h=!1},end(){c&&(f(),c=!1)}}}function it(t,e,n){let o,i=e(t,n),c=!0;const u=W;function f(){const{delay:e=0,duration:n=300,easing:a=r,tick:f=s,css:p}=i||rt;p&&(o=R(t,1,0,n,e,a,p));const h=d()+e,v=h+n;H(()=>K(t,!1,"start")),m(e=>{if(c){if(e>=v)return f(0,1),K(t,!1,"end"),--u.r||l(u.c),!1;if(e>=h){const t=a((e-h)/n);f(1-t,t)}}return c})}return u.r+=1,a(i)?Z().then(()=>{i=i(),f()}):f(),{end(e){e&&i.tick&&i.tick(1,0),c&&(o&&M(t,o),c=!1)}}}const lt="undefined"!=typeof window?window:global;function at(t,e){st(t,1,1,()=>{e.delete(t.key)})}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let ct;function ut(t){t&&t.c()}function dt(t,e,n){const{fragment:s,on_mount:r,on_destroy:i,after_update:c}=t.$$;s&&s.m(e,n),H(()=>{const e=r.map(o).filter(a);i?i.push(...e):l(e),t.$$.on_mount=[]}),c.forEach(H)}function ft(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function pt(t,e,n,r,o,a,c=[-1]){const u=j;A(t);const d=e.props||{},f=t.$$={fragment:null,ctx:null,props:a,update:s,not_equal:o,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:c};let p=!1;var h;f.ctx=n?n(t,d,(e,n,...s)=>{const r=s.length?s[0]:n;return f.ctx&&o(f.ctx[e],f.ctx[e]=r)&&(f.bound[e]&&f.bound[e](r),p&&function(t,e){-1===t.$$.dirty[0]&&(B.push(t),D(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],f.update(),p=!0,l(f.before_update),f.fragment=!!r&&r(f.ctx),e.target&&(e.hydrate?f.fragment&&f.fragment.l((h=e.target,Array.from(h.childNodes))):f.fragment&&f.fragment.c(),e.intro&&nt(t.$$.fragment),dt(t,e.target,e.anchor),J()),A(u)}"function"==typeof HTMLElement&&(ct=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){ft(this,1),this.$destroy=s}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}});class ht{$destroy(){ft(this,1),this.$destroy=s}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function mt(t){const e=t-1;return e*e*e+1}function vt(t,{delay:e=0,duration:n=400,easing:s=r}){const o=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:s,css:t=>`opacity: ${t*o}`}}function bt(t,{delay:e=0,duration:n=400,easing:s=mt,x:r=0,y:o=0,opacity:i=0}){const l=getComputedStyle(t),a=+l.opacity,c="none"===l.transform?"":l.transform,u=a*(1-i);return{delay:e,duration:n,easing:s,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*r}px, ${(1-t)*o}px);\n\t\t\topacity: ${a-u*e}`}}function gt(t,e,n){const s=t.slice();return s[12]=e[n],s}function yt(t){let e,n,s,r,o,i,a,c,u,d,f,p,h,m,y,x,k,E,_;return{c(){e=$("div"),n=$("h2"),n.textContent="Settings",s=w(),r=$("button"),r.textContent="Reselect subtitles",o=w(),i=$("button"),i.textContent="Realign subtitles",a=w(),c=$("br"),u=w(),d=$("input"),f=w(),p=$("label"),p.textContent="Show subs over video",h=w(),m=$("br"),y=w(),x=$("input"),k=w(),E=$("label"),E.textContent="Pause when tray is open",C(n,"class","svelte-pvtdrn"),C(r,"class","svelte-pvtdrn"),C(i,"class","svelte-pvtdrn"),C(d,"id","show-subs"),C(d,"type","checkbox"),d.checked=!0,C(p,"for","show-subs"),C(x,"id","pause-on-tray"),C(x,"type","checkbox"),C(E,"for","pause-on-tray"),C(e,"class","settings svelte-pvtdrn")},m(l,g){b(l,e,g),v(e,n),v(e,s),v(e,r),v(e,o),v(e,i),v(e,a),v(e,c),v(e,u),v(e,d),v(e,f),v(e,p),v(e,h),v(e,m),v(e,y),v(e,x),x.checked=t[2],v(e,k),v(e,E),_=[S(r,"click",t[8]),S(i,"click",t[9]),S(d,"change",t[5]("show-subs")),S(x,"change",t[10])]},p(t,e){4&e&&(x.checked=t[2])},d(t){t&&g(e),l(_)}}}function $t(t,e){let n,s,r,o,i,l,a,c,u,d=e[12].text+"";return{key:t,first:null,c(){n=$("li"),s=$("a"),r=x(d),i=w(),C(s,"target","_blank"),C(s,"href",o=`https://jisho.org/search/${encodeURIComponent(e[12].text.trim())}`),C(s,"rel","noopener noreferrer"),C(s,"class","svelte-pvtdrn"),C(n,"class","svelte-pvtdrn"),this.first=n},m(t,o){b(t,n,o),v(n,s),v(s,r),v(n,i),c=!0,u=S(s,"click",e[11])},p(t,e){(!c||1&e)&&d!==(d=t[12].text+"")&&E(r,d),(!c||1&e&&o!==(o=`https://jisho.org/search/${encodeURIComponent(t[12].text.trim())}`))&&C(s,"href",o)},i(t){c||(H(()=>{a&&a.end(1),l||(l=ot(n,bt,{y:50,duration:200})),l.start()}),c=!0)},o(t){l&&l.invalidate(),a=it(n,bt,{y:-50,duration:200}),c=!1},d(t){t&&g(n),t&&a&&a.end(),u()}}}function xt(t){let e,n,s,r,o,i,a,c,u,d,f,p,h,m=t[1]?"Hide":"Show",y=[],k=new Map,_=t[1]&&yt(t),T=t[0];const j=t=>t[12].text;for(let e=0;e<T.length;e+=1){let n=gt(t,T,e),s=j(n);k.set(s,y[e]=$t(s,n))}return{c(){e=$("div"),n=$("h1"),n.textContent="VRV Subtitler",s=w(),r=$("button"),o=x(m),i=x(" Settings"),a=w(),_&&_.c(),c=w(),u=$("h2"),u.textContent="Recent Subtitles",d=w(),f=$("ul");for(let t=0;t<y.length;t+=1)y[t].c();C(n,"class","svelte-pvtdrn"),C(r,"class","svelte-pvtdrn"),C(u,"class","svelte-pvtdrn"),C(f,"class","recent-subs svelte-pvtdrn"),C(e,"class","tray svelte-pvtdrn")},m(l,m){b(l,e,m),v(e,n),v(e,s),v(e,r),v(r,o),v(r,i),v(e,a),_&&_.m(e,null),v(e,c),v(e,u),v(e,d),v(e,f);for(let t=0;t<y.length;t+=1)y[t].m(f,null);p=!0,h=[S(r,"click",t[7]),S(e,"mouseenter",t[4](!0)),S(e,"mouseleave",t[4](!1))]},p(t,[n]){if((!p||2&n)&&m!==(m=t[1]?"Hide":"Show")&&E(o,m),t[1]?_?_.p(t,n):(_=yt(t),_.c(),_.m(e,c)):_&&(_.d(1),_=null),9&n){const e=t[0];tt(),y=function(t,e,n,s,r,o,i,l,a,c,u,d){let f=t.length,p=o.length,h=f;const m={};for(;h--;)m[t[h].key]=h;const v=[],b=new Map,g=new Map;for(h=p;h--;){const t=d(r,o,h),l=n(t);let a=i.get(l);a?s&&a.p(t,e):(a=c(l,t),a.c()),b.set(l,v[h]=a),l in m&&g.set(l,Math.abs(h-m[l]))}const y=new Set,$=new Set;function x(t){nt(t,1),t.m(l,u),i.set(t.key,t),u=t.first,p--}for(;f&&p;){const e=v[p-1],n=t[f-1],s=e.key,r=n.key;e===n?(u=e.first,f--,p--):b.has(r)?!i.has(s)||y.has(s)?x(e):$.has(r)?f--:g.get(s)>g.get(r)?($.add(s),x(e)):(y.add(r),f--):(a(n,i),f--)}for(;f--;){const e=t[f];b.has(e.key)||a(e,i)}for(;p;)x(v[p-1]);return v}(y,n,j,1,t,e,k,f,at,$t,null,gt),et()}},i(t){if(!p){for(let t=0;t<T.length;t+=1)nt(y[t]);p=!0}},o(t){for(let t=0;t<y.length;t+=1)st(y[t]);p=!1},d(t){t&&g(e),_&&_.d();for(let t=0;t<y.length;t+=1)y[t].d();l(h)}}}function wt(t,e,n){const s=q();let{recentSubs:r=[]}=e,o=!1,i=!0;return t.$set=t=>{"recentSubs"in t&&n(0,r=t.recentSubs)},[r,o,i,s,function(t){return()=>{t&&!i||s("tray-pauser",t)}},function(t){return e=>{s(t,e.target.checked)}},!0,()=>n(1,o=!o),()=>s("restart"),()=>s("realign"),function(){i=this.checked,n(2,i)},()=>s("define-pauser")]}var kt=class extends ht{constructor(t){var e;super(),document.getElementById("svelte-pvtdrn-style")||((e=$("style")).id="svelte-pvtdrn-style",e.textContent=".tray.svelte-pvtdrn.svelte-pvtdrn{margin-top:0.5rem;width:2vw;background:rgba(255, 255, 255, 0.2);position:fixed;right:0;top:0;color:white;height:calc(100% - 5rem)}.tray.svelte-pvtdrn>.svelte-pvtdrn{visibility:hidden}.tray.svelte-pvtdrn.svelte-pvtdrn:hover{width:40vw;max-width:40rem;background:rgb(33, 39, 55);overflow:auto;border-radius:3px}.tray.svelte-pvtdrn:hover>.svelte-pvtdrn{visibility:visible}.tray.svelte-pvtdrn h1.svelte-pvtdrn{font-size:2rem;background:rgb(27, 26, 38);padding:0.5rem 0;border-radius:3px;margin:0 0 0.5rem 0;border-bottom:2px solid #f47521}.tray.svelte-pvtdrn h2.svelte-pvtdrn{margin:0;text-decoration:underline}button.svelte-pvtdrn.svelte-pvtdrn{margin:0.5rem}.settings.svelte-pvtdrn.svelte-pvtdrn{background:#1a1d2b;margin:1rem;padding:1rem;box-shadow:inset 0 0 0.5rem black;border-radius:3px}ul.svelte-pvtdrn.svelte-pvtdrn{list-style:none}a.svelte-pvtdrn.svelte-pvtdrn{color:white;transform:scaleY(0);transform-origin:top;transition:transform 0.5s ease;font-size:1rem;text-decoration:none}a.svelte-pvtdrn.svelte-pvtdrn:hover{color:#0aff8c;cursor:pointer;text-decoration:underline}li.svelte-pvtdrn.svelte-pvtdrn:not(:first-of-type)::before{content:' ';position:relative;background:#f47521;height:0.1rem;width:3.2rem;display:block;margin:0 auto;border-radius:4px}",v(document.head,e)),pt(this,t,wt,xt,c,{recentSubs:0})}};function St(t,e,n){const s=t.slice();return s[11]=e[n],s}function Ct(t,e,n){const s=t.slice();return s[8]=e[n],s}function Et(t){let e,n,s=t[0],r=[];for(let e=0;e<s.length;e+=1)r[e]=Ot(Ct(t,s,e));const o=t=>st(r[t],1,1,()=>{r[t]=null});return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=k()},m(t,s){for(let e=0;e<r.length;e+=1)r[e].m(t,s);b(t,e,s),n=!0},p(t,n){if(13&n){let i;for(s=t[0],i=0;i<s.length;i+=1){const o=Ct(t,s,i);r[i]?(r[i].p(o,n),nt(r[i],1)):(r[i]=Ot(o),r[i].c(),nt(r[i],1),r[i].m(e.parentNode,e))}for(tt(),i=s.length;i<r.length;i+=1)o(i);et()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)nt(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)st(r[t]);n=!1},d(t){y(r,t),t&&g(e)}}}function _t(t){let e,n=t[8].text+"";return{c(){e=x(n)},m(t,n){b(t,e,n)},p(t,s){1&s&&n!==(n=t[8].text+"")&&E(e,n)},i:s,o:s,d(t){t&&g(e)}}}function Tt(t){let e,n,s=t[8].styledText,r=[];for(let e=0;e<s.length;e+=1)r[e]=jt(St(t,s,e));const o=t=>st(r[t],1,1,()=>{r[t]=null});return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=k()},m(t,s){for(let e=0;e<r.length;e+=1)r[e].m(t,s);b(t,e,s),n=!0},p(t,n){if(1&n){let i;for(s=t[8].styledText,i=0;i<s.length;i+=1){const o=St(t,s,i);r[i]?(r[i].p(o,n),nt(r[i],1)):(r[i]=jt(o),r[i].c(),nt(r[i],1),r[i].m(e.parentNode,e))}for(tt(),i=s.length;i<r.length;i+=1)o(i);et()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)nt(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)st(r[t]);n=!1},d(t){y(r,t),t&&g(e)}}}function jt(t){let e,n,s,r,o,i,l=t[11].text+"";return{c(){e=$("span"),n=x(l),C(e,"style",s=t[11].inline)},m(t,s){b(t,e,s),v(e,n),i=!0},p(t,r){(!i||1&r)&&l!==(l=t[11].text+"")&&E(n,l),(!i||1&r&&s!==(s=t[11].inline))&&C(e,"style",s)},i(n){i||(H(()=>{o&&o.end(1),r||(r=ot(e,vt,t[11].fadeIn)),r.start()}),i=!0)},o(n){r&&r.invalidate(),o=it(e,vt,t[11].fadeOut),i=!1},d(t){t&&g(e),t&&o&&o.end()}}}function Ot(t){let e,n,s,r,o,i,l,a;const c=[Tt,_t],u=[];function d(t,e){return t[8].styledText?0:1}function f(...e){return t[7](t[8],...e)}return n=d(t),s=u[n]=c[n](t),{c(){e=$("p"),s.c(),r=w(),C(e,"style",o=t[3](t[8])),C(e,"data-sub-style",i=t[8].style),C(e,"title","click to search this phrase on Jisho.org"),C(e,"class","svelte-1w98obp")},m(t,s){b(t,e,s),u[n].m(e,null),v(e,r),l=!0,a=S(e,"click",f)},p(a,f){let p=n;n=d(t=a),n===p?u[n].p(t,f):(tt(),st(u[p],1,1,()=>{u[p]=null}),et(),s=u[n],s||(s=u[n]=c[n](t),s.c()),nt(s,1),s.m(e,r)),(!l||1&f&&o!==(o=t[3](t[8])))&&C(e,"style",o),(!l||1&f&&i!==(i=t[8].style))&&C(e,"data-sub-style",i)},i(t){l||(nt(s),l=!0)},o(t){st(s),l=!1},d(t){t&&g(e),u[n].d(),a()}}}function Pt(t){let e,n,s=t[1]&&Et(t);return{c(){e=$("div"),s&&s.c(),C(e,"class","subtitles")},m(t,r){b(t,e,r),s&&s.m(e,null),n=!0},p(t,[n]){t[1]?s?(s.p(t,n),nt(s,1)):(s=Et(t),s.c(),nt(s,1),s.m(e,null)):s&&(tt(),st(s,1,1,()=>{s=null}),et())},i(t){n||(nt(s),n=!0)},o(t){st(s),n=!1},d(t){t&&g(e),s&&s.d()}}}function Rt(t,e,n){let{current:s=[]}=e,{styles:r={}}=e,{format:o=""}=e,{visible:i=!0}=e;const l=q();function a(t){l("define-pauser"),window.open(`https://jisho.org/search/${encodeURIComponent(t.trim())}`)}return t.$set=t=>{"current"in t&&n(0,s=t.current),"styles"in t&&n(4,r=t.styles),"format"in t&&n(5,o=t.format),"visible"in t&&n(1,i=t.visible)},[s,i,a,function(t){return"srt"===o?`font-size: ${1.5+1.5*(t.line?t.line:1)}rem; -webkit-text-stroke: 2px black;text-shadow: 3px 3px black;font-weight: bold`:"ass"===o&&t.style in r?[r[t.style].inline,t.inline||""].join(";"):void 0},r,o,l,t=>a(t.text)]}var Mt=class extends ht{constructor(t){var e;super(),document.getElementById("svelte-1w98obp-style")||((e=$("style")).id="svelte-1w98obp-style",e.textContent="p.svelte-1w98obp{cursor:pointer;color:white;margin:0;padding:0;white-space:pre}p.svelte-1w98obp:hover{color:#0aff8c !important}",v(document.head,e)),pt(this,t,Rt,Pt,c,{current:0,styles:4,format:5,visible:1})}};class At{constructor(){this.video=null,this.reasons=[]}setVideo(t){this.reasons=[],this.video=t}addPauser(t){this.reasons.push(t),this._checkPause()}removePauser(t){const e=this.reasons.indexOf(t);-1!==e&&(this.reasons.splice(e,1),this._checkPause())}_checkPause(){this.reasons.length?this.video.pause():this.video.play()}}var It=n(1),qt=n.n(It),Bt=n(0),zt=n.n(Bt);class Ft extends zt.a{constructor(t){super("srt");const e=t.split("\n\n");this.subs=e.reduce((t,e)=>{let n=e.trim().split("\n");function s(){n.shift()}try{/^\d*$/.test(n[0])&&s();let[e,r]=n[0].replace(/,/g,".").match(/^([\d:\.\-> ]*)/)[0].split(/\-\->/),o=n[0].match(/([a-zA-Z].*)/);o=o&&o.length?o[1]:"";const i=(t=>{const e=o.match(new RegExp(`${t}:([\\d\\.]*)%`));if(e)return parseInt(e[1],10)/100})("line")||1;s(),t.push({start:this.timeToMs(e),end:this.timeToMs(r),text:n.join("\n").replace(/<\/?c.Japanese>/g,""),line:i})}catch(t){}return t},[])}}function Nt(t){let e,n,r,o;return{c(){e=$("label"),e.textContent="Select a subtitle file to begin",n=w(),r=$("input"),C(e,"for","srt-upload"),C(e,"class","svelte-7fhqwx"),C(r,"type","file"),C(r,"id","srt-upload"),C(r,"accept",".srt,.ass,.ssa"),C(r,"class","svelte-7fhqwx")},m(s,i){b(s,e,i),b(s,n,i),b(s,r,i),o=S(r,"change",t[0])},p:s,i:s,o:s,d(t){t&&g(e),t&&g(n),t&&g(r),o()}}}function Lt(t){const e=q();return[function(t){const n=t.target.files[0],s=new FileReader;s.onload=t=>{const s={ass:qt.a,ssa:qt.a,srt:Ft},[r,o]=n.name.match(/\.(\w{3})$/);e("subtitles-loaded",new s[o](t.target.result))},s.readAsText(n)}]}var Vt=class extends ht{constructor(t){var e;super(),document.getElementById("svelte-7fhqwx-style")||((e=$("style")).id="svelte-7fhqwx-style",e.textContent="label.svelte-7fhqwx{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;display:inline-block;margin:2rem}label.svelte-7fhqwx:hover{background:#ffea6d}input.svelte-7fhqwx{display:none}",v(document.head,e)),pt(this,t,Lt,Nt,c,{})}};const{document:Dt}=lt;function Ht(t){let e,n,r,o,i,a,c,u,d,f,p,h,m,y,k=t[0].text+"",_="number"==typeof t[1]&&function(t){let e,n;return{c(){e=$("button"),e.textContent=`\n\t\t\t\tUse the last alignment (${Math.abs(t[2])} seconds ${t[1]>0?"later":"earlier"}).\n\t\t\t`,C(e,"class","svelte-1lai4ts")},m(s,r){b(s,e,r),n=S(e,"click",t[3])},p:s,d(t){t&&g(e),n()}}}(t);return{c(){e=$("div"),n=$("button"),r=x("Click when the first line is said:\n\t\t"),o=$("br"),i=w(),a=$("pre"),c=x(k),u=w(),d=$("div"),_&&_.c(),f=w(),p=$("button"),p.textContent="No alignment adjustment.",h=w(),m=$("button"),m.textContent="Enter alignment manually.",C(n,"class","svelte-1lai4ts"),C(p,"class","svelte-1lai4ts"),C(m,"class","svelte-1lai4ts"),C(d,"class","row svelte-1lai4ts"),C(e,"class","alignment-buttons svelte-1lai4ts")},m(s,l){b(s,e,l),v(e,n),v(n,r),v(n,o),v(n,i),v(n,a),v(a,c),v(e,u),v(e,d),_&&_.m(d,null),v(d,f),v(d,p),v(d,h),v(d,m),y=[S(n,"click",t[5]),S(p,"click",t[8]),S(m,"click",t[4])]},p(t,[e]){1&e&&k!==(k=t[0].text+"")&&E(c,k),"number"==typeof t[1]&&_.p(t,e)},i:s,o:s,d(t){t&&g(e),_&&_.d(),l(y)}}}function Ut(t,e,n){let{firstSubtitle:s={}}=e;const r=q(),o=GM_getValue("last-used-alignment"),i=(o/1e3).toFixed(1);function l(t){const e=document.querySelector("video"),n="number"==typeof t?t:1e3*e.currentTime-s.start-400;GM_setValue("last-used-alignment",n),r("set-align",n)}return t.$set=t=>{"firstSubtitle"in t&&n(0,s=t.firstSubtitle)},[s,o,i,function(){l(o)},function(){const t=parseFloat(prompt("Enter an alignment in seconds. Positive numbers mean the subtitles are timed earlier than the video and need to be delayed.",i));isNaN(t)||l(1e3*t)},l,r,"last-used-alignment",()=>l(0)]}var Gt=class extends ht{constructor(t){var e;super(),Dt.getElementById("svelte-1lai4ts-style")||((e=$("style")).id="svelte-1lai4ts-style",e.textContent=".alignment-buttons.svelte-1lai4ts.svelte-1lai4ts{display:flex;flex-direction:column}.alignment-buttons.svelte-1lai4ts button.svelte-1lai4ts{margin:0.5rem;align-self:center}.row.svelte-1lai4ts.svelte-1lai4ts{display:flex;flex-direction:row;justify-content:center}",v(Dt.head,e)),pt(this,t,Ut,Ht,c,{firstSubtitle:0})}};const{document:Jt}=lt;function Yt(t){let e,n;const s=new Mt({props:{format:t[2].format,styles:t[2].styles,current:t[1],currentTime:t[5],visible:t[4]}});s.$on("define-pauser",t[10]);const r=new kt({props:{recentSubs:t[3]}});return r.$on("restart",t[6]),r.$on("tray-pauser",t[9]),r.$on("define-pauser",t[10]),r.$on("realign",t[17]),r.$on("show-subs",t[18]),{c(){ut(s.$$.fragment),e=w(),ut(r.$$.fragment)},m(t,o){dt(s,t,o),b(t,e,o),dt(r,t,o),n=!0},p(t,e){const n={};4&e&&(n.format=t[2].format),4&e&&(n.styles=t[2].styles),2&e&&(n.current=t[1]),16&e&&(n.visible=t[4]),s.$set(n);const o={};8&e&&(o.recentSubs=t[3]),r.$set(o)},i(t){n||(nt(s.$$.fragment,t),nt(r.$$.fragment,t),n=!0)},o(t){st(s.$$.fragment,t),st(r.$$.fragment,t),n=!1},d(t){ft(s,t),t&&g(e),ft(r,t)}}}function Xt(t){let e;const n=new Gt({props:{firstSubtitle:t[2].firstSubtitle()}});return n.$on("set-align",t[7]),{c(){ut(n.$$.fragment)},m(t,s){dt(n,t,s),e=!0},p(t,e){const s={};4&e&&(s.firstSubtitle=t[2].firstSubtitle()),n.$set(s)},i(t){e||(nt(n.$$.fragment,t),e=!0)},o(t){st(n.$$.fragment,t),e=!1},d(t){ft(n,t)}}}function Zt(t){let e;const n=new Vt({});return n.$on("subtitles-loaded",t[8]),{c(){ut(n.$$.fragment)},m(t,s){dt(n,t,s),e=!0},p:s,i(t){e||(nt(n.$$.fragment,t),e=!0)},o(t){st(n.$$.fragment,t),e=!1},d(t){ft(n,t)}}}function Kt(t){let e,n,s,r;const o=[Zt,Xt,Yt],i=[];function l(t,e){return"prompt"===t[0]?0:"align"===t[0]?1:"play"===t[0]?2:-1}return~(n=l(t))&&(s=i[n]=o[n](t)),{c(){e=$("div"),s&&s.c(),C(e,"class","subtitles-app svelte-ddp0sa")},m(t,s){b(t,e,s),~n&&i[n].m(e,null),r=!0},p(t,[r]){let a=n;n=l(t),n===a?~n&&i[n].p(t,r):(s&&(tt(),st(i[a],1,1,()=>{i[a]=null}),et()),~n?(s=i[n],s||(s=i[n]=o[n](t),s.c()),nt(s,1),s.m(e,null)):s=null)},i(t){r||(nt(s),r=!0)},o(t){st(s),r=!1},d(t){t&&g(e),~n&&i[n].d()}}}function Qt(t,e,n){const s=new At;let r="prompt",o=[],i=null,l=null,a=-1,c=[],u=!0;function d(){n(0,r="prompt"),n(2,i=null),n(1,o=[])}var f;function p(t){let e=t[t.length-1],s=c[c.length-1];!e||s&&e.text===s.text||n(3,c=[...c,e]),c.length>10&&n(3,c=c.slice(c.length-10))}function h(){"play"===r&&(n(1,o=i.getSubs(1e3*l.currentTime-a)),p(o),requestAnimationFrame(h))}f=()=>{document.addEventListener("visibilitychange",()=>{document.hidden||s.removePauser("define")});let t="";setInterval(()=>{const e=document.querySelector("video").getAttribute("src");e&&e!==t&&(t=e,d())},50)},I().$$.on_mount.push(f);return[r,o,i,c,u,"",d,function(t){l=document.querySelector("video"),s.setVideo(l),a=t.detail,n(3,c=[]),n(0,r="play"),h()},function(t){n(2,i=t.detail),0===i.subs.length?(console.log("subtitles object failed to parse: ",i),alert(`No subtitles were parsed from the selected .${i.format} file, verify nothing is wrong with the file. If it appears normal please submit a bug report with the episode and the subtitles file you used to the issue tracker!`)):n(0,r="align")},function(t){t.detail?s.addPauser("tray"):s.removePauser("tray")},function(){s.addPauser("define")},l,a,"last-used-alignment",s,p,h,()=>n(0,r="align"),t=>n(4,u=t.detail)]}var Wt=class extends ht{constructor(t){var e;super(),Jt.getElementById("svelte-ddp0sa-style")||((e=$("style")).id="svelte-ddp0sa-style",e.textContent=".subtitles-app.svelte-ddp0sa{position:relative}.subtitles-app.svelte-ddp0sa>*{z-index:1000000000}.subtitles-app.svelte-ddp0sa button{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase}.subtitles-app.svelte-ddp0sa button:hover{background:#ffea6d}",v(Jt.head,e)),pt(this,t,Qt,Kt,c,{})}};const te=document.createElement("div");document.body.appendChild(te),te.id="sheodox-vrv-subtitler",te.style.height="100%",te.style.width="100%";new Wt({target:te})}]);
