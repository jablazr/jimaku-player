// ==UserScript==
// @name         VRV Subtitler
// @namespace    http://tampermonkey.net/
// @version      0.1.0
// @description  Display SRT format subtitles on VRV
// @author       sheodox
// @match        https://static.vrv.co/vilos/player.html
// @grant        GM_getValue
// @grant        GM_setValue
// ==/UserScript==

!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function o(){}n.r(e);const r=t=>t;function s(t){return t()}function i(){return Object.create(null)}function l(t){t.forEach(s)}function a(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}const u="undefined"!=typeof window;let d=u?()=>window.performance.now():()=>Date.now(),p=u?t=>requestAnimationFrame(t):o;const f=new Set;function h(t){f.forEach(e=>{e.c(t)||(f.delete(e),e.f())}),0!==f.size&&p(h)}function g(t){let e;return 0===f.size&&p(h),{promise:new Promise(n=>{f.add(e={c:t,f:n})}),abort(){f.delete(e)}}}function m(t,e){t.appendChild(e)}function v(t,e,n){t.insertBefore(e,n||null)}function b(t){t.parentNode.removeChild(t)}function y(t){return document.createElement(t)}function $(t){return document.createTextNode(t)}function x(){return $(" ")}function k(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function j(t,e){e=""+e,t.data!==e&&(t.data=e)}function S(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}function _(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let C,E,P=0,M={};function R(t,e,n,o,r,s,i,l=0){const a=16.666/o;let c="{\n";for(let t=0;t<=1;t+=a){const o=e+(n-e)*s(t);c+=100*t+`%{${i(o,1-o)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${l}`;if(!M[d]){if(!C){const t=y("style");document.head.appendChild(t),C=t.sheet}M[d]=!0,C.insertRule(`@keyframes ${d} ${u}`,C.cssRules.length)}const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${d} ${o}ms linear ${r}ms 1 both`,P+=1,d}function q(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--P&&p(()=>{if(P)return;let t=C.cssRules.length;for(;t--;)C.deleteRule(t);M={}})}function O(t){E=t}function T(){if(!E)throw new Error("Function called outside component initialization");return E}function z(){const t=T();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=_(e,n);o.slice().forEach(e=>{e.call(t,r)})}}}const A=[],I=[],B=[],F=[],L=Promise.resolve();let H=!1;function N(){H||(H=!0,L.then(J))}function U(t){B.push(t)}let V=!1;const G=new Set;function J(){if(!V){V=!0;do{for(let t=0;t<A.length;t+=1){const e=A[t];O(e),D(e.$$)}for(A.length=0;I.length;)I.pop()();for(let t=0;t<B.length;t+=1){const e=B[t];G.has(e)||(G.add(e),e())}B.length=0}while(A.length);for(;F.length;)F.pop()();H=!1,V=!1,G.clear()}}function D(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(U)}}let Y;function Z(){return Y||(Y=Promise.resolve(),Y.then(()=>{Y=null})),Y}function K(t,e,n){t.dispatchEvent(_(`${e?"intro":"outro"}${n}`))}const Q=new Set;let W;function X(){W={r:0,c:[],p:W}}function tt(){W.r||l(W.c),W=W.p}function et(t,e){t&&t.i&&(Q.delete(t),t.i(e))}function nt(t,e,n,o){if(t&&t.o){if(Q.has(t))return;Q.add(t),W.c.push(()=>{Q.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}const ot={duration:0};const rt="undefined"!=typeof window?window:global;function st(t,e){nt(t,1,1,()=>{e.delete(t.key)})}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let it;function lt(t){t&&t.c()}function at(t,e,n){const{fragment:o,on_mount:r,on_destroy:i,after_update:c}=t.$$;o&&o.m(e,n),U(()=>{const e=r.map(s).filter(a);i?i.push(...e):l(e),t.$$.on_mount=[]}),c.forEach(U)}function ct(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ut(t,e,n,r,s,a,c=[-1]){const u=E;O(t);const d=e.props||{},p=t.$$={fragment:null,ctx:null,props:a,update:o,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:c};let f=!1;var h;p.ctx=n?n(t,d,(e,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[e],p.ctx[e]=r)&&(p.bound[e]&&p.bound[e](r),f&&function(t,e){-1===t.$$.dirty[0]&&(A.push(t),N(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],p.update(),f=!0,l(p.before_update),p.fragment=!!r&&r(p.ctx),e.target&&(e.hydrate?p.fragment&&p.fragment.l((h=e.target,Array.from(h.childNodes))):p.fragment&&p.fragment.c(),e.intro&&et(t.$$.fragment),at(t,e.target,e.anchor),J()),O(u)}"function"==typeof HTMLElement&&(it=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){ct(this,1),this.$destroy=o}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}});class dt{$destroy(){ct(this,1),this.$destroy=o}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}class pt{constructor(t){this.parse(t)}parse(t){const e=t.split("\n\n");this.subs=e.reduce((t,e)=>{let n=e.trim().split("\n");function o(){n.shift()}try{/^\d*$/.test(n[0])&&o();let[e,r]=n[0].replace(/,/g,".").match(/^([\d:\.\-> ]*)/)[0].split(/\-\->/),s=n[0].match(/([a-zA-Z].*)/);s=s&&s.length?s[1]:"";const i=(t=>{const e=s.match(new RegExp(`${t}:([\\d\\.]*)%`));if(e)return parseInt(e[1],10)/100})("line")||1;o(),t.push({start:this.toMS(e),end:this.toMS(r),text:n.join("\n").replace(/<\/?c.Japanese>/g,""),line:i})}catch(t){}return t},[])}getSubs(t){return this.subs.filter(e=>e.start<=t&&e.end>=t)}toMS(t){const[e,n,o]=t.trim().split(":");return 1e3*o+1e3*n*60+1e3*e*60*60}}function ft(t){let e,n,r,s;return{c(){e=y("label"),e.textContent="Select an SRT file to begin",n=x(),r=y("input"),w(e,"for","srt-upload"),w(e,"class","svelte-q6vvh2"),w(r,"type","file"),w(r,"id","srt-upload"),w(r,"accept",".srt"),w(r,"class","svelte-q6vvh2")},m(o,i){v(o,e,i),v(o,n,i),v(o,r,i),s=k(r,"change",t[0])},p:o,i:o,o:o,d(t){t&&b(e),t&&b(n),t&&b(r),s()}}}function ht(t){const e=z();return[function(t){const n=t.target.files[0],o=new FileReader;o.onload=t=>{e("srt-loaded",t.target.result)},o.readAsText(n)}]}var gt=class extends dt{constructor(t){var e;super(),document.getElementById("svelte-q6vvh2-style")||((e=y("style")).id="svelte-q6vvh2-style",e.textContent="label.svelte-q6vvh2{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;display:inline-block;margin:2rem}label.svelte-q6vvh2:hover{background:#ffea6d}input.svelte-q6vvh2{display:none}",m(document.head,e)),ut(this,t,ht,ft,c,{})}};function mt(t){const e=t-1;return e*e*e+1}function vt(t,{delay:e=0,duration:n=400,easing:o=mt,x:r=0,y:s=0,opacity:i=0}){const l=getComputedStyle(t),a=+l.opacity,c="none"===l.transform?"":l.transform,u=a*(1-i);return{delay:e,duration:n,easing:o,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*r}px, ${(1-t)*s}px);\n\t\t\topacity: ${a-u*e}`}}function bt(t,e,n){const o=t.slice();return o[12]=e[n],o}function yt(t){let e,n,o,r,s,i,a,c,u,d,p,f,h,g,$,j,S,_,C;return{c(){e=y("div"),n=y("h2"),n.textContent="Settings",o=x(),r=y("button"),r.textContent="Reselect subtitles",s=x(),i=y("button"),i.textContent="Realign subtitles",a=x(),c=y("br"),u=x(),d=y("input"),p=x(),f=y("label"),f.textContent="Show subs over video",h=x(),g=y("br"),$=x(),j=y("input"),S=x(),_=y("label"),_.textContent="Pause when tray is open",w(n,"class","svelte-1tapopj"),w(r,"class","svelte-1tapopj"),w(i,"class","svelte-1tapopj"),w(d,"id","show-subs"),w(d,"type","checkbox"),d.checked=!0,w(f,"for","show-subs"),w(j,"id","pause-on-tray"),w(j,"type","checkbox"),w(_,"for","pause-on-tray"),w(e,"class","settings svelte-1tapopj")},m(l,b){v(l,e,b),m(e,n),m(e,o),m(e,r),m(e,s),m(e,i),m(e,a),m(e,c),m(e,u),m(e,d),m(e,p),m(e,f),m(e,h),m(e,g),m(e,$),m(e,j),j.checked=t[2],m(e,S),m(e,_),C=[k(r,"click",t[8]),k(i,"click",t[9]),k(d,"change",t[5]("show-subs")),k(j,"change",t[10])]},p(t,e){4&e&&(j.checked=t[2])},d(t){t&&b(e),l(C)}}}function $t(t,e){let n,s,i,c,u,p,f,h,S,_=e[12].text+"";return{key:t,first:null,c(){n=y("li"),s=y("a"),i=$(_),u=x(),w(s,"target","_blank"),w(s,"href",c=`https://jisho.org/search/${encodeURIComponent(e[12].text.trim())}`),w(s,"rel","noopener noreferrer"),w(s,"class","svelte-1tapopj"),w(n,"class","svelte-1tapopj"),this.first=n},m(t,o){v(t,n,o),m(n,s),m(s,i),m(n,u),h=!0,S=k(s,"click",e[11])},p(t,e){(!h||1&e)&&_!==(_=t[12].text+"")&&j(i,_),(!h||1&e&&c!==(c=`https://jisho.org/search/${encodeURIComponent(t[12].text.trim())}`))&&w(s,"href",c)},i(t){h||(U(()=>{f&&f.end(1),p||(p=function(t,e,n){let s,i,l=e(t,n),c=!1,u=0;function p(){s&&q(t,s)}function f(){const{delay:e=0,duration:n=300,easing:a=r,tick:f=o,css:h}=l||ot;h&&(s=R(t,0,1,n,e,a,h,u++)),f(0,1);const m=d()+e,v=m+n;i&&i.abort(),c=!0,U(()=>K(t,!0,"start")),i=g(e=>{if(c){if(e>=v)return f(1,0),K(t,!0,"end"),p(),c=!1;if(e>=m){const t=a((e-m)/n);f(t,1-t)}}return c})}let h=!1;return{start(){h||(q(t),a(l)?(l=l(),Z().then(f)):f())},invalidate(){h=!1},end(){c&&(p(),c=!1)}}}(n,vt,{y:50,duration:200})),p.start()}),h=!0)},o(t){p&&p.invalidate(),f=function(t,e,n){let s,i=e(t,n),c=!0;const u=W;function p(){const{delay:e=0,duration:n=300,easing:a=r,tick:p=o,css:f}=i||ot;f&&(s=R(t,1,0,n,e,a,f));const h=d()+e,m=h+n;U(()=>K(t,!1,"start")),g(e=>{if(c){if(e>=m)return p(0,1),K(t,!1,"end"),--u.r||l(u.c),!1;if(e>=h){const t=a((e-h)/n);p(1-t,t)}}return c})}return u.r+=1,a(i)?Z().then(()=>{i=i(),p()}):p(),{end(e){e&&i.tick&&i.tick(1,0),c&&(s&&q(t,s),c=!1)}}}(n,vt,{y:-50,duration:200}),h=!1},d(t){t&&b(n),t&&f&&f.end(),S()}}}function xt(t){let e,n,o,r,s,i,a,c,u,d,p,f,h,g=t[1]?"Hide":"Show",S=[],_=new Map,C=t[1]&&yt(t),E=t[0];const P=t=>t[12].text;for(let e=0;e<E.length;e+=1){let n=bt(t,E,e),o=P(n);_.set(o,S[e]=$t(o,n))}return{c(){e=y("div"),n=y("h1"),n.textContent="SubRenderer",o=x(),r=y("button"),s=$(g),i=$(" Settings"),a=x(),C&&C.c(),c=x(),u=y("h2"),u.textContent="Recent Subtitles",d=x(),p=y("ul");for(let t=0;t<S.length;t+=1)S[t].c();w(n,"class","svelte-1tapopj"),w(r,"class","svelte-1tapopj"),w(u,"class","svelte-1tapopj"),w(p,"class","recent-subs svelte-1tapopj"),w(e,"class","tray svelte-1tapopj")},m(l,g){v(l,e,g),m(e,n),m(e,o),m(e,r),m(r,s),m(r,i),m(e,a),C&&C.m(e,null),m(e,c),m(e,u),m(e,d),m(e,p);for(let t=0;t<S.length;t+=1)S[t].m(p,null);f=!0,h=[k(r,"click",t[7]),k(e,"mouseenter",t[4](!0)),k(e,"mouseleave",t[4](!1))]},p(t,[n]){if((!f||2&n)&&g!==(g=t[1]?"Hide":"Show")&&j(s,g),t[1]?C?C.p(t,n):(C=yt(t),C.c(),C.m(e,c)):C&&(C.d(1),C=null),9&n){const e=t[0];X(),S=function(t,e,n,o,r,s,i,l,a,c,u,d){let p=t.length,f=s.length,h=p;const g={};for(;h--;)g[t[h].key]=h;const m=[],v=new Map,b=new Map;for(h=f;h--;){const t=d(r,s,h),l=n(t);let a=i.get(l);a?o&&a.p(t,e):(a=c(l,t),a.c()),v.set(l,m[h]=a),l in g&&b.set(l,Math.abs(h-g[l]))}const y=new Set,$=new Set;function x(t){et(t,1),t.m(l,u),i.set(t.key,t),u=t.first,f--}for(;p&&f;){const e=m[f-1],n=t[p-1],o=e.key,r=n.key;e===n?(u=e.first,p--,f--):v.has(r)?!i.has(o)||y.has(o)?x(e):$.has(r)?p--:b.get(o)>b.get(r)?($.add(o),x(e)):(y.add(r),p--):(a(n,i),p--)}for(;p--;){const e=t[p];v.has(e.key)||a(e,i)}for(;f;)x(m[f-1]);return m}(S,n,P,1,t,e,_,p,st,$t,null,bt),tt()}},i(t){if(!f){for(let t=0;t<E.length;t+=1)et(S[t]);f=!0}},o(t){for(let t=0;t<S.length;t+=1)nt(S[t]);f=!1},d(t){t&&b(e),C&&C.d();for(let t=0;t<S.length;t+=1)S[t].d();l(h)}}}function kt(t,e,n){const o=z();let{recentSubs:r=[]}=e,s=!1,i=!0;return t.$set=t=>{"recentSubs"in t&&n(0,r=t.recentSubs)},[r,s,i,o,function(t){return()=>{t&&!i||o("tray-pauser",t)}},function(t){return e=>{o(t,e.target.checked)}},!0,()=>n(1,s=!s),()=>o("restart"),()=>o("realign"),function(){i=this.checked,n(2,i)},()=>o("define-pauser")]}var wt=class extends dt{constructor(t){var e;super(),document.getElementById("svelte-1tapopj-style")||((e=y("style")).id="svelte-1tapopj-style",e.textContent=".tray.svelte-1tapopj.svelte-1tapopj{margin-top:0.5rem;width:2vw;background:rgba(255, 255, 255, 0.1);overflow:auto;position:absolute;right:0;top:0;color:white}.tray.svelte-1tapopj>.svelte-1tapopj{visibility:hidden}.tray.svelte-1tapopj.svelte-1tapopj:hover{width:40vw;max-width:40rem;background:rgb(33, 39, 55);border-radius:3px}.tray.svelte-1tapopj:hover>.svelte-1tapopj{visibility:visible}.tray.svelte-1tapopj h1.svelte-1tapopj{font-size:2rem;background:rgb(27, 26, 38);padding:0.5rem 0;border-radius:3px;margin:0 0 0.5rem 0;border-bottom:2px solid #f47521}.tray.svelte-1tapopj h2.svelte-1tapopj{margin:0;text-decoration:underline}button.svelte-1tapopj.svelte-1tapopj{margin:0.5rem}.settings.svelte-1tapopj.svelte-1tapopj{background:#1a1d2b;margin:1rem;padding:1rem;box-shadow:inset 0 0 0.5rem black;border-radius:3px}ul.svelte-1tapopj.svelte-1tapopj{list-style:none;overflow-y:scroll;padding-bottom:2rem}a.svelte-1tapopj.svelte-1tapopj{color:white;transform:scaleY(0);transform-origin:top;transition:transform 0.5s ease;font-size:1rem;text-decoration:none}a.svelte-1tapopj.svelte-1tapopj:hover{color:#0aff8c;cursor:pointer;text-decoration:underline}li.svelte-1tapopj.svelte-1tapopj:not(:first-of-type)::before{content:' ';position:relative;background:#f47521;height:0.1rem;width:3.2rem;display:block;margin:0 auto;border-radius:4px}",m(document.head,e)),ut(this,t,kt,xt,c,{recentSubs:0})}};function jt(t,e,n){const o=t.slice();return o[5]=e[n],o}function St(t){let e,n=t[0],o=[];for(let e=0;e<n.length;e+=1)o[e]=_t(jt(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=$("")},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);v(t,e,n)},p(t,r){if(5&r){let s;for(n=t[0],s=0;s<n.length;s+=1){const i=jt(t,n,s);o[s]?o[s].p(i,r):(o[s]=_t(i),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){!function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(o,t),t&&b(e)}}}function _t(t){let e,n,o,r=t[5].text+"";function s(...e){return t[4](t[5],...e)}return{c(){e=y("p"),n=$(r),S(e,"font-size",.5+2.5*t[5].line+"rem"),w(e,"title","click to search this phrase on Jisho.org"),w(e,"class","svelte-1n7ymnp")},m(t,r){v(t,e,r),m(e,n),o=k(e,"click",s)},p(o,s){t=o,1&s&&r!==(r=t[5].text+"")&&j(n,r),1&s&&S(e,"font-size",.5+2.5*t[5].line+"rem")},d(t){t&&b(e),o()}}}function Ct(t){let e,n=t[1]&&St(t);return{c(){e=y("div"),n&&n.c(),w(e,"class","subtitles")},m(t,o){v(t,e,o),n&&n.m(e,null)},p(t,[o]){t[1]?n?n.p(t,o):(n=St(t),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:o,o:o,d(t){t&&b(e),n&&n.d()}}}function Et(t,e,n){let{current:o=[]}=e,{visible:r=!0}=e;const s=z();function i(t){s("define-pauser"),window.open(`https://jisho.org/search/${encodeURIComponent(t.trim())}`)}return t.$set=t=>{"current"in t&&n(0,o=t.current),"visible"in t&&n(1,r=t.visible)},[o,r,i,s,t=>i(t.text)]}var Pt=class extends dt{constructor(t){var e;super(),document.getElementById("svelte-1n7ymnp-style")||((e=y("style")).id="svelte-1n7ymnp-style",e.textContent="p.svelte-1n7ymnp{cursor:pointer;color:white;margin:0;padding:0;text-shadow:black 2px 2px 0, black 2px -2px 0, black -2px 2px 0, black -2px -2px 0, black 2px 0 0, black 0 2px 0, black -2px 0 0, black 0 -2px 0, black 2px 2px 2px}p.svelte-1n7ymnp:hover{color:#0aff8c}",m(document.head,e)),ut(this,t,Et,Ct,c,{current:0,visible:1})}};class Mt{constructor(){this.video=null,this.reasons=[]}setVideo(t){this.reasons=[],this.video=t}addPauser(t){this.reasons.push(t),this._checkPause()}removePauser(t){const e=this.reasons.indexOf(t);-1!==e&&(this.reasons.splice(e,1),this._checkPause())}_checkPause(){this.reasons.length?this.video.pause():this.video.play()}}const{document:Rt}=rt;function qt(t){let e,n;const o=new Pt({props:{current:t[1],currentTime:t[6],visible:t[4]}});o.$on("define-pauser",t[12]);const r=new wt({props:{recentSubs:t[3]}});return r.$on("restart",t[7]),r.$on("tray-pauser",t[11]),r.$on("define-pauser",t[12]),r.$on("realign",t[19]),r.$on("show-subs",t[20]),{c(){lt(o.$$.fragment),e=x(),lt(r.$$.fragment)},m(t,s){at(o,t,s),v(t,e,s),at(r,t,s),n=!0},p(t,e){const n={};2&e&&(n.current=t[1]),16&e&&(n.visible=t[4]),o.$set(n);const s={};8&e&&(s.recentSubs=t[3]),r.$set(s)},i(t){n||(et(o.$$.fragment,t),et(r.$$.fragment,t),n=!0)},o(t){nt(o.$$.fragment,t),nt(r.$$.fragment,t),n=!1},d(t){ct(o,t),t&&b(e),ct(r,t)}}}function Ot(t){let e,n,r,s,i,l,a,c,u,d=t[2].subs[0].text+"",p="number"==typeof t[5]&&function(t){let e,n;return{c(){e=y("button"),e.textContent=`\n\t\t\t\t\tUse the last alignment (first line at ${(t[5]/1e3).toFixed(1)} seconds).\n\t\t\t\t`,w(e,"class","svelte-gi9goe")},m(o,r){v(o,e,r),n=k(e,"click",t[9])},p:o,d(t){t&&b(e),n()}}}(t);return{c(){e=y("div"),n=y("button"),r=$("Click when the first line is said:\n\t\t\t\t"),s=y("br"),i=x(),l=y("pre"),a=$(d),c=x(),p&&p.c(),w(n,"class","svelte-gi9goe"),w(e,"class","alignment-buttons svelte-gi9goe")},m(o,d){v(o,e,d),m(e,n),m(n,r),m(n,s),m(n,i),m(n,l),m(l,a),m(e,c),p&&p.m(e,null),u=k(n,"click",t[8])},p(t,e){4&e&&d!==(d=t[2].subs[0].text+"")&&j(a,d),"number"==typeof t[5]&&p.p(t,e)},i:o,o:o,d(t){t&&b(e),p&&p.d(),u()}}}function Tt(t){let e;const n=new gt({});return n.$on("srt-loaded",t[10]),{c(){lt(n.$$.fragment)},m(t,o){at(n,t,o),e=!0},p:o,i(t){e||(et(n.$$.fragment,t),e=!0)},o(t){nt(n.$$.fragment,t),e=!1},d(t){ct(n,t)}}}function zt(t){let e,n,o,r;const s=[Tt,Ot,qt],i=[];function l(t,e){return"prompt"===t[0]?0:"align"===t[0]?1:"play"===t[0]?2:-1}return~(n=l(t))&&(o=i[n]=s[n](t)),{c(){e=y("div"),o&&o.c(),w(e,"class","subtitles-app svelte-gi9goe")},m(t,o){v(t,e,o),~n&&i[n].m(e,null),r=!0},p(t,[r]){let a=n;n=l(t),n===a?~n&&i[n].p(t,r):(o&&(X(),nt(i[a],1,1,()=>{i[a]=null}),tt()),~n?(o=i[n],o||(o=i[n]=s[n](t),o.c()),et(o,1),o.m(e,null)):o=null)},i(t){r||(et(o),r=!0)},o(t){nt(o),r=!1},d(t){t&&b(e),~n&&i[n].d()}}}function At(t,e,n){const o=GM_getValue("last-used-alignment"),r=new Mt;let s="prompt",i=[],l=null,a=null,c=-1,u=[],d=!0;var p;function f(t){a=document.querySelector("video"),r.setVideo(a),c="number"==typeof t?t:1e3*a.currentTime-l.subs[0].start-400,GM_setValue("last-used-alignment",c),n(0,s="play"),g()}function h(t){let e=t[t.length-1],o=u[u.length-1];(!o||e&&e.text!==o.text)&&n(3,u=[...u,e]),u.length>10&&n(3,u=u.slice(u.length-10))}function g(){n(1,i=l.getSubs(1e3*a.currentTime-c)),h(i),requestAnimationFrame(g)}p=()=>{document.addEventListener("visibilitychange",()=>{document.hidden||r.removePauser("define")})},T().$$.on_mount.push(p);return[s,i,l,u,d,o,"",function(){n(3,u=[]),n(1,i=[]),n(0,s="prompt")},f,function(){f(o)},function(t){n(2,l=new pt(t.detail)),n(0,s="align")},function(t){t.detail?r.addPauser("tray"):r.removePauser("tray")},function(){r.addPauser("define")},a,c,"last-used-alignment",r,h,g,()=>n(0,s="align"),t=>n(4,d=t.detail)]}var It=class extends dt{constructor(t){var e;super(),Rt.getElementById("svelte-gi9goe-style")||((e=y("style")).id="svelte-gi9goe-style",e.textContent=".subtitles-app.svelte-gi9goe.svelte-gi9goe{position:relative}.subtitles-app.svelte-gi9goe.svelte-gi9goe>*{z-index:1000000000}.subtitles-app.svelte-gi9goe.svelte-gi9goe button{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase}.subtitles-app.svelte-gi9goe.svelte-gi9goe button:hover{background:#ffea6d}.alignment-buttons.svelte-gi9goe.svelte-gi9goe{display:flex;flex-direction:column}.alignment-buttons.svelte-gi9goe button.svelte-gi9goe{margin:0.5rem;align-self:center}",m(Rt.head,e)),ut(this,t,At,zt,c,{})}};const Bt=document.createElement("div");document.body.appendChild(Bt),Bt.id="sheodox-vrv-subtitler",Bt.style.height="100%",Bt.style.width="100%";new It({target:Bt})}]);
