// ==UserScript==
// @name         VRV Subtitler
// @namespace    http://tampermonkey.net/
// @version      0.1.21
// @description  Display SRT format subtitles on VRV
// @author       sheodox
// @match        https://static.vrv.co/vilos/player.html
// @grant        GM_getValue
// @grant        GM_setValue
// ==/UserScript==

!function(t){var e={};function n(c){if(e[c])return e[c].exports;var r=e[c]={i:c,l:!1,exports:{}};return t[c].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,c){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:c})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(c,r,function(e){return t[e]}.bind(null,r));return c},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";function c(){}n.d(e,"a",(function(){return vt})),n.d(e,"b",(function(){return Y})),n.d(e,"c",(function(){return h})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return C})),n.d(e,"f",(function(){return it})),n.d(e,"g",(function(){return K})),n.d(e,"h",(function(){return pt})),n.d(e,"i",(function(){return xt})),n.d(e,"j",(function(){return bt})),n.d(e,"k",(function(){return dt})),n.d(e,"l",(function(){return mt})),n.d(e,"m",(function(){return m})),n.d(e,"n",(function(){return g})),n.d(e,"o",(function(){return y})),n.d(e,"p",(function(){return w})),n.d(e,"q",(function(){return ft})),n.d(e,"r",(function(){return ot})),n.d(e,"s",(function(){return r})),n.d(e,"t",(function(){return yt})),n.d(e,"u",(function(){return x})),n.d(e,"v",(function(){return a})),n.d(e,"w",(function(){return k})),n.d(e,"x",(function(){return gt})),n.d(e,"y",(function(){return c})),n.d(e,"z",(function(){return B})),n.d(e,"A",(function(){return jt})),n.d(e,"B",(function(){return S})),n.d(e,"C",(function(){return p})),n.d(e,"D",(function(){return l})),n.d(e,"E",(function(){return u})),n.d(e,"F",(function(){return H})),n.d(e,"G",(function(){return I})),n.d(e,"H",(function(){return $})),n.d(e,"I",(function(){return v})),n.d(e,"J",(function(){return M})),n.d(e,"K",(function(){return E})),n.d(e,"L",(function(){return lt})),n.d(e,"M",(function(){return at})),n.d(e,"N",(function(){return Ot}));const r=t=>t;function s(t,e){for(const n in e)t[n]=e[n];return t}function o(t){return t()}function i(){return Object.create(null)}function l(t){t.forEach(o)}function a(t){return"function"==typeof t}function u(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}const b="undefined"!=typeof window;let d=b?()=>window.performance.now():()=>Date.now(),p=b?t=>requestAnimationFrame(t):c;const f=new Set;function j(t){f.forEach(e=>{e.c(t)||(f.delete(e),e.f())}),0!==f.size&&p(j)}function O(t){let e;return 0===f.size&&p(j),{promise:new Promise(n=>{f.add(e={c:t,f:n})}),abort(){f.delete(e)}}}function h(t,e){t.appendChild(e)}function x(t,e,n){t.insertBefore(e,n||null)}function g(t){t.parentNode.removeChild(t)}function m(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function y(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function $(){return v(" ")}function w(){return v("")}function k(t,e,n,c){return t.addEventListener(e,n,c),()=>t.removeEventListener(e,n,c)}function S(t){return function(e){return e.preventDefault(),t.call(this,e)}}function C(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function M(t){return""===t?void 0:+t}function H(t,e){e=""+e,t.data!==e&&(t.data=e)}function I(t,e){(null!=e||t.value)&&(t.value=e)}function E(t,e,n){t.classList[n?"add":"remove"](e)}function N(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let L,P,_=0,F={};function T(t,e,n,c,r,s,o,i=0){const l=16.666/c;let a="{\n";for(let t=0;t<=1;t+=l){const c=e+(n-e)*s(t);a+=100*t+`%{${o(c,1-c)}}\n`}const u=a+`100% {${o(n,1-n)}}\n}`,b=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${i}`;if(!F[b]){if(!L){const t=y("style");document.head.appendChild(t),L=t.sheet}F[b]=!0,L.insertRule(`@keyframes ${b} ${u}`,L.cssRules.length)}const d=t.style.animation||"";return t.style.animation=`${d?`${d}, `:""}${b} ${c}ms linear ${r}ms 1 both`,_+=1,b}function R(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--_&&p(()=>{if(_)return;let t=L.cssRules.length;for(;t--;)L.deleteRule(t);F={}})}function A(t){P=t}function z(){if(!P)throw new Error("Function called outside component initialization");return P}function B(t){z().$$.on_mount.push(t)}function K(){const t=z();return(e,n)=>{const c=t.$$.callbacks[e];if(c){const r=N(e,n);c.slice().forEach(e=>{e.call(t,r)})}}}const D=[],G=[],q=[],J=[],W=Promise.resolve();let V=!1;function U(){V||(V=!0,W.then(Q))}function Y(t){q.push(t)}let X=!1;const Z=new Set;function Q(){if(!X){X=!0;do{for(let t=0;t<D.length;t+=1){const e=D[t];A(e),tt(e.$$)}for(D.length=0;G.length;)G.pop()();for(let t=0;t<q.length;t+=1){const e=q[t];Z.has(e)||(Z.add(e),e())}q.length=0}while(D.length);for(;J.length;)J.pop()();V=!1,X=!1,Z.clear()}}function tt(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Y)}}let et;function nt(){return et||(et=Promise.resolve(),et.then(()=>{et=null})),et}function ct(t,e,n){t.dispatchEvent(N(`${e?"intro":"outro"}${n}`))}const rt=new Set;let st;function ot(){st={r:0,c:[],p:st}}function it(){st.r||l(st.c),st=st.p}function lt(t,e){t&&t.i&&(rt.delete(t),t.i(e))}function at(t,e,n,c){if(t&&t.o){if(rt.has(t))return;rt.add(t),st.c.push(()=>{rt.delete(t),c&&(n&&t.d(1),c())}),t.o(e)}}const ut={duration:0};function bt(t,e,n){let s,o,i=e(t,n),l=!1,u=0;function b(){s&&R(t,s)}function p(){const{delay:e=0,duration:n=300,easing:a=r,tick:p=c,css:f}=i||ut;f&&(s=T(t,0,1,n,e,a,f,u++)),p(0,1);const j=d()+e,h=j+n;o&&o.abort(),l=!0,Y(()=>ct(t,!0,"start")),o=O(e=>{if(l){if(e>=h)return p(1,0),ct(t,!0,"end"),b(),l=!1;if(e>=j){const t=a((e-j)/n);p(t,1-t)}}return l})}let f=!1;return{start(){f||(R(t),a(i)?(i=i(),nt().then(p)):p())},invalidate(){f=!1},end(){l&&(b(),l=!1)}}}function dt(t,e,n){let s,o=e(t,n),i=!0;const u=st;function b(){const{delay:e=0,duration:n=300,easing:a=r,tick:b=c,css:p}=o||ut;p&&(s=T(t,1,0,n,e,a,p));const f=d()+e,j=f+n;Y(()=>ct(t,!1,"start")),O(e=>{if(i){if(e>=j)return b(0,1),ct(t,!1,"end"),--u.r||l(u.c),!1;if(e>=f){const t=a((e-f)/n);b(1-t,t)}}return i})}return u.r+=1,a(o)?nt().then(()=>{o=o(),b()}):b(),{end(e){e&&o.tick&&o.tick(1,0),i&&(s&&R(t,s),i=!1)}}}function pt(t,e,n,s){let o=e(t,n),i=s?0:1,u=null,b=null,p=null;function f(){p&&R(t,p)}function j(t,e){const n=t.b-i;return e*=Math.abs(n),{a:i,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(e){const{delay:n=0,duration:s=300,easing:a=r,tick:h=c,css:x}=o||ut,g={start:d()+n,b:e};e||(g.group=st,st.r+=1),u?b=g:(x&&(f(),p=T(t,i,e,s,n,a,x)),e&&h(0,1),u=j(g,s),Y(()=>ct(t,e,"start")),O(e=>{if(b&&e>b.start&&(u=j(b,s),b=null,ct(t,u.b,"start"),x&&(f(),p=T(t,i,u.b,u.duration,0,a,o.css))),u)if(e>=u.end)h(i=u.b,1-i),ct(t,u.b,"end"),b||(u.b?f():--u.group.r||l(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;i=u.a+u.d*a(t/u.duration),h(i,1-i)}return!(!u&&!b)}))}return{run(t){a(o)?nt().then(()=>{o=o(),h(t)}):h(t)},end(){f(),u=b=null}}}const ft="undefined"!=typeof window?window:global;function jt(t,e){at(t,1,1,()=>{e.delete(t.key)})}function Ot(t,e,n,c,r,s,o,i,l,a,u,b){let d=t.length,p=s.length,f=d;const j={};for(;f--;)j[t[f].key]=f;const O=[],h=new Map,x=new Map;for(f=p;f--;){const t=b(r,s,f),i=n(t);let l=o.get(i);l?c&&l.p(t,e):(l=a(i,t),l.c()),h.set(i,O[f]=l),i in j&&x.set(i,Math.abs(f-j[i]))}const g=new Set,m=new Set;function y(t){lt(t,1),t.m(i,u),o.set(t.key,t),u=t.first,p--}for(;d&&p;){const e=O[p-1],n=t[d-1],c=e.key,r=n.key;e===n?(u=e.first,d--,p--):h.has(r)?!o.has(c)||g.has(c)?y(e):m.has(r)?d--:x.get(c)>x.get(r)?(m.add(c),y(e)):(g.add(r),d--):(l(n,o),d--)}for(;d--;){const e=t[d];h.has(e.key)||l(e,o)}for(;p;)y(O[p-1]);return O}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let ht;function xt(t){t&&t.c()}function gt(t,e,n){const{fragment:c,on_mount:r,on_destroy:s,after_update:i}=t.$$;c&&c.m(e,n),Y(()=>{const e=r.map(o).filter(a);s?s.push(...e):l(e),t.$$.on_mount=[]}),i.forEach(Y)}function mt(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yt(t,e,n,r,s,o,a=[-1]){const u=P;A(t);const b=e.props||{},d=t.$$={fragment:null,ctx:null,props:o,update:c,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:a};let p=!1;d.ctx=n?n(t,b,(e,n,...c)=>{const r=c.length?c[0]:n;return d.ctx&&s(d.ctx[e],d.ctx[e]=r)&&(d.bound[e]&&d.bound[e](r),p&&function(t,e){-1===t.$$.dirty[0]&&(D.push(t),U(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],d.update(),p=!0,l(d.before_update),d.fragment=!!r&&r(d.ctx),e.target&&(e.hydrate?d.fragment&&d.fragment.l(function(t){return Array.from(t.childNodes)}(e.target)):d.fragment&&d.fragment.c(),e.intro&&lt(t.$$.fragment),gt(t,e.target,e.anchor),Q()),A(u)}"function"==typeof HTMLElement&&(ht=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){mt(this,1),this.$destroy=c}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}});class vt{$destroy(){mt(this,1),this.$destroy=c}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}},function(t,e,n){"use strict";var c=n(0);n.d(e,"a",(function(){return c.g})),n.d(e,"b",(function(){return c.z}))},function(t,e,n){"use strict";var c=n(0);function r(t){const e=t-1;return e*e*e+1}function s(t,{delay:e=0,duration:n=400,easing:r=c.s}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:t=>`opacity: ${t*s}`}}function o(t,{delay:e=0,duration:n=400,easing:c=r,x:s=0,y:o=0,opacity:i=0}){const l=getComputedStyle(t),a=+l.opacity,u="none"===l.transform?"":l.transform,b=a*(1-i);return{delay:e,duration:n,easing:c,css:(t,e)=>`\n\t\t\ttransform: ${u} translate(${(1-t)*s}px, ${(1-t)*o}px);\n\t\t\topacity: ${a-b*e}`}}n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}))},,,function(t,e){t.exports=class{constructor(t,e){this.format=t,this.fileName=e,this.subs=[]}getSubs(t){return this.subs.filter(e=>e.start<=t&&e.end>=t)}timeToMs(t){const[e,n,c]=t.split(":");return 36e5*+e+6e4*+n+1e3*parseFloat(c)}firstSubtitle(){return this.subs.reduce((t,e)=>e.start<t.start?e:t,{start:1/0})}}},function(t,e,n){const c=n(5),r=t=>(t.charAt(0).toLowerCase()+t.substring(1)).replace(" ",""),s=t=>{if(t){t=(t=t.replace(/[&H]/g,"")).padStart(8,"0");const[e,n,c,r,s]=t.match(/([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i),o=t=>parseInt(t,16);return`rgba(${o(s)}, ${o(r)}, ${o(c)}, ${255-o(n)})`}},o=(t,e,n="transparent",c=0,r=0)=>{const s=t||n;c*=2,r=`${r}px`;const o=[];for(let t=-1*(e=2*(void 0===e?1:e));t<=e;t++)for(let n=-1*e;n<=e;n++)o.push(`${t}px ${n}px ${r} ${s}`);return`text-shadow: ${o.join(", ")}, ${c}px ${c}px ${r} ${n}`},i=t=>`font-family: "${t}", "Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif`;function l(t,e,n=!1){const c=new RegExp(n?`\\\\${e}\\((.*?)\\)`:`\\\\${e}([^\\\\}]*)`),r=t.match(c);if(r)return{overrides:t.replace(r[0],""),params:n?r[1].split(","):r[1]}}t.exports=class extends c{constructor(t,e){super("ass",e),t=t.replace(/\r\n/g,"\n");try{this.blocks=this.parseBlocks(t),this.subs=this.parseBlock(this.blocks.subs),this.parseInfo(this.blocks.info),this.parseSubTimings(),this.parseStyles(this.parseBlock(this.blocks.styles)),this.parseSubOverrideTags()}catch(t){console.error("ASS PARSE ERROR",t),this.subs=[]}}serialize(){return JSON.stringify({info:this.info,styles:this.styles,subs:this.subs},null,4)}debugInfo(){return[{title:"Number of styles",detail:Object.keys(this.styles).length},{title:"Number of subtitles",detail:this.subs.length}]}parseInfo(){this.info={},this.blocks.info.split("\n").forEach(t=>{const[e,n]=t.split(": ");this.info[r(e)]=n})}scaleHeight(t){return`${t/+this.info.playResY*100}vh`}scaleWidth(t){return`${t/+this.info.playResX*100}vw`}parseBlocks(t){const e=t.split(/\n(?=\[)/),n=t=>e.find(e=>{e=e.trim();const[n,c]=e.match(/^\[(.*?)]/);return c===t}).replace(/.*\n/,"").trim();return{info:n("Script Info"),styles:n("V4+ Styles"),subs:n("Events")}}parseBlock(t){const[e,...n]=t.split("\n"),c=(t,e=1/0)=>{let[n,c,r]=t.match(/(\w*): (.*)/);return r=r.split(","),r.length>e&&(r[e-1]=r.slice(e-1).join(","),r.splice(e,1/0)),{type:c,attributes:r}},s=c(e);return n.reduce((t,e)=>{if(!e||";"===e.charAt(0)||0===e.indexOf("Comment: "))return t;const n=c(e,s.attributes.length),o={dataType:n.type.toLowerCase()};return s.attributes.forEach((t,e)=>{t=t.trim();const c=r(t);o[c]=n.attributes[e]}),o.style="*Default"===o.style?"Default":o.style,t.push(o),t},[])}parseSubTimings(){this.subs.forEach(t=>{t.start=this.timeToMs(t.start),t.end=this.timeToMs(t.end)})}parseStyles(t){const e={};t.forEach(t=>{for(const e of Object.keys(t).filter(t=>/colour/i.test(t)))t[e]=s(t[e]);t.name="*Default"===t.name?"Default":t.name;const n=[],{primaryColour:c,secondaryColour:r,outlineColour:l,backColour:a,borderStyle:u,outline:b,shadow:d,fontname:p,fontsize:f,bold:j,italic:O,underline:h,strikeOut:x}=t;c&&n.push(`color: ${c}`),p&&n.push(i(p)),"1"===u?n.push(o(l,b,a,d)):"3"===u&&n.push(`background-color: ${a}`),"-1"===j&&n.push("font-weight: bold"),"-1"===O&&n.push("font-style: italic"),"-1"!==h&&"-1"!==x||n.push(`text-decoration: ${"-1"===h?"underline":""} ${"-1"===x?"line-through":""}`),e[t.name]={inline:n.join(";"),...this.genScaledFont(f),raw:t}}),this.styles=e}genScaledFont(t){return{fontScaled:this.scaleHeight(.75*t),fontMax:`${t}px`,fontScalingThreshold:+this.info.playResY,fontRaw:t}}parseSubOverrideTags(){this.subs.forEach(t=>{if(t.rawText=t.text,t.text=t.text.replace("\\N","\n"),!/{.+?}/.test(t.text))return;const e=t=>t.replace(/{.*?}/g,"");t.styledText=[];const n=function*(t){const e=/({.*?}[^{]*)/g;let n;const c=t.indexOf("{");for(c>0&&(yield t.substring(0,c));null!==(n=e.exec(t));)yield n[1]}(t.text);let c=[];for(const u of n){const n=[],b={text:e(u),fadeIn:0,fadeOut:0,inline:""};let d,p,f,j,O,h=u.match(/{.*?}/),x=h?h[0]:"";function r(t,e=!1,n=(()=>{})){const c=l(x,t,e);c&&(n(c.params),x=c.overrides)}function a(t,e,n){const c=t.map((t,n)=>{const c=Array.isArray(e)?e[n]:e,r=l(x,t,c);if(r)return x=r.overrides,r.params});c.some(t=>void 0!==t)&&n(...c)}if(r("fscx"),r("fscy"),r("3c",!1,t=>{d=t}),r("4c",!1,t=>{p=t}),r("bord",!1,t=>{f=t}),r("shad",!1,t=>{j=t}),r("blur",!1,t=>{O=t}),r("be",!1,t=>{O=t}),[d,p,f,j,O].some(t=>void 0!==t)){const e=this.styles[t.style],n=(t,n)=>void 0!==t?t:e.raw[n];e&&(d=n(s(d),"outlineColour"),p=n(s(p),"backColour"),f=n(f,"outline"),j=n(j,"shadow"),c.push(o(d,f,p,j,O)))}a(["pos","an","org"],[!0,!1,!0],(t,e="5",r)=>{if(t){const[s,o]=t;n.push(`position: fixed; left: ${this.scaleWidth(s)}; top: ${this.scaleHeight(o)}`);const i={1:"50%, -150%",2:"-50%, -150%",3:"-150%, -150%",4:"50%, -50%",5:"-50%, -50%",6:"-150%, -50%",7:"50%, 50%",8:"-50%, 50%",9:"-150%, 50%"}[e];if(n.push(`transform: translate(${i})`),r){const[t,e]=r;c.push(`transform-origin: ${this.scaleWidth(t)} ${this.scaleHeight(e)}`)}}}),a(["frx","fry","frz"],!1,(t,e,r)=>{const s=[],o=(t,e,n=1)=>{if(void 0!==t)return t=parseFloat(t)*n,s.push(`rotate3d(${e.join(", ")}, ${t}deg)`)};o(t,[1,0,0]),o(r,[0,0,1],-1),o(e,[0,1,0]),s.length&&(n.push("perspective: 200px"),c.push(`display: block; transform: ${s.join(" ")}`))}),r("fad",!0,([e,n])=>{b.fadeIn=e,b.fadeOut=n,t.end-=n}),r("fsp",!1,t=>{c.push(`letter-spacing: ${t}px`)}),r("fs",!1,t=>{Object.assign(b,this.genScaledFont(t))});const g=[];r("u",!1,t=>{g.push("underline")}),r("s",!1,t=>{g.push("line-through")}),c.push(`text-decoration: ${g.length?g.join(" "):"none"}`),r("b",!1,t=>{c.push(`font-weight: ${t?"bold":"normal"}`)}),r("i",!1,t=>{c.push(`font-style: ${t?"italic":"normal"}`)}),r("fn",!1,t=>{c.push(i(t))}),r("1c",!1,t=>{c.push(`color: ${s(t)}`)}),r("r",!1,t=>{if(t){const e=this.styles[t];c=[e.inline],Object.assign(b,this.genScaledFont(e.fontRaw))}else c=[]}),b.inline=c.join(";"),t.styledText.push(b),n.length&&(t.inline=n.join(";"))}t.text=e(t.text)})}}},,function(t,e,n){"use strict";n.r(e);var c=n(0),r=n(1),s=n(2);function o(t,e,n){const c=t.slice();return c[20]=e[n],c}function i(t,e,n){const c=t.slice();return c[23]=e[n],c}function l(t){let e,n,r,s,l,a,d,p,f,j,O,h,x,g,m,y,v,$,w,k,S,C,M,H,I,E,N,L,P,_,F,T,R,A,z,B,K,D,G,q,J,W,V,U,Y,X,Z,Q,tt,et,nt,ct,rt,st,ot,it=[],lt=new Map,at=t[1].fileName+"",ut=t[2]>0?"+":"",bt=(t[2]/1e3).toFixed(1)+"",dt=t[0];const pt=t=>t[23].text;for(let e=0;e<dt.length;e+=1){let n=i(t,dt,e),c=pt(n);lt.set(c,it[e]=u(c,n))}let ft=t[1].debugInfo(),jt=[];for(let e=0;e<ft.length;e+=1)jt[e]=b(o(t,ft,e));return{c(){e=Object(c.o)("div"),n=Object(c.o)("button"),r=Object(c.I)("Recent Subtitles"),l=Object(c.H)(),a=Object(c.o)("button"),d=Object(c.I)("Settings"),f=Object(c.H)(),j=Object(c.o)("button"),O=Object(c.I)("Debug"),x=Object(c.H)(),g=Object(c.o)("div"),m=Object(c.o)("h2"),m.textContent="Recent Subtitles",y=Object(c.H)(),v=Object(c.o)("ul");for(let t=0;t<it.length;t+=1)it[t].c();$=Object(c.H)(),w=Object(c.o)("div"),k=Object(c.o)("h2"),k.textContent="Settings",S=Object(c.H)(),C=Object(c.o)("button"),C.textContent="Reselect subtitles",M=Object(c.H)(),H=Object(c.o)("button"),H.textContent="Realign subtitles",I=Object(c.H)(),E=Object(c.o)("br"),N=Object(c.H)(),L=Object(c.o)("input"),P=Object(c.H)(),_=Object(c.o)("label"),_.textContent="Show subs over video",F=Object(c.H)(),T=Object(c.o)("br"),R=Object(c.H)(),A=Object(c.o)("input"),z=Object(c.H)(),B=Object(c.o)("label"),B.textContent="Pause when tray is open",K=Object(c.H)(),D=Object(c.o)("div"),G=Object(c.o)("h2"),G.textContent="Debug Information",q=Object(c.H)(),J=Object(c.o)("dl"),W=Object(c.o)("dt"),W.textContent="Subtitles File",V=Object(c.o)("dd"),U=Object(c.I)(at),Y=Object(c.o)("dt"),Y.textContent="Alignment",X=Object(c.o)("dd"),Z=Object(c.I)(ut),Q=Object(c.I)(bt),tt=Object(c.I)(" seconds");for(let t=0;t<jt.length;t+=1)jt[t].c();et=Object(c.H)(),nt=Object(c.o)("a"),ct=Object(c.I)("⬇ Download Parsed Subtitles"),n.disabled=s="recent"===t[4],a.disabled=p="settings"===t[4],j.disabled=h="debug"===t[4],Object(c.e)(e,"class","tray-tab-buttons svelte-2rdhge"),Object(c.e)(m,"class","svelte-2rdhge"),Object(c.e)(v,"class","recent-subs svelte-2rdhge"),Object(c.e)(g,"class","tab svelte-2rdhge"),Object(c.K)(g,"tab-active","recent"===t[4]),Object(c.e)(k,"class","svelte-2rdhge"),Object(c.e)(L,"id","show-subs"),Object(c.e)(L,"type","checkbox"),L.checked=!0,Object(c.e)(_,"for","show-subs"),Object(c.e)(A,"id","pause-on-tray"),Object(c.e)(A,"type","checkbox"),Object(c.e)(B,"for","pause-on-tray"),Object(c.e)(w,"class","tab svelte-2rdhge"),Object(c.K)(w,"tab-active","settings"===t[4]),Object(c.e)(G,"class","svelte-2rdhge"),Object(c.e)(W,"class","svelte-2rdhge"),Object(c.e)(V,"class","svelte-2rdhge"),Object(c.e)(Y,"class","svelte-2rdhge"),Object(c.e)(X,"class","svelte-2rdhge"),Object(c.e)(nt,"href",rt=t[7]()),Object(c.e)(nt,"download","parsed-subtitles.json"),Object(c.e)(nt,"class","svelte-2rdhge"),Object(c.e)(D,"class","tab svelte-2rdhge"),Object(c.K)(D,"tab-active","debug"===t[4])},m(s,o){Object(c.u)(s,e,o),Object(c.c)(e,n),Object(c.c)(n,r),Object(c.c)(e,l),Object(c.c)(e,a),Object(c.c)(a,d),Object(c.c)(e,f),Object(c.c)(e,j),Object(c.c)(j,O),Object(c.u)(s,x,o),Object(c.u)(s,g,o),Object(c.c)(g,m),Object(c.c)(g,y),Object(c.c)(g,v);for(let t=0;t<it.length;t+=1)it[t].m(v,null);Object(c.u)(s,$,o),Object(c.u)(s,w,o),Object(c.c)(w,k),Object(c.c)(w,S),Object(c.c)(w,C),Object(c.c)(w,M),Object(c.c)(w,H),Object(c.c)(w,I),Object(c.c)(w,E),Object(c.c)(w,N),Object(c.c)(w,L),Object(c.c)(w,P),Object(c.c)(w,_),Object(c.c)(w,F),Object(c.c)(w,T),Object(c.c)(w,R),Object(c.c)(w,A),A.checked=t[5],Object(c.c)(w,z),Object(c.c)(w,B),Object(c.u)(s,K,o),Object(c.u)(s,D,o),Object(c.c)(D,G),Object(c.c)(D,q),Object(c.c)(D,J),Object(c.c)(J,W),Object(c.c)(J,V),Object(c.c)(V,U),Object(c.c)(J,Y),Object(c.c)(J,X),Object(c.c)(X,Z),Object(c.c)(X,Q),Object(c.c)(X,tt);for(let t=0;t<jt.length;t+=1)jt[t].m(J,null);Object(c.c)(D,et),Object(c.c)(D,nt),Object(c.c)(nt,ct),st=!0,ot=[Object(c.w)(n,"click",t[13]),Object(c.w)(a,"click",t[14]),Object(c.w)(j,"click",t[15]),Object(c.w)(C,"click",t[17]),Object(c.w)(H,"click",t[18]),Object(c.w)(L,"change",t[9]("show-subs")),Object(c.w)(A,"change",t[19])]},p(t,e){if((!st||16&e&&s!==(s="recent"===t[4]))&&(n.disabled=s),(!st||16&e&&p!==(p="settings"===t[4]))&&(a.disabled=p),(!st||16&e&&h!==(h="debug"===t[4]))&&(j.disabled=h),65&e){const n=t[0];Object(c.r)(),it=Object(c.N)(it,e,pt,1,t,n,lt,v,c.A,u,null,i),Object(c.f)()}if(16&e&&Object(c.K)(g,"tab-active","recent"===t[4]),32&e&&(A.checked=t[5]),16&e&&Object(c.K)(w,"tab-active","settings"===t[4]),(!st||2&e)&&at!==(at=t[1].fileName+"")&&Object(c.F)(U,at),(!st||4&e)&&ut!==(ut=t[2]>0?"+":"")&&Object(c.F)(Z,ut),(!st||4&e)&&bt!==(bt=(t[2]/1e3).toFixed(1)+"")&&Object(c.F)(Q,bt),2&e){let n;for(ft=t[1].debugInfo(),n=0;n<ft.length;n+=1){const c=o(t,ft,n);jt[n]?jt[n].p(c,e):(jt[n]=b(c),jt[n].c(),jt[n].m(J,null))}for(;n<jt.length;n+=1)jt[n].d(1);jt.length=ft.length}16&e&&Object(c.K)(D,"tab-active","debug"===t[4])},i(t){if(!st){for(let t=0;t<dt.length;t+=1)Object(c.L)(it[t]);st=!0}},o(t){for(let t=0;t<it.length;t+=1)Object(c.M)(it[t]);st=!1},d(t){t&&Object(c.n)(e),t&&Object(c.n)(x),t&&Object(c.n)(g);for(let t=0;t<it.length;t+=1)it[t].d();t&&Object(c.n)($),t&&Object(c.n)(w),t&&Object(c.n)(K),t&&Object(c.n)(D),Object(c.m)(jt,t),Object(c.D)(ot)}}}function a(t){let e,n;return{c(){e=Object(c.o)("button"),e.textContent="Select Subtitles",Object(c.e)(e,"class","svelte-2rdhge")},m(r,s){Object(c.u)(r,e,s),n=Object(c.w)(e,"click",t[12])},p:c.y,i:c.y,o:c.y,d(t){t&&Object(c.n)(e),n()}}}function u(t,e){let n,r,o,i,l,a,u,b,d,p=e[23].text+"";return{key:t,first:null,c(){n=Object(c.o)("li"),r=Object(c.o)("a"),o=Object(c.I)(p),l=Object(c.H)(),Object(c.e)(r,"target","_blank"),Object(c.e)(r,"href",i=`https://jisho.org/search/${encodeURIComponent(e[23].text.trim())}`),Object(c.e)(r,"rel","noopener noreferrer"),Object(c.e)(r,"class","svelte-2rdhge"),Object(c.e)(n,"class","svelte-2rdhge"),this.first=n},m(t,s){Object(c.u)(t,n,s),Object(c.c)(n,r),Object(c.c)(r,o),Object(c.c)(n,l),b=!0,d=Object(c.w)(r,"click",e[16])},p(t,e){(!b||1&e)&&p!==(p=t[23].text+"")&&Object(c.F)(o,p),(!b||1&e&&i!==(i=`https://jisho.org/search/${encodeURIComponent(t[23].text.trim())}`))&&Object(c.e)(r,"href",i)},i(t){b||(Object(c.b)(()=>{u&&u.end(1),a||(a=Object(c.j)(n,s.b,{y:50,duration:200})),a.start()}),b=!0)},o(t){a&&a.invalidate(),u=Object(c.k)(n,s.b,{y:-50,duration:200}),b=!1},d(t){t&&Object(c.n)(n),t&&u&&u.end(),d()}}}function b(t){let e,n,r,s,o=t[20].title+"",i=t[20].detail+"";return{c(){e=Object(c.o)("dt"),n=Object(c.I)(o),r=Object(c.o)("dd"),s=Object(c.I)(i),Object(c.e)(e,"class","svelte-2rdhge"),Object(c.e)(r,"class","svelte-2rdhge")},m(t,o){Object(c.u)(t,e,o),Object(c.c)(e,n),Object(c.u)(t,r,o),Object(c.c)(r,s)},p(t,e){2&e&&o!==(o=t[20].title+"")&&Object(c.F)(n,o),2&e&&i!==(i=t[20].detail+"")&&Object(c.F)(s,i)},d(t){t&&Object(c.n)(e),t&&Object(c.n)(r)}}}function d(t){let e,n,r,s,o,i,u;const b=[a,l],d=[];function p(t,e){return"cancelled"===t[3]?0:"normal"===t[3]?1:-1}return~(s=p(t))&&(o=d[s]=b[s](t)),{c(){e=Object(c.o)("div"),n=Object(c.o)("h1"),n.textContent="VRV Subtitler",r=Object(c.H)(),o&&o.c(),Object(c.e)(n,"class","svelte-2rdhge"),Object(c.e)(e,"class","tray svelte-2rdhge")},m(o,l){Object(c.u)(o,e,l),Object(c.c)(e,n),Object(c.c)(e,r),~s&&d[s].m(e,null),i=!0,u=[Object(c.w)(e,"mouseenter",t[8](!0)),Object(c.w)(e,"mouseleave",t[8](!1))]},p(t,[n]){let r=s;s=p(t),s===r?~s&&d[s].p(t,n):(o&&(Object(c.r)(),Object(c.M)(d[r],1,1,()=>{d[r]=null}),Object(c.f)()),~s?(o=d[s],o||(o=d[s]=b[s](t),o.c()),Object(c.L)(o,1),o.m(e,null)):o=null)},i(t){i||(Object(c.L)(o),i=!0)},o(t){Object(c.M)(o),i=!1},d(t){t&&Object(c.n)(e),~s&&d[s].d(),Object(c.D)(u)}}}function p(t,e,n){const c=Object(r.a)();let{recentSubs:s=[]}=e,{subtitles:o={}}=e,{alignment:i=0}=e,{mode:l="normal"}=e,a="recent",u=!0;return t.$set=t=>{"recentSubs"in t&&n(0,s=t.recentSubs),"subtitles"in t&&n(1,o=t.subtitles),"alignment"in t&&n(2,i=t.alignment),"mode"in t&&n(3,l=t.mode)},[s,o,i,l,a,u,c,function(){const t=new Blob([o.serialize()],{type:"application/json"});return URL.createObjectURL(t)},function(t){return()=>{t&&!u||c("tray-pauser",t)}},function(t){return e=>{c(t,e.target.checked)}},!1,!0,()=>c("restart"),()=>n(4,a="recent"),()=>n(4,a="settings"),()=>n(4,a="debug"),()=>c("define-pauser"),()=>c("restart"),()=>c("realign"),function(){u=this.checked,n(5,u)}]}class f extends c.a{constructor(t){var e;super(),document.getElementById("svelte-2rdhge-style")||((e=Object(c.o)("style")).id="svelte-2rdhge-style",e.textContent=".tray.svelte-2rdhge.svelte-2rdhge{margin-top:0.5rem;width:2vw;background:rgba(255, 255, 255, 0.2);position:fixed;right:0;top:0;color:white;height:calc(100% - 5rem);display:flex;flex-direction:column}.tray.svelte-2rdhge>.svelte-2rdhge{visibility:hidden}.tray.svelte-2rdhge.svelte-2rdhge:hover{width:40vw;max-width:40rem;background:#111218;overflow:auto;border-radius:3px}.tray.svelte-2rdhge:hover>.svelte-2rdhge{visibility:visible}.tray.svelte-2rdhge h1.svelte-2rdhge{font-size:2rem;padding:0.5rem 0;border-radius:3px;margin:0}.tray.svelte-2rdhge h2.svelte-2rdhge{text-decoration:underline;margin:0 0 0.4rem}ul.svelte-2rdhge.svelte-2rdhge{list-style:none}a.svelte-2rdhge.svelte-2rdhge{color:white;transform:scaleY(0);transform-origin:top;transition:transform 0.5s ease;font-size:1rem;text-decoration:none}a.svelte-2rdhge.svelte-2rdhge:hover{color:#0aff8c;cursor:pointer;text-decoration:underline}li.svelte-2rdhge.svelte-2rdhge{padding-bottom:0.2rem}li.svelte-2rdhge.svelte-2rdhge:not(:first-of-type)::before{content:' ';position:relative;border:1px solid #7b724e;display:block;margin:0 auto;border-radius:4px}dt.svelte-2rdhge.svelte-2rdhge{font-weight:bold}dd.svelte-2rdhge.svelte-2rdhge{font-style:italic}.tab.svelte-2rdhge.svelte-2rdhge{display:none;text-align:left;padding:2rem;background:#1c1825}.tab-active.svelte-2rdhge.svelte-2rdhge{display:block;flex:1}.tray-tab-buttons.svelte-2rdhge.svelte-2rdhge{margin:0.2rem;border-bottom:2px solid #f47521}",Object(c.c)(document.head,e)),Object(c.t)(this,t,p,d,c.E,{recentSubs:0,subtitles:1,alignment:2,mode:3})}}var j=f;function O(t,e,n){const c=t.slice();return c[11]=e[n],c}function h(t,e,n){const c=t.slice();return c[8]=e[n],c}function x(t){let e,n,r=t[0],s=[];for(let e=0;e<r.length;e+=1)s[e]=v(h(t,r,e));const o=t=>Object(c.M)(s[t],1,1,()=>{s[t]=null});return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=Object(c.p)()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);Object(c.u)(t,e,r),n=!0},p(t,n){if(13&n){let i;for(r=t[0],i=0;i<r.length;i+=1){const o=h(t,r,i);s[i]?(s[i].p(o,n),Object(c.L)(s[i],1)):(s[i]=v(o),s[i].c(),Object(c.L)(s[i],1),s[i].m(e.parentNode,e))}for(Object(c.r)(),i=r.length;i<s.length;i+=1)o(i);Object(c.f)()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)Object(c.L)(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Object(c.M)(s[t]);n=!1},d(t){Object(c.m)(s,t),t&&Object(c.n)(e)}}}function g(t){let e,n=t[8].text+"";return{c(){e=Object(c.I)(n)},m(t,n){Object(c.u)(t,e,n)},p(t,r){1&r&&n!==(n=t[8].text+"")&&Object(c.F)(e,n)},i:c.y,o:c.y,d(t){t&&Object(c.n)(e)}}}function m(t){let e,n,r=t[8].styledText,s=[];for(let e=0;e<r.length;e+=1)s[e]=y(O(t,r,e));const o=t=>Object(c.M)(s[t],1,1,()=>{s[t]=null});return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=Object(c.p)()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);Object(c.u)(t,e,r),n=!0},p(t,n){if(1&n){let i;for(r=t[8].styledText,i=0;i<r.length;i+=1){const o=O(t,r,i);s[i]?(s[i].p(o,n),Object(c.L)(s[i],1)):(s[i]=y(o),s[i].c(),Object(c.L)(s[i],1),s[i].m(e.parentNode,e))}for(Object(c.r)(),i=r.length;i<s.length;i+=1)o(i);Object(c.f)()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)Object(c.L)(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Object(c.M)(s[t]);n=!1},d(t){Object(c.m)(s,t),t&&Object(c.n)(e)}}}function y(t){let e,n,r,o,i,l,a=t[11].text+"";return{c(){e=Object(c.o)("span"),n=Object(c.I)(a),Object(c.e)(e,"style",r=S(t[11]))},m(t,r){Object(c.u)(t,e,r),Object(c.c)(e,n),l=!0},p(t,s){(!l||1&s)&&a!==(a=t[11].text+"")&&Object(c.F)(n,a),(!l||1&s&&r!==(r=S(t[11])))&&Object(c.e)(e,"style",r)},i(n){l||(Object(c.b)(()=>{i&&i.end(1),o||(o=Object(c.j)(e,s.a,t[11].fadeIn)),o.start()}),l=!0)},o(n){o&&o.invalidate(),i=Object(c.k)(e,s.a,t[11].fadeOut),l=!1},d(t){t&&Object(c.n)(e),t&&i&&i.end()}}}function v(t){let e,n,r,s,o,i,l,a;const u=[m,g],b=[];function d(t,e){return t[8].styledText?0:1}function p(...e){return t[7](t[8],...e)}return n=d(t),r=b[n]=u[n](t),{c(){e=Object(c.o)("p"),r.c(),s=Object(c.H)(),Object(c.e)(e,"style",o=t[3](t[8])),Object(c.e)(e,"data-sub-style",i=t[8].style),Object(c.e)(e,"title","click to search this phrase on Jisho.org"),Object(c.e)(e,"class","svelte-ko7cxi")},m(t,r){Object(c.u)(t,e,r),b[n].m(e,null),Object(c.c)(e,s),l=!0,a=Object(c.w)(e,"click",p)},p(a,p){let f=n;n=d(t=a),n===f?b[n].p(t,p):(Object(c.r)(),Object(c.M)(b[f],1,1,()=>{b[f]=null}),Object(c.f)(),r=b[n],r||(r=b[n]=u[n](t),r.c()),Object(c.L)(r,1),r.m(e,s)),(!l||1&p&&o!==(o=t[3](t[8])))&&Object(c.e)(e,"style",o),(!l||1&p&&i!==(i=t[8].style))&&Object(c.e)(e,"data-sub-style",i)},i(t){l||(Object(c.L)(r),l=!0)},o(t){Object(c.M)(r),l=!1},d(t){t&&Object(c.n)(e),b[n].d(),a()}}}function $(t){let e,n,r=t[1]&&x(t);return{c(){e=Object(c.o)("div"),r&&r.c(),Object(c.e)(e,"class","subtitles")},m(t,s){Object(c.u)(t,e,s),r&&r.m(e,null),n=!0},p(t,[n]){t[1]?r?(r.p(t,n),Object(c.L)(r,1)):(r=x(t),r.c(),Object(c.L)(r,1),r.m(e,null)):r&&(Object(c.r)(),Object(c.M)(r,1,1,()=>{r=null}),Object(c.f)())},i(t){n||(Object(c.L)(r),n=!0)},o(t){Object(c.M)(r),n=!1},d(t){t&&Object(c.n)(e),r&&r.d()}}}function w(t){return t.fontScaled?`font-size: ${window.innerHeight>t.fontScalingThreshold?t.fontMax:t.fontScaled}`:""}function k(t){return t.filter(t=>!!t).join(";")}function S(t){return k([t.inline,w(t)])}function C(t,e,n){let{current:c=[]}=e,{styles:s={}}=e,{format:o=""}=e,{visible:i=!0}=e;const l=Object(r.a)();function a(t){l("define-pauser"),window.open(`https://jisho.org/search/${encodeURIComponent(t.trim())}`)}return t.$set=t=>{"current"in t&&n(0,c=t.current),"styles"in t&&n(4,s=t.styles),"format"in t&&n(5,o=t.format),"visible"in t&&n(1,i=t.visible)},[c,i,a,function(t){return"srt"===o?`font-size: ${1.5+1.5*(t.line?t.line:1)}rem; text-shadow: -4px -4px 0px rgba(9, 9, 9, 255), -4px -3px 0px rgba(9, 9, 9, 255), -4px -2px 0px rgba(9, 9, 9, 255), -4px -1px 0px rgba(9, 9, 9, 255), -4px 0px 0px rgba(9, 9, 9, 255), -4px 1px 0px rgba(9, 9, 9, 255), -4px 2px 0px rgba(9, 9, 9, 255), -4px 3px 0px rgba(9, 9, 9, 255), -4px 4px 0px rgba(9, 9, 9, 255), -3px -4px 0px rgba(9, 9, 9, 255), -3px -3px 0px rgba(9, 9, 9, 255), -3px -2px 0px rgba(9, 9, 9, 255), -3px -1px 0px rgba(9, 9, 9, 255), -3px 0px 0px rgba(9, 9, 9, 255), -3px 1px 0px rgba(9, 9, 9, 255), -3px 2px 0px rgba(9, 9, 9, 255), -3px 3px 0px rgba(9, 9, 9, 255), -3px 4px 0px rgba(9, 9, 9, 255), -2px -4px 0px rgba(9, 9, 9, 255), -2px -3px 0px rgba(9, 9, 9, 255), -2px -2px 0px rgba(9, 9, 9, 255), -2px -1px 0px rgba(9, 9, 9, 255), -2px 0px 0px rgba(9, 9, 9, 255), -2px 1px 0px rgba(9, 9, 9, 255), -2px 2px 0px rgba(9, 9, 9, 255), -2px 3px 0px rgba(9, 9, 9, 255), -2px 4px 0px rgba(9, 9, 9, 255), -1px -4px 0px rgba(9, 9, 9, 255), -1px -3px 0px rgba(9, 9, 9, 255), -1px -2px 0px rgba(9, 9, 9, 255), -1px -1px 0px rgba(9, 9, 9, 255), -1px 0px 0px rgba(9, 9, 9, 255), -1px 1px 0px rgba(9, 9, 9, 255), -1px 2px 0px rgba(9, 9, 9, 255), -1px 3px 0px rgba(9, 9, 9, 255), -1px 4px 0px rgba(9, 9, 9, 255), 0px -4px 0px rgba(9, 9, 9, 255), 0px -3px 0px rgba(9, 9, 9, 255), 0px -2px 0px rgba(9, 9, 9, 255), 0px -1px 0px rgba(9, 9, 9, 255), 0px 0px 0px rgba(9, 9, 9, 255), 0px 1px 0px rgba(9, 9, 9, 255), 0px 2px 0px rgba(9, 9, 9, 255), 0px 3px 0px rgba(9, 9, 9, 255), 0px 4px 0px rgba(9, 9, 9, 255), 1px -4px 0px rgba(9, 9, 9, 255), 1px -3px 0px rgba(9, 9, 9, 255), 1px -2px 0px rgba(9, 9, 9, 255), 1px -1px 0px rgba(9, 9, 9, 255), 1px 0px 0px rgba(9, 9, 9, 255), 1px 1px 0px rgba(9, 9, 9, 255), 1px 2px 0px rgba(9, 9, 9, 255), 1px 3px 0px rgba(9, 9, 9, 255), 1px 4px 0px rgba(9, 9, 9, 255), 2px -4px 0px rgba(9, 9, 9, 255), 2px -3px 0px rgba(9, 9, 9, 255), 2px -2px 0px rgba(9, 9, 9, 255), 2px -1px 0px rgba(9, 9, 9, 255), 2px 0px 0px rgba(9, 9, 9, 255), 2px 1px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(9, 9, 9, 255), 2px 3px 0px rgba(9, 9, 9, 255), 2px 4px 0px rgba(9, 9, 9, 255), 3px -4px 0px rgba(9, 9, 9, 255), 3px -3px 0px rgba(9, 9, 9, 255), 3px -2px 0px rgba(9, 9, 9, 255), 3px -1px 0px rgba(9, 9, 9, 255), 3px 0px 0px rgba(9, 9, 9, 255), 3px 1px 0px rgba(9, 9, 9, 255), 3px 2px 0px rgba(9, 9, 9, 255), 3px 3px 0px rgba(9, 9, 9, 255), 3px 4px 0px rgba(9, 9, 9, 255), 4px -4px 0px rgba(9, 9, 9, 255), 4px -3px 0px rgba(9, 9, 9, 255), 4px -2px 0px rgba(9, 9, 9, 255), 4px -1px 0px rgba(9, 9, 9, 255), 4px 0px 0px rgba(9, 9, 9, 255), 4px 1px 0px rgba(9, 9, 9, 255), 4px 2px 0px rgba(9, 9, 9, 255), 4px 3px 0px rgba(9, 9, 9, 255), 4px 4px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(20, 20, 20, 195)`:"ass"===o&&t.style in s?k([s[t.style].inline,w(s[t.style]),t.inline||"",w(t)]):void 0},s,o,l,t=>a(t.text)]}class M extends c.a{constructor(t){var e;super(),document.getElementById("svelte-ko7cxi-style")||((e=Object(c.o)("style")).id="svelte-ko7cxi-style",e.textContent='p.svelte-ko7cxi{cursor:pointer;color:white;margin:0;padding:0;white-space:pre;font-family:"Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif}p.svelte-ko7cxi:hover{color:#0aff8c !important}',Object(c.c)(document.head,e)),Object(c.t)(this,t,C,$,c.E,{current:0,styles:4,format:5,visible:1})}}var H=M;class I{constructor(){this.video=null,this.reasons=[]}setVideo(t){this.reasons=[],this.video=t}addPauser(t){this.reasons.includes("user-paused")&&!this.video.paused&&this.reasons.splice(this.reasons.indexOf("user-paused")),0===this.reasons.length&&this.video.paused&&this.reasons.push("user-paused"),this.reasons.push(t),this._checkPause()}removePauser(t){const e=this.reasons.indexOf(t);-1!==e&&(this.reasons.splice(e,1),this._checkPause())}_checkPause(){this.reasons.length?this.video.pause():this.video.play()}}var E=n(6),N=n.n(E),L=n(5),P=n.n(L);class _ extends P.a{constructor(t,e){super("srt",e);const n=t.replace(/\r/g,"").split("\n\n");this.subs=n.reduce((t,e)=>{let n=e.trim().split("\n");function c(){n.shift()}try{/^\d*$/.test(n[0])&&c();let[e,r]=n[0].replace(/,/g,".").match(/^([\d:\.\-> ]*)/)[0].split(/\-\->/),s=n[0].match(/([a-zA-Z].*)/);s=s&&s.length?s[1]:"";const o=(t=>{const e=s.match(new RegExp(`${t}:([\\d\\.]*)%`));if(e)return parseInt(e[1],10)/100})("line")||1;c(),t.push({start:this.timeToMs(e),end:this.timeToMs(r),text:n.join("\n").replace(/<\/?c.Japanese>/g,""),line:o})}catch(t){}return t},[])}serialize(){return JSON.stringify(this.subs,null,4)}debugInfo(){return[{title:"Number of subtitles",detail:this.subs.length}]}}function F(t){let e,n,r,s,o,i,l;return{c(){e=Object(c.o)("div"),n=Object(c.o)("button"),n.textContent="⨯ Skip Subtitling For This Episode",r=Object(c.H)(),s=Object(c.o)("label"),s.textContent="≡ Select a subtitle file to begin",o=Object(c.H)(),i=Object(c.o)("input"),Object(c.e)(n,"class","small-button svelte-1n5tabm"),Object(c.e)(s,"for","srt-upload"),Object(c.e)(s,"class","svelte-1n5tabm"),Object(c.e)(i,"type","file"),Object(c.e)(i,"id","srt-upload"),Object(c.e)(i,"accept",".srt,.ass,.ssa"),Object(c.e)(i,"class","svelte-1n5tabm"),Object(c.e)(e,"class","column svelte-1n5tabm")},m(a,u){Object(c.u)(a,e,u),Object(c.c)(e,n),Object(c.c)(e,r),Object(c.c)(e,s),Object(c.c)(e,o),Object(c.c)(e,i),l=[Object(c.w)(n,"click",t[1]),Object(c.w)(i,"change",t[0])]},p:c.y,i:c.y,o:c.y,d(t){t&&Object(c.n)(e),Object(c.D)(l)}}}function T(t){const e=Object(r.a)();return[function(t){const n=t.target.files[0],c=new FileReader;c.onload=t=>{const c={ass:N.a,ssa:N.a,srt:_},[r,s]=n.name.match(/\.(\w{3})$/);e("subtitles-loaded",new c[s](t.target.result,n.name))},c.readAsText(n)},function(){e("cancel")}]}class R extends c.a{constructor(t){var e;super(),document.getElementById("svelte-1n5tabm-style")||((e=Object(c.o)("style")).id="svelte-1n5tabm-style",e.textContent=".column.svelte-1n5tabm.svelte-1n5tabm{display:flex;flex-direction:column}.column.svelte-1n5tabm>.svelte-1n5tabm{align-self:center;margin:0.5rem}label.svelte-1n5tabm.svelte-1n5tabm{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;display:inline-block;font-size:1.2rem}label.svelte-1n5tabm.svelte-1n5tabm:hover{background:#ffea6d}input.svelte-1n5tabm.svelte-1n5tabm{display:none}",Object(c.c)(document.head,e)),Object(c.t)(this,t,T,F,c.E,{})}}var A=R;const{document:z}=c.q;function B(t){let e,n,r,s,o,i,l,a,u,b,d,p,f,j,O,h,x="number"==typeof t[3]&&!isNaN(t[3]),g=t[0].text+"",m=x&&function(t){let e,n,r,s,o,i,l,a=t[4]()+"";return{c(){e=Object(c.o)("button"),n=Object(c.I)("Use the last alignment for "),r=Object(c.o)("span"),r.textContent=`${t[2]}`,s=Object(c.I)(" ("),o=Object(c.I)(a),i=Object(c.I)(")"),Object(c.e)(r,"class","show-name svelte-n31nxo"),Object(c.e)(e,"class","svelte-n31nxo")},m(a,u){Object(c.u)(a,e,u),Object(c.c)(e,n),Object(c.c)(e,r),Object(c.c)(e,s),Object(c.c)(e,o),Object(c.c)(e,i),l=Object(c.w)(e,"click",t[5])},p:c.y,d(t){t&&Object(c.n)(e),l()}}}(t);return{c(){e=Object(c.o)("div"),n=Object(c.o)("button"),n.textContent="↺ Reselect Subtitles",r=Object(c.H)(),s=Object(c.o)("div"),m&&m.c(),o=Object(c.H)(),i=Object(c.o)("button"),i.innerHTML="No alignment adjustment<br>(use when you know the subtitles are timed properly)",l=Object(c.H)(),a=Object(c.o)("button"),a.textContent="Enter alignment manually",u=Object(c.H)(),b=Object(c.o)("button"),d=Object(c.I)("⇌ Click when the first line is said:\n\t\t"),p=Object(c.o)("br"),f=Object(c.H)(),j=Object(c.o)("pre"),O=Object(c.I)(g),Object(c.e)(n,"class","small-button svelte-n31nxo"),Object(c.e)(i,"class","svelte-n31nxo"),Object(c.e)(a,"class","svelte-n31nxo"),Object(c.e)(s,"class","row svelte-n31nxo"),Object(c.e)(b,"class","svelte-n31nxo"),Object(c.e)(e,"class","alignment-buttons svelte-n31nxo")},m(x,g){Object(c.u)(x,e,g),Object(c.c)(e,n),Object(c.c)(e,r),Object(c.c)(e,s),m&&m.m(s,null),Object(c.c)(s,o),Object(c.c)(s,i),Object(c.c)(s,l),Object(c.c)(s,a),Object(c.c)(e,u),Object(c.c)(e,b),Object(c.c)(b,d),Object(c.c)(b,p),Object(c.c)(b,f),Object(c.c)(b,j),Object(c.c)(j,O),h=[Object(c.w)(n,"click",t[11]),Object(c.w)(i,"click",t[12]),Object(c.w)(a,"click",t[6]),Object(c.w)(b,"click",t[7])]},p(t,[e]){x&&m.p(t,e),1&e&&g!==(g=t[0].text+"")&&Object(c.F)(O,g)},i:c.y,o:c.y,d(t){t&&Object(c.n)(e),m&&m.d(),Object(c.D)(h)}}}function K(t,e,n){let{firstSubtitle:c={}}=e;const s=Object(r.a)(),o=document.querySelector(".video-title"),i=o?o.textContent:"",l=`last-used-alignment-${i}`,a=parseInt(GM_getValue(l),10),u=(a/1e3).toFixed(1);function b(t){const e=document.querySelector("video"),n="number"==typeof t?t:1e3*e.currentTime-c.start-400;GM_setValue(l,n),s("set-align",n)}return t.$set=t=>{"firstSubtitle"in t&&n(0,c=t.firstSubtitle)},[c,s,i,a,function(){return 0===a?"no adjustment":a>0?`subtitles delayed by ${u} seconds`:`subtitles hastened by ${Math.abs(u)} seconds`},function(){b(a)},function(){const t=parseFloat(prompt("Enter an alignment in seconds. Positive numbers are for when the subtitles need to be delayed (subtitle file starts too soon). \nNegative numbers will play the subtitles earlier (subtitle file is too late).",u||""));isNaN(t)||b(1e3*t)},b,o,l,u,()=>s("reselect"),()=>b(0)]}class D extends c.a{constructor(t){var e;super(),z.getElementById("svelte-n31nxo-style")||((e=Object(c.o)("style")).id="svelte-n31nxo-style",e.textContent=".alignment-buttons.svelte-n31nxo.svelte-n31nxo{display:flex;flex-direction:column}.alignment-buttons.svelte-n31nxo button.svelte-n31nxo{margin:0.5rem;align-self:center}.row.svelte-n31nxo.svelte-n31nxo{display:flex;flex-direction:row;justify-content:center}.row.svelte-n31nxo button.svelte-n31nxo{max-width:15rem}.show-name.svelte-n31nxo.svelte-n31nxo{font-style:italic}",Object(c.c)(z.head,e)),Object(c.t)(this,t,K,B,c.E,{firstSubtitle:0})}}var G=D;const{document:q}=c.q;function J(t){let e;const n=new j({props:{mode:"cancelled"}});return n.$on("restart",t[7]),{c(){Object(c.i)(n.$$.fragment)},m(t,r){Object(c.x)(n,t,r),e=!0},p:c.y,i(t){e||(Object(c.L)(n.$$.fragment,t),e=!0)},o(t){Object(c.M)(n.$$.fragment,t),e=!1},d(t){Object(c.l)(n,t)}}}function W(t){let e,n;const r=new H({props:{format:t[2].format,styles:t[2].styles,current:t[1],currentTime:t[6],visible:t[5]}});r.$on("define-pauser",t[11]);const s=new j({props:{recentSubs:t[4],subtitles:t[2],alignment:t[3]}});return s.$on("restart",t[7]),s.$on("tray-pauser",t[10]),s.$on("define-pauser",t[11]),s.$on("realign",t[19]),s.$on("show-subs",t[20]),{c(){Object(c.i)(r.$$.fragment),e=Object(c.H)(),Object(c.i)(s.$$.fragment)},m(t,o){Object(c.x)(r,t,o),Object(c.u)(t,e,o),Object(c.x)(s,t,o),n=!0},p(t,e){const n={};4&e&&(n.format=t[2].format),4&e&&(n.styles=t[2].styles),2&e&&(n.current=t[1]),32&e&&(n.visible=t[5]),r.$set(n);const c={};16&e&&(c.recentSubs=t[4]),4&e&&(c.subtitles=t[2]),8&e&&(c.alignment=t[3]),s.$set(c)},i(t){n||(Object(c.L)(r.$$.fragment,t),Object(c.L)(s.$$.fragment,t),n=!0)},o(t){Object(c.M)(r.$$.fragment,t),Object(c.M)(s.$$.fragment,t),n=!1},d(t){Object(c.l)(r,t),t&&Object(c.n)(e),Object(c.l)(s,t)}}}function V(t){let e;const n=new G({props:{firstSubtitle:t[2].firstSubtitle()}});return n.$on("set-align",t[8]),n.$on("reselect",t[18]),{c(){Object(c.i)(n.$$.fragment)},m(t,r){Object(c.x)(n,t,r),e=!0},p(t,e){const c={};4&e&&(c.firstSubtitle=t[2].firstSubtitle()),n.$set(c)},i(t){e||(Object(c.L)(n.$$.fragment,t),e=!0)},o(t){Object(c.M)(n.$$.fragment,t),e=!1},d(t){Object(c.l)(n,t)}}}function U(t){let e;const n=new A({});return n.$on("subtitles-loaded",t[9]),n.$on("cancel",t[17]),{c(){Object(c.i)(n.$$.fragment)},m(t,r){Object(c.x)(n,t,r),e=!0},p:c.y,i(t){e||(Object(c.L)(n.$$.fragment,t),e=!0)},o(t){Object(c.M)(n.$$.fragment,t),e=!1},d(t){Object(c.l)(n,t)}}}function Y(t){let e,n,r,s;const o=[U,V,W,J],i=[];function l(t,e){return"prompt"===t[0]?0:"align"===t[0]?1:"play"===t[0]?2:"cancelled"===t[0]?3:-1}return~(n=l(t))&&(r=i[n]=o[n](t)),{c(){e=Object(c.o)("div"),r&&r.c(),Object(c.e)(e,"class","subtitles-app svelte-1noo31a")},m(t,r){Object(c.u)(t,e,r),~n&&i[n].m(e,null),s=!0},p(t,[s]){let a=n;n=l(t),n===a?~n&&i[n].p(t,s):(r&&(Object(c.r)(),Object(c.M)(i[a],1,1,()=>{i[a]=null}),Object(c.f)()),~n?(r=i[n],r||(r=i[n]=o[n](t),r.c()),Object(c.L)(r,1),r.m(e,null)):r=null)},i(t){s||(Object(c.L)(r),s=!0)},o(t){Object(c.M)(r),s=!1},d(t){t&&Object(c.n)(e),~n&&i[n].d()}}}function X(t,e,n){const c=new I;let s="prompt",o=[],i=null,l=null,a=-1,u=[],b=!0;function d(){n(0,s="prompt"),n(2,i=null),n(1,o=[])}function p(t){let e=t[t.length-1],c=u[u.length-1];!e||c&&e.text===c.text||n(4,u=[...u,e]),u.length>10&&n(4,u=u.slice(u.length-10))}function f(){"play"===s&&(n(1,o=i.getSubs(1e3*l.currentTime-a)),p(o),requestAnimationFrame(f))}Object(r.b)(()=>{document.addEventListener("visibilitychange",()=>{document.hidden||c.removePauser("define")});let t="";setInterval(()=>{const e=document.querySelector("video").getAttribute("src");e&&e!==t&&(t=e,d())},50)});return[s,o,i,a,u,b,"",d,function(t){l=document.querySelector("video"),c.setVideo(l),n(3,a=t.detail),n(4,u=[]),n(0,s="play"),f()},function(t){n(2,i=t.detail),0===i.subs.length?(console.log("subtitles object failed to parse: ",i),alert(`No subtitles were parsed from the selected .${i.format} file, verify nothing is wrong with the file. If it appears normal please submit a bug report with the episode and the subtitles file you used to the issue tracker!`)):n(0,s="align")},function(t){t.detail?c.addPauser("tray"):c.removePauser("tray")},function(){c.addPauser("define")},l,"last-used-alignment",c,p,f,()=>n(0,s="cancelled"),()=>n(0,s="prompt"),()=>n(0,s="align"),t=>n(5,b=t.detail)]}class Z extends c.a{constructor(t){var e;super(),q.getElementById("svelte-1noo31a-style")||((e=Object(c.o)("style")).id="svelte-1noo31a-style",e.textContent=".subtitles-app.svelte-1noo31a{position:relative}.subtitles-app.svelte-1noo31a>*{z-index:1000000000}.subtitles-app.svelte-1noo31a button{background:#fd0;border:none;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;font-size:0.9rem}.subtitles-app.svelte-1noo31a .small-button{font-size:0.6rem}.subtitles-app.svelte-1noo31a button:disabled{background:#2a3450}.subtitles-app.svelte-1noo31a button:not(:disabled):hover{background:#ffea6d;cursor:pointer}",Object(c.c)(q.head,e)),Object(c.t)(this,t,X,Y,c.E,{})}}var Q=Z;const tt=document.createElement("div");document.body.appendChild(tt),tt.id="sheodox-vrv-subtitler",tt.style.height="100%",tt.style.width="100%";new Q({target:tt})}]);
