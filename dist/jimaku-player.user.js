// ==UserScript==
// @name         字幕プレーヤー
// @namespace    https://github.com/sheodox
// @version      0.1.33
// @description  Study Japanese by using Japanese subtitles on VRV!
// @author       sheodox
// @match        https://static.vrv.co/vilos/player.html
// @match        https://static.crunchyroll.com/vilos-v2/web/vilos/player.html
// @grant        GM_getValue
// @grant        GM_setValue
// ==/UserScript==

!function(t){var e={};function n(s){if(e[s])return e[s].exports;var c=e[s]={i:s,l:!1,exports:{}};return t[s].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)n.d(s,c,function(e){return t[e]}.bind(null,c));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e,n){"use strict";function s(){}n.d(e,"a",(function(){return Pt})),n.d(e,"b",(function(){return it})),n.d(e,"c",(function(){return K})),n.d(e,"d",(function(){return x})),n.d(e,"e",(function(){return r})),n.d(e,"f",(function(){return B})),n.d(e,"g",(function(){return nt})),n.d(e,"h",(function(){return mt})),n.d(e,"i",(function(){return f})),n.d(e,"j",(function(){return tt})),n.d(e,"k",(function(){return L})),n.d(e,"l",(function(){return kt})),n.d(e,"m",(function(){return Bt})),n.d(e,"n",(function(){return wt})),n.d(e,"o",(function(){return $t})),n.d(e,"p",(function(){return Nt})),n.d(e,"q",(function(){return w})),n.d(e,"r",(function(){return y})),n.d(e,"s",(function(){return $})),n.d(e,"t",(function(){return q})),n.d(e,"u",(function(){return qt})),n.d(e,"v",(function(){return V})),n.d(e,"w",(function(){return d})),n.d(e,"x",(function(){return zt})),n.d(e,"y",(function(){return gt})),n.d(e,"z",(function(){return c})),n.d(e,"A",(function(){return _t})),n.d(e,"B",(function(){return v})),n.d(e,"C",(function(){return a})),n.d(e,"D",(function(){return C})),n.d(e,"E",(function(){return m})),n.d(e,"F",(function(){return Ut})),n.d(e,"G",(function(){return s})),n.d(e,"H",(function(){return j})),n.d(e,"I",(function(){return Q})),n.d(e,"J",(function(){return Z})),n.d(e,"K",(function(){return St})),n.d(e,"L",(function(){return A})),n.d(e,"M",(function(){return O})),n.d(e,"N",(function(){return i})),n.d(e,"O",(function(){return b})),n.d(e,"P",(function(){return R})),n.d(e,"Q",(function(){return G})),n.d(e,"R",(function(){return _})),n.d(e,"S",(function(){return P})),n.d(e,"T",(function(){return E})),n.d(e,"U",(function(){return S})),n.d(e,"V",(function(){return u})),n.d(e,"W",(function(){return k})),n.d(e,"X",(function(){return z})),n.d(e,"Y",(function(){return N})),n.d(e,"Z",(function(){return M})),n.d(e,"ab",(function(){return xt})),n.d(e,"bb",(function(){return vt})),n.d(e,"cb",(function(){return Ct})),n.d(e,"db",(function(){return U}));const c=t=>t;function r(t,e){for(const n in e)t[n]=e[n];return t}function o(t){return t()}function l(){return Object.create(null)}function i(t){t.forEach(o)}function a(t){return"function"==typeof t}function b(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function u(t,...e){if(null==t)return s;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function d(t){let e;return u(t,t=>e=t)(),e}function f(t,e,n){t.$$.on_destroy.push(u(e,n))}const p="undefined"!=typeof window;let j=p?()=>window.performance.now():()=>Date.now(),O=p?t=>requestAnimationFrame(t):s;const h=new Set;function g(t){h.forEach(e=>{e.c(t)||(h.delete(e),e.f())}),0!==h.size&&O(g)}function m(t){let e;return 0===h.size&&O(g),{promise:new Promise(n=>{h.add(e={c:t,f:n})}),abort(){h.delete(e)}}}function x(t,e){t.appendChild(e)}function v(t,e,n){t.insertBefore(e,n||null)}function y(t){t.parentNode.removeChild(t)}function w(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function $(t){return document.createElement(t)}function k(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function z(t){return document.createTextNode(t)}function S(){return z(" ")}function q(){return z("")}function C(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function A(t){return function(e){return e.preventDefault(),t.call(this,e)}}function B(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function U(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function N(t){return""===t?void 0:+t}function _(t,e){e=""+e,t.data!==e&&(t.data=e)}function P(t,e){(null!=e||t.value)&&(t.value=e)}function E(t,e,n,s){t.style.setProperty(e,n,s?"important":"")}function R(t,e){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e)return void(s.selected=!0)}}function G(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function M(t,e,n){t.classList[n?"add":"remove"](e)}function D(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let F,T,I=0,H={};function X(t,e,n,s,c,r,o,l=0){const i=16.666/s;let a="{\n";for(let t=0;t<=1;t+=i){const s=e+(n-e)*r(t);a+=100*t+`%{${o(s,1-s)}}\n`}const b=a+`100% {${o(n,1-n)}}\n}`,u=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(b)}_${l}`;if(!H[u]){if(!F){const t=$("style");document.head.appendChild(t),F=t.sheet}H[u]=!0,F.insertRule(`@keyframes ${u} ${b}`,F.cssRules.length)}const d=t.style.animation||"";return t.style.animation=`${d?`${d}, `:""}${u} ${s}ms linear ${c}ms 1 both`,I+=1,u}function W(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--I&&O(()=>{if(I)return;let t=F.cssRules.length;for(;t--;)F.deleteRule(t);H={}})}function L(t,e,n,r){if(!e)return s;const o=t.getBoundingClientRect();if(e.left===o.left&&e.right===o.right&&e.top===o.top&&e.bottom===o.bottom)return s;const{delay:l=0,duration:i=300,easing:a=c,start:b=j()+l,end:u=b+i,tick:d=s,css:f}=n(t,{from:e,to:o},r);let p,O=!0,h=!1;function g(){f&&W(t,p),O=!1}return m(t=>{if(!h&&t>=b&&(h=!0),h&&t>=u&&(d(1,0),g()),!O)return!1;if(h){const e=0+1*a((t-b)/i);d(e,1-e)}return!0}),f&&(p=X(t,0,1,i,l,a,f)),l||(h=!0),d(0,1),g}function V(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:s}=e,c=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=s,K(t,c)}}function K(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const s=getComputedStyle(t),c="none"===s.transform?"":s.transform;t.style.transform=`${c} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function J(t){T=t}function Y(){if(!T)throw new Error("Function called outside component initialization");return T}function Z(t){Y().$$.on_mount.push(t)}function Q(t){Y().$$.on_destroy.push(t)}function tt(){const t=Y();return(e,n)=>{const s=t.$$.callbacks[e];if(s){const c=D(e,n);s.slice().forEach(e=>{e.call(t,c)})}}}const et=[],nt=[],st=[],ct=[],rt=Promise.resolve();let ot=!1;function lt(){ot||(ot=!0,rt.then(ut))}function it(t){st.push(t)}let at=!1;const bt=new Set;function ut(){if(!at){at=!0;do{for(let t=0;t<et.length;t+=1){const e=et[t];J(e),dt(e.$$)}for(et.length=0;nt.length;)nt.pop()();for(let t=0;t<st.length;t+=1){const e=st[t];bt.has(e)||(bt.add(e),e())}st.length=0}while(et.length);for(;ct.length;)ct.pop()();ot=!1,at=!1,bt.clear()}}function dt(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(it)}}let ft;function pt(){return ft||(ft=Promise.resolve(),ft.then(()=>{ft=null})),ft}function jt(t,e,n){t.dispatchEvent(D(`${e?"intro":"outro"}${n}`))}const Ot=new Set;let ht;function gt(){ht={r:0,c:[],p:ht}}function mt(){ht.r||i(ht.c),ht=ht.p}function xt(t,e){t&&t.i&&(Ot.delete(t),t.i(e))}function vt(t,e,n,s){if(t&&t.o){if(Ot.has(t))return;Ot.add(t),ht.c.push(()=>{Ot.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}}const yt={duration:0};function wt(t,e,n){let r,o,l=e(t,n),i=!1,b=0;function u(){r&&W(t,r)}function d(){const{delay:e=0,duration:n=300,easing:a=c,tick:d=s,css:f}=l||yt;f&&(r=X(t,0,1,n,e,a,f,b++)),d(0,1);const p=j()+e,O=p+n;o&&o.abort(),i=!0,it(()=>jt(t,!0,"start")),o=m(e=>{if(i){if(e>=O)return d(1,0),jt(t,!0,"end"),u(),i=!1;if(e>=p){const t=a((e-p)/n);d(t,1-t)}}return i})}let f=!1;return{start(){f||(W(t),a(l)?(l=l(),pt().then(d)):d())},invalidate(){f=!1},end(){i&&(u(),i=!1)}}}function $t(t,e,n){let r,o=e(t,n),l=!0;const b=ht;function u(){const{delay:e=0,duration:n=300,easing:a=c,tick:u=s,css:d}=o||yt;d&&(r=X(t,1,0,n,e,a,d));const f=j()+e,p=f+n;it(()=>jt(t,!1,"start")),m(e=>{if(l){if(e>=p)return u(0,1),jt(t,!1,"end"),--b.r||i(b.c),!1;if(e>=f){const t=a((e-f)/n);u(1-t,t)}}return l})}return b.r+=1,a(o)?pt().then(()=>{o=o(),u()}):u(),{end(e){e&&o.tick&&o.tick(1,0),l&&(r&&W(t,r),l=!1)}}}function kt(t,e,n,r){let o=e(t,n),l=r?0:1,b=null,u=null,d=null;function f(){d&&W(t,d)}function p(t,e){const n=t.b-l;return e*=Math.abs(n),{a:l,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function O(e){const{delay:n=0,duration:r=300,easing:a=c,tick:O=s,css:h}=o||yt,g={start:j()+n,b:e};e||(g.group=ht,ht.r+=1),b?u=g:(h&&(f(),d=X(t,l,e,r,n,a,h)),e&&O(0,1),b=p(g,r),it(()=>jt(t,e,"start")),m(e=>{if(u&&e>u.start&&(b=p(u,r),u=null,jt(t,b.b,"start"),h&&(f(),d=X(t,l,b.b,b.duration,0,a,o.css))),b)if(e>=b.end)O(l=b.b,1-l),jt(t,b.b,"end"),u||(b.b?f():--b.group.r||i(b.group.c)),b=null;else if(e>=b.start){const t=e-b.start;l=b.a+b.d*a(t/b.duration),O(l,1-l)}return!(!b&&!u)}))}return{run(t){a(o)?pt().then(()=>{o=o(),O(t)}):O(t)},end(){f(),b=u=null}}}const zt="undefined"!=typeof window?window:global;function St(t,e){vt(t,1,1,()=>{e.delete(t.key)})}function qt(t,e){t.f(),St(t,e)}function Ct(t,e,n,s,c,r,o,l,i,a,b,u){let d=t.length,f=r.length,p=d;const j={};for(;p--;)j[t[p].key]=p;const O=[],h=new Map,g=new Map;for(p=f;p--;){const t=u(c,r,p),l=n(t);let i=o.get(l);i?s&&i.p(t,e):(i=a(l,t),i.c()),h.set(l,O[p]=i),l in j&&g.set(l,Math.abs(p-j[l]))}const m=new Set,x=new Set;function v(t){xt(t,1),t.m(l,b),o.set(t.key,t),b=t.first,f--}for(;d&&f;){const e=O[f-1],n=t[d-1],s=e.key,c=n.key;e===n?(b=e.first,d--,f--):h.has(c)?!o.has(s)||m.has(s)?v(e):x.has(c)?d--:g.get(s)>g.get(c)?(x.add(s),v(e)):(m.add(c),d--):(i(n,o),d--)}for(;d--;){const e=t[d];h.has(e.key)||i(e,o)}for(;f;)v(O[f-1]);return O}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let At;function Bt(t){t&&t.c()}function Ut(t,e,n){const{fragment:s,on_mount:c,on_destroy:r,after_update:l}=t.$$;s&&s.m(e,n),it(()=>{const e=c.map(o).filter(a);r?r.push(...e):i(e),t.$$.on_mount=[]}),l.forEach(it)}function Nt(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function _t(t,e,n,c,r,o,a=[-1]){const b=T;J(t);const u=e.props||{},d=t.$$={fragment:null,ctx:null,props:o,update:s,not_equal:r,bound:l(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(b?b.$$.context:[]),callbacks:l(),dirty:a};let f=!1;d.ctx=n?n(t,u,(e,n,...s)=>{const c=s.length?s[0]:n;return d.ctx&&r(d.ctx[e],d.ctx[e]=c)&&(d.bound[e]&&d.bound[e](c),f&&function(t,e){-1===t.$$.dirty[0]&&(et.push(t),lt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],d.update(),f=!0,i(d.before_update),d.fragment=!!c&&c(d.ctx),e.target&&(e.hydrate?d.fragment&&d.fragment.l(function(t){return Array.from(t.childNodes)}(e.target)):d.fragment&&d.fragment.c(),e.intro&&xt(t.$$.fragment),Ut(t,e.target,e.anchor),ut()),J(b)}"function"==typeof HTMLElement&&(At=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){Nt(this,1),this.$destroy=s}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}});class Pt{$destroy(){Nt(this,1),this.$destroy=s}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return r}));var s=n(0);function c(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function r(t){const e=t-1;return e*e*e+1}n.d(e,"c",(function(){return s.z}))},function(t,e,n){"use strict";var s=n(0);n.d(e,"a",(function(){return s.j})),n.d(e,"b",(function(){return s.I})),n.d(e,"c",(function(){return s.J}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return r}));var s=n(1);n(0);function c(t,{delay:e=0,duration:n=400,easing:c=s.c}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:c,css:t=>`opacity: ${t*r}`}}function r(t,{delay:e=0,duration:n=400,easing:c=s.b,x:r=0,y:o=0,opacity:l=0}){const i=getComputedStyle(t),a=+i.opacity,b="none"===i.transform?"":i.transform,u=a*(1-l);return{delay:e,duration:n,easing:c,css:(t,e)=>`\n\t\t\ttransform: ${b} translate(${(1-t)*r}px, ${(1-t)*o}px);\n\t\t\topacity: ${a-u*e}`}}},,,,function(t,e){t.exports=class{constructor(t,e){this.format=t,this.fileName=e,this.subs=[]}getSubs(t){return this.subs.filter(e=>e.start<=t&&e.end>=t)}timeToMs(t){const[e,n,s]=t.split(":");return 36e5*+e+6e4*+n+1e3*parseFloat(s)}getAlignmentCandidates(){return this.subs.sort((t,e)=>t.start-e.end).slice(0,20)}}},function(t,e,n){const s=n(7),c=t=>(t.charAt(0).toLowerCase()+t.substring(1)).replace(" ",""),r=t=>{if(t){t=(t=t.replace(/[&H]/g,"")).padStart(8,"0");const[e,n,s,c,r]=t.match(/([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i),o=t=>parseInt(t,16);return`rgba(${o(r)}, ${o(c)}, ${o(s)}, ${255-o(n)})`}},o=(t,e,n="transparent",s=0,c=0)=>{const r=t||n;s*=2,c=`${c}px`;const o=[];for(let t=-1*(e=2*(void 0===e?1:e));t<=e;t++)for(let n=-1*e;n<=e;n++)o.push(`${t}px ${n}px ${c} ${r}`);return`text-shadow: ${o.join(", ")}, ${s}px ${s}px ${c} ${n}`},l=t=>`font-family: "${t}", "Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif`;function i(t,e,n=!1){const s=new RegExp(n?`\\\\${e}\\((.*?)\\)`:`\\\\${e}([^\\\\}]*)`),c=t.match(s);if(c)return{overrides:t.replace(c[0],""),params:n?c[1].split(","):c[1]}}t.exports=class extends s{constructor(t,e){super("ass",e),t=t.replace(/\r\n/g,"\n");try{this.blocks=this.parseBlocks(t),this.subs=this.parseBlock(this.blocks.subs),this.parseInfo(this.blocks.info),this.parseSubTimings(),this.parseStyles(this.parseBlock(this.blocks.styles)),this.parseSubOverrideTags()}catch(t){console.error("ASS PARSE ERROR",t),this.subs=[]}}serialize(){return JSON.stringify({info:this.info,styles:this.styles,subs:this.subs},null,4)}debugInfo(){return[{title:"Number of styles",detail:Object.keys(this.styles).length},{title:"Number of subtitles",detail:this.subs.length}]}parseInfo(){this.info={},this.blocks.info.split("\n").forEach(t=>{const[e,n]=t.split(": ");this.info[c(e)]=n})}scaleHeight(t){return`${t/+this.info.playResY*100}vh`}scaleWidth(t){return`${t/+this.info.playResX*100}vw`}parseBlocks(t){const e=t.split(/\n(?=\[)/),n=t=>e.find(e=>{e=e.trim();const[n,s]=e.match(/^\[(.*?)]/);return s===t}).replace(/.*\n/,"").trim();return{info:n("Script Info"),styles:n("V4+ Styles"),subs:n("Events")}}parseBlock(t){const[e,...n]=t.split("\n"),s=(t,e=1/0)=>{let[n,s,c]=t.match(/(\w*): (.*)/);return c=c.split(","),c.length>e&&(c[e-1]=c.slice(e-1).join(","),c.splice(e,1/0)),{type:s,attributes:c}},r=s(e);return n.reduce((t,e)=>{if(!e||";"===e.charAt(0)||0===e.indexOf("Comment: "))return t;const n=s(e,r.attributes.length),o={dataType:n.type.toLowerCase()};return r.attributes.forEach((t,e)=>{t=t.trim();const s=c(t);o[s]=n.attributes[e]}),o.style="*Default"===o.style?"Default":o.style,t.push(o),t},[])}parseSubTimings(){this.subs.forEach(t=>{t.start=this.timeToMs(t.start),t.end=this.timeToMs(t.end)})}parseStyles(t){const e={};t.forEach(t=>{for(const e of Object.keys(t).filter(t=>/colour/i.test(t)))t[e]=r(t[e]);t.name="*Default"===t.name?"Default":t.name;const n=[],{primaryColour:s,secondaryColour:c,outlineColour:i,backColour:a,borderStyle:b,outline:u,shadow:d,fontname:f,fontsize:p,bold:j,italic:O,underline:h,strikeOut:g}=t;s&&n.push(`color: ${s}`),f&&n.push(l(f)),"1"===b?n.push(o(i,u,a,d)):"3"===b&&n.push(`background-color: ${a}`),"-1"===j&&n.push("font-weight: bold"),"-1"===O&&n.push("font-style: italic"),"-1"!==h&&"-1"!==g||n.push(`text-decoration: ${"-1"===h?"underline":""} ${"-1"===g?"line-through":""}`),e[t.name]={inline:n.join(";"),...this.genScaledFont(p),raw:t}}),this.styles=e}genScaledFont(t){return{fontScaled:this.scaleHeight(.75*t),fontMax:`${t}px`,fontScalingThreshold:+this.info.playResY,fontRaw:t}}parseSubOverrideTags(){this.subs.forEach(t=>{if(t.rawText=t.text,t.text=t.text.replace("\\N","\n"),!/{.+?}/.test(t.text))return;t.phrases=[];const e=t=>t.replace(/{.*?}/g,""),n=function*(t){const e=/({.*?}[^{]*)/g;let n;const s=t.indexOf("{");for(s>0&&(yield t.substring(0,s));null!==(n=e.exec(t));)yield n[1]}(t.text);let s=[];for(const b of n){const n=[],u={text:e(b),fadeIn:0,fadeOut:0,inline:""};let d,f,p,j,O,h=b.match(/{.*?}/),g=h?h[0]:"";function c(t,e=!1,n=(()=>{})){const s=i(g,t,e);s&&(n(s.params),g=s.overrides)}function a(t,e,n){const s=t.map((t,n)=>{const s=Array.isArray(e)?e[n]:e,c=i(g,t,s);if(c)return g=c.overrides,c.params});s.some(t=>void 0!==t)&&n(...s)}if(c("fscx"),c("fscy"),c("3c",!1,t=>{d=t}),c("4c",!1,t=>{f=t}),c("bord",!1,t=>{p=t}),c("shad",!1,t=>{j=t}),c("blur",!1,t=>{O=t}),c("be",!1,t=>{O=t}),[d,f,p,j,O].some(t=>void 0!==t)){const e=this.styles[t.style],n=(t,n)=>void 0!==t?t:e.raw[n];e&&(d=n(r(d),"outlineColour"),f=n(r(f),"backColour"),p=n(p,"outline"),j=n(j,"shadow"),s.push(o(d,p,f,j,O)))}a(["pos","an","org"],[!0,!1,!0],(t,e="5",c)=>{if(t){const[r,o]=t;n.push(`position: fixed; left: ${this.scaleWidth(r)}; top: ${this.scaleHeight(o)}`);const l={1:"50%, -150%",2:"-50%, -150%",3:"-150%, -150%",4:"50%, -50%",5:"-50%, -50%",6:"-150%, -50%",7:"50%, 50%",8:"-50%, 50%",9:"-150%, 50%"}[e];if(n.push(`transform: translate(${l})`),c){const[t,e]=c;s.push(`transform-origin: ${this.scaleWidth(t)} ${this.scaleHeight(e)}`)}}}),a(["frx","fry","frz"],!1,(t,e,c)=>{const r=[],o=(t,e,n=1)=>{if(void 0!==t)return t=parseFloat(t)*n,r.push(`rotate3d(${e.join(", ")}, ${t}deg)`)};o(t,[1,0,0]),o(c,[0,0,1],-1),o(e,[0,1,0]),r.length&&(n.push("perspective: 200px"),s.push(`display: block; transform: ${r.join(" ")}`))}),c("fad",!0,([e,n])=>{u.fadeIn=e,u.fadeOut=n,t.end-=n}),c("fsp",!1,t=>{s.push(`letter-spacing: ${t}px`)}),c("fs",!1,t=>{Object.assign(u,this.genScaledFont(t))});const m=[];c("u",!1,t=>{m.push("underline")}),c("s",!1,t=>{m.push("line-through")}),s.push(`text-decoration: ${m.length?m.join(" "):"none"}`),c("b",!1,t=>{s.push(`font-weight: ${t?"bold":"normal"}`)}),c("i",!1,t=>{s.push(`font-style: ${t?"italic":"normal"}`)}),c("fn",!1,t=>{s.push(l(t))}),c("1c",!1,t=>{s.push(`color: ${r(t)}`)}),c("r",!1,t=>{if(t){const e=this.styles[t];s=[e.inline],Object.assign(u,this.genScaledFont(e.fontRaw))}else s=[]}),u.inline=s.join(";"),t.phrases.push(u),n.length&&(t.inline=n.join(";"))}t.text=e(t.text)})}}},,function(t,e,n){"use strict";n.r(e);var s=n(0),c=n(2);const r=[];function o(t,e=s.G){let n;const c=[];function o(e){if(Object(s.O)(t,e)&&(t=e,n)){const e=!r.length;for(let e=0;e<c.length;e+=1){const n=c[e];n[1](),r.push(n,t)}if(e){for(let t=0;t<r.length;t+=2)r[t][0](r[t+1]);r.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(r,l=s.G){const i=[r,l];return c.push(i),1===c.length&&(n=e(o)||s.G),r(t),()=>{const t=c.indexOf(i);-1!==t&&c.splice(t,1),0===c.length&&(n(),n=null)}}}}const l={subtitleFallbackColor:"#FFFFFF",showSubtitlesOnVideo:!0,pauseWhenTrayOpen:!0,invertVerticalAlignment:!0},i=Object.assign({},l,GM_getValue("settings-store",{})),a={};Object.keys(l).forEach(t=>{(a[t]=o(i[t])).subscribe(e=>{i[t]=e,GM_setValue("settings-store",i)})});const b=a.subtitleFallbackColor,u=a.showSubtitlesOnVideo,d=a.pauseWhenTrayOpen,f=a.invertVerticalAlignment;var p=n(3),j=n(1);function O(t,e,n){const c=getComputedStyle(t),r="none"===c.transform?"":c.transform,o=e.from.width/t.clientWidth,l=e.from.height/t.clientHeight,i=(e.from.left-e.to.left)/o,a=(e.from.top-e.to.top)/l,b=Math.sqrt(i*i+a*a),{delay:u=0,duration:d=(t=>120*Math.sqrt(t)),easing:f=j.b}=n;return{delay:u,duration:Object(s.C)(d)?d(b):d,easing:f,css:(t,e)=>`transform: ${r} translate(${e*i}px, ${e*a}px);`}}function h(t){return"[object Date]"===Object.prototype.toString.call(t)}function g(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((e,n)=>g(t[n],e));return t=>n.map(e=>e(t))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(h(t)&&h(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),s={};return n.forEach(n=>{s[n]=g(t[n],e[n])}),t=>{const e={};return n.forEach(n=>{e[n]=s[n](t)}),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function m(t,e,n){const s=t.slice();return s[31]=e[n],s}function x(t,e,n){const s=t.slice();return s[34]=e[n],s[36]=n,s}function v(t){let e,n,c,r,o,l,i,a,b,u,d,f,p,j,O,h,g,v,y,k,z,S,q,C,A,B,U,N,_,P,E,R,G,M,D,F,T,I,H,X,W,L,V,K,J,Y,Z,Q,tt,et,nt,st,ct,rt,ot,lt,it,at,bt,ut,dt,ft,pt,jt,Ot,ht,gt,mt=[],xt=new Map,vt=t[1].fileName+"",yt=t[2]>0?"+":"",wt=(t[2]/1e3).toFixed(2)+"",$t=t[0];const kt=t=>t[34].text;for(let e=0;e<$t.length;e+=1){let n=x(t,$t,e),s=kt(n);xt.set(s,mt[e]=w(s,n))}let zt=t[1].debugInfo(),St=[];for(let e=0;e<zt.length;e+=1)St[e]=$(m(t,zt,e));return{c(){e=Object(s.s)("div"),n=Object(s.s)("button"),c=Object(s.X)("Recent Subtitles"),o=Object(s.U)(),l=Object(s.s)("button"),i=Object(s.X)("Settings"),b=Object(s.U)(),u=Object(s.s)("button"),d=Object(s.X)("Debug"),p=Object(s.U)(),j=Object(s.s)("div"),O=Object(s.s)("h2"),O.textContent="Recent Subtitles",h=Object(s.U)(),g=Object(s.s)("ul");for(let t=0;t<mt.length;t+=1)mt[t].c();v=Object(s.U)(),y=Object(s.s)("div"),k=Object(s.s)("h2"),k.textContent="Settings",z=Object(s.U)(),S=Object(s.s)("div"),q=Object(s.s)("button"),q.textContent="Reselect subtitles",C=Object(s.U)(),A=Object(s.s)("button"),A.textContent="Realign subtitles",B=Object(s.U)(),U=Object(s.s)("div"),N=Object(s.s)("label"),N.textContent="Subtitle fallback color:",_=Object(s.U)(),P=Object(s.s)("input"),E=Object(s.U)(),R=Object(s.s)("div"),G=Object(s.s)("input"),M=Object(s.U)(),D=Object(s.s)("label"),D.textContent="Show subs over video",F=Object(s.U)(),T=Object(s.s)("div"),I=Object(s.s)("input"),H=Object(s.U)(),X=Object(s.s)("label"),X.textContent="Pause when tray is open",W=Object(s.U)(),L=Object(s.s)("div"),V=Object(s.s)("input"),K=Object(s.U)(),J=Object(s.s)("label"),J.textContent="Invert subtitle vertical alignment (i.e. if subtitles should be near the bottom this will make them show near the top).\n\t\t\t\t\tYou'll likely want this enabled if you intend to watch with VRV's subtitles at the same time.",Y=Object(s.U)(),Z=Object(s.s)("div"),Q=Object(s.s)("h2"),Q.textContent="Debug Information",tt=Object(s.U)(),et=Object(s.s)("dl"),nt=Object(s.s)("dt"),nt.textContent="Subtitles File",st=Object(s.s)("dd"),ct=Object(s.X)(vt),rt=Object(s.s)("dt"),rt.textContent="Alignment",ot=Object(s.s)("dd"),lt=Object(s.X)(yt),it=Object(s.X)(wt),at=Object(s.X)(" seconds");for(let t=0;t<St.length;t+=1)St[t].c();bt=Object(s.U)(),ut=Object(s.s)("div"),dt=Object(s.s)("a"),ft=Object(s.X)("⬇ Download Parsed Subtitles"),jt=Object(s.U)(),Ot=Object(s.s)("div"),Ot.innerHTML='<a target="_blank" href="https://github.com/sheodox/jimaku-player/issues" rel="noopener noreferrer" class="svelte-hlq1e">Issue? Report it here!</a>',n.disabled=r="recent"===t[4],l.disabled=a="settings"===t[4],u.disabled=f="debug"===t[4],Object(s.f)(e,"class","tray-tab-buttons svelte-hlq1e"),Object(s.f)(O,"class","svelte-hlq1e"),Object(s.f)(g,"class","recent-subs svelte-hlq1e"),Object(s.f)(j,"class","tab tab-recent svelte-hlq1e"),Object(s.Z)(j,"tab-active","recent"===t[4]),Object(s.f)(k,"class","svelte-hlq1e"),Object(s.f)(q,"class","secondary"),Object(s.f)(A,"class","secondary"),Object(s.f)(S,"class","row svelte-hlq1e"),Object(s.f)(N,"for","subtitle-color"),Object(s.f)(P,"type","color"),Object(s.f)(P,"id","subtitle-color"),Object(s.f)(U,"class","row svelte-hlq1e"),Object(s.f)(G,"id","show-subs"),Object(s.f)(G,"type","checkbox"),Object(s.f)(D,"for","show-subs"),Object(s.f)(R,"class","row svelte-hlq1e"),Object(s.f)(I,"id","pause-on-tray"),Object(s.f)(I,"type","checkbox"),Object(s.f)(X,"for","pause-on-tray"),Object(s.f)(T,"class","row svelte-hlq1e"),Object(s.f)(V,"id","invert-subtitle-alignment"),Object(s.f)(V,"type","checkbox"),Object(s.f)(J,"for","invert-subtitle-alignment"),Object(s.f)(L,"class","row svelte-hlq1e"),Object(s.f)(y,"class","tab tab-settings svelte-hlq1e"),Object(s.Z)(y,"tab-active","settings"===t[4]),Object(s.f)(Q,"class","svelte-hlq1e"),Object(s.f)(nt,"class","svelte-hlq1e"),Object(s.f)(st,"class","svelte-hlq1e"),Object(s.f)(rt,"class","svelte-hlq1e"),Object(s.f)(ot,"class","svelte-hlq1e"),Object(s.f)(dt,"href",pt=t[13]()),Object(s.f)(dt,"download","parsed-subtitles.json"),Object(s.f)(dt,"class","svelte-hlq1e"),Object(s.f)(ut,"class","row svelte-hlq1e"),Object(s.f)(Ot,"class","row svelte-hlq1e"),Object(s.f)(Z,"class","tab tab-debug svelte-hlq1e"),Object(s.Z)(Z,"tab-active","debug"===t[4])},m(r,a){Object(s.B)(r,e,a),Object(s.d)(e,n),Object(s.d)(n,c),Object(s.d)(e,o),Object(s.d)(e,l),Object(s.d)(l,i),Object(s.d)(e,b),Object(s.d)(e,u),Object(s.d)(u,d),Object(s.B)(r,p,a),Object(s.B)(r,j,a),Object(s.d)(j,O),Object(s.d)(j,h),Object(s.d)(j,g);for(let t=0;t<mt.length;t+=1)mt[t].m(g,null);Object(s.B)(r,v,a),Object(s.B)(r,y,a),Object(s.d)(y,k),Object(s.d)(y,z),Object(s.d)(y,S),Object(s.d)(S,q),Object(s.d)(S,C),Object(s.d)(S,A),Object(s.d)(y,B),Object(s.d)(y,U),Object(s.d)(U,N),Object(s.d)(U,_),Object(s.d)(U,P),Object(s.S)(P,t[6]),Object(s.d)(y,E),Object(s.d)(y,R),Object(s.d)(R,G),G.checked=t[7],Object(s.d)(R,M),Object(s.d)(R,D),Object(s.d)(y,F),Object(s.d)(y,T),Object(s.d)(T,I),I.checked=t[8],Object(s.d)(T,H),Object(s.d)(T,X),Object(s.d)(y,W),Object(s.d)(y,L),Object(s.d)(L,V),V.checked=t[9],Object(s.d)(L,K),Object(s.d)(L,J),Object(s.B)(r,Y,a),Object(s.B)(r,Z,a),Object(s.d)(Z,Q),Object(s.d)(Z,tt),Object(s.d)(Z,et),Object(s.d)(et,nt),Object(s.d)(et,st),Object(s.d)(st,ct),Object(s.d)(et,rt),Object(s.d)(et,ot),Object(s.d)(ot,lt),Object(s.d)(ot,it),Object(s.d)(ot,at);for(let t=0;t<St.length;t+=1)St[t].m(et,null);Object(s.d)(Z,bt),Object(s.d)(Z,ut),Object(s.d)(ut,dt),Object(s.d)(dt,ft),Object(s.d)(Z,jt),Object(s.d)(Z,Ot),ht=!0,gt=[Object(s.D)(n,"click",t[21]),Object(s.D)(l,"click",t[22]),Object(s.D)(u,"click",t[23]),Object(s.D)(q,"click",t[25]),Object(s.D)(A,"click",t[26]),Object(s.D)(P,"input",t[27]),Object(s.D)(G,"change",t[28]),Object(s.D)(I,"change",t[29]),Object(s.D)(V,"change",t[30])]},p(t,e){if((!ht||16&e[0]&&r!==(r="recent"===t[4]))&&(n.disabled=r),(!ht||16&e[0]&&a!==(a="settings"===t[4]))&&(l.disabled=a),(!ht||16&e[0]&&f!==(f="debug"===t[4]))&&(u.disabled=f),5121&e[0]){const n=t[0];Object(s.y)();for(let t=0;t<mt.length;t+=1)mt[t].r();mt=Object(s.cb)(mt,e,kt,1,t,n,xt,g,s.u,w,null,x);for(let t=0;t<mt.length;t+=1)mt[t].a();Object(s.h)()}if(16&e[0]&&Object(s.Z)(j,"tab-active","recent"===t[4]),64&e[0]&&Object(s.S)(P,t[6]),128&e[0]&&(G.checked=t[7]),256&e[0]&&(I.checked=t[8]),512&e[0]&&(V.checked=t[9]),16&e[0]&&Object(s.Z)(y,"tab-active","settings"===t[4]),(!ht||2&e[0])&&vt!==(vt=t[1].fileName+"")&&Object(s.R)(ct,vt),(!ht||4&e[0])&&yt!==(yt=t[2]>0?"+":"")&&Object(s.R)(lt,yt),(!ht||4&e[0])&&wt!==(wt=(t[2]/1e3).toFixed(2)+"")&&Object(s.R)(it,wt),2&e[0]){let n;for(zt=t[1].debugInfo(),n=0;n<zt.length;n+=1){const s=m(t,zt,n);St[n]?St[n].p(s,e):(St[n]=$(s),St[n].c(),St[n].m(et,null))}for(;n<St.length;n+=1)St[n].d(1);St.length=zt.length}16&e[0]&&Object(s.Z)(Z,"tab-active","debug"===t[4])},i(t){if(!ht){for(let t=0;t<$t.length;t+=1)Object(s.ab)(mt[t]);ht=!0}},o(t){for(let t=0;t<mt.length;t+=1)Object(s.bb)(mt[t]);ht=!1},d(t){t&&Object(s.r)(e),t&&Object(s.r)(p),t&&Object(s.r)(j);for(let t=0;t<mt.length;t+=1)mt[t].d();t&&Object(s.r)(v),t&&Object(s.r)(y),t&&Object(s.r)(Y),t&&Object(s.r)(Z),Object(s.q)(St,t),Object(s.N)(gt)}}}function y(t){let e,n,c,r,o,l;return{c(){e=Object(s.s)("div"),n=Object(s.s)("div"),c=Object(s.s)("button"),c.textContent="Select Subtitles",r=Object(s.U)(),o=Object(s.s)("div"),o.innerHTML='<a target="_blank" href="https://github.com/sheodox/jimaku-player/issues" rel="noopener noreferrer" class="svelte-hlq1e">Issue? Report it here!</a>',Object(s.f)(n,"class","row svelte-hlq1e"),Object(s.f)(o,"class","row svelte-hlq1e"),Object(s.f)(e,"class","tab tab-active tab-cancelled svelte-hlq1e")},m(i,a){Object(s.B)(i,e,a),Object(s.d)(e,n),Object(s.d)(n,c),Object(s.d)(e,r),Object(s.d)(e,o),l=Object(s.D)(c,"click",t[20])},p:s.G,i:s.G,o:s.G,d(t){t&&Object(s.r)(e),l()}}}function w(t,e){let n,c,r,o,l,i,a,b,u,d,f,j=e[34].text+"",h=s.G;return{key:t,first:null,c(){n=Object(s.s)("li"),c=Object(s.s)("a"),r=Object(s.X)(j),l=Object(s.U)(),Object(s.f)(c,"target","_blank"),Object(s.f)(c,"href",o=`https://jisho.org/search/${encodeURIComponent(e[34].text.trim())}`),Object(s.f)(c,"rel","noopener noreferrer"),Object(s.f)(c,"class","svelte-hlq1e"),Object(s.f)(n,"style",i=e[12](e[36])),Object(s.f)(n,"class","svelte-hlq1e"),this.first=n},m(t,o){Object(s.B)(t,n,o),Object(s.d)(n,c),Object(s.d)(c,r),Object(s.d)(n,l),d=!0,f=Object(s.D)(c,"click",e[24])},p(t,e){(!d||1&e[0])&&j!==(j=t[34].text+"")&&Object(s.R)(r,j),(!d||1&e[0]&&o!==(o=`https://jisho.org/search/${encodeURIComponent(t[34].text.trim())}`))&&Object(s.f)(c,"href",o),(!d||1&e[0]&&i!==(i=t[12](t[36])))&&Object(s.f)(n,"style",i)},r(){u=n.getBoundingClientRect()},f(){Object(s.v)(n),h(),Object(s.c)(n,u)},a(){h(),h=Object(s.k)(n,u,O,{duration:200})},i(t){d||(Object(s.b)(()=>{b&&b.end(1),a||(a=Object(s.n)(n,p.b,{y:-50,duration:200})),a.start()}),d=!0)},o(t){a&&a.invalidate(),b=Object(s.o)(n,p.b,{y:50,duration:200}),d=!1},d(t){t&&Object(s.r)(n),t&&b&&b.end(),f()}}}function $(t){let e,n,c,r,o=t[31].title+"",l=t[31].detail+"";return{c(){e=Object(s.s)("dt"),n=Object(s.X)(o),c=Object(s.s)("dd"),r=Object(s.X)(l),Object(s.f)(e,"class","svelte-hlq1e"),Object(s.f)(c,"class","svelte-hlq1e")},m(t,o){Object(s.B)(t,e,o),Object(s.d)(e,n),Object(s.B)(t,c,o),Object(s.d)(c,r)},p(t,e){2&e[0]&&o!==(o=t[31].title+"")&&Object(s.R)(n,o),2&e[0]&&l!==(l=t[31].detail+"")&&Object(s.R)(r,l)},d(t){t&&Object(s.r)(e),t&&Object(s.r)(c)}}}function k(t){let e,n,c,r,o,l,i;const a=[y,v],b=[];function u(t,e){return"cancelled"===t[3]?0:"normal"===t[3]?1:-1}return~(r=u(t))&&(o=b[r]=a[r](t)),{c(){e=Object(s.s)("div"),n=Object(s.s)("h1"),n.textContent="字幕プレーヤー",c=Object(s.U)(),o&&o.c(),Object(s.f)(n,"class","svelte-hlq1e"),Object(s.f)(e,"class","tray svelte-hlq1e"),Object(s.T)(e,"right",t[5]+"rem")},m(o,a){Object(s.B)(o,e,a),Object(s.d)(e,n),Object(s.d)(e,c),~r&&b[r].m(e,null),l=!0,i=[Object(s.D)(e,"mouseenter",t[14](!0)),Object(s.D)(e,"mouseleave",t[14](!1))]},p(t,n){let c=r;r=u(t),r===c?~r&&b[r].p(t,n):(o&&(Object(s.y)(),Object(s.bb)(b[c],1,1,()=>{b[c]=null}),Object(s.h)()),~r?(o=b[r],o||(o=b[r]=a[r](t),o.c()),Object(s.ab)(o,1),o.m(e,null)):o=null),(!l||32&n[0])&&Object(s.T)(e,"right",t[5]+"rem")},i(t){l||(Object(s.ab)(o),l=!0)},o(t){Object(s.bb)(o),l=!1},d(t){t&&Object(s.r)(e),~r&&b[r].d(),Object(s.N)(i)}}}function z(t,e,n){let r,l,i,a,p;Object(s.i)(t,b,t=>n(6,l=t)),Object(s.i)(t,u,t=>n(7,i=t)),Object(s.i)(t,d,t=>n(8,a=t)),Object(s.i)(t,f,t=>n(9,p=t));const O=Object(c.a)(),h={hidden:-26,shown:0},m=function(t,e={}){const n=o(t);let c,r=t;function l(o,l){if(null==t)return n.set(t=o),Promise.resolve();r=o;let i=c,a=!1,{delay:b=0,duration:u=400,easing:d=j.c,interpolate:f=g}=Object(s.e)(Object(s.e)({},e),l);const p=Object(s.H)()+b;let O;return c=Object(s.E)(e=>{if(e<p)return!0;a||(O=f(t,o),"function"==typeof u&&(u=u(t,o)),a=!0),i&&(i.abort(),i=null);const s=e-p;return s>u?(n.set(t=o),!1):(n.set(t=O(d(s/u))),!0)}),c.promise}return{set:l,update:(e,n)=>l(e(r,t),n),subscribe:n.subscribe}}(h.hidden,{duration:300,easing:j.b});Object(s.i)(t,m,t=>n(5,r=t));let{recentSubs:x=[]}=e,{subtitles:v={}}=e,{alignment:y=0}=e,{mode:w="normal"}=e;let $="recent";return t.$set=t=>{"recentSubs"in t&&n(0,x=t.recentSubs),"subtitles"in t&&n(1,v=t.subtitles),"alignment"in t&&n(2,y=t.alignment),"mode"in t&&n(3,w=t.mode)},[x,v,y,w,$,r,l,i,a,p,O,m,function(t){return`font-size: ${20*(.5+(t+1)/x.length*.5)}px`},function(){const t=new Blob([v.serialize()],{type:"application/json"});return URL.createObjectURL(t)},function(t){return()=>{m.set(t?h.shown:h.hidden),t&&!Object(s.w)(d)||O("tray-pauser",t)}},h,!1,!0,!0,function(t){return e=>{O(t,e.target.checked)}},()=>O("restart"),()=>n(4,$="recent"),()=>n(4,$="settings"),()=>n(4,$="debug"),()=>O("define-pauser"),()=>O("restart"),()=>O("realign"),function(){l=this.value,b.set(l)},function(){i=this.checked,u.set(i)},function(){a=this.checked,d.set(a)},function(){p=this.checked,f.set(p)}]}class S extends s.a{constructor(t){var e;super(),document.getElementById("svelte-hlq1e-style")||((e=Object(s.s)("style")).id="svelte-hlq1e-style",e.textContent='.tray.svelte-hlq1e.svelte-hlq1e{width:28rem;margin-top:0.5rem;background:rgba(255, 255, 255, 0.2);position:fixed;right:0;top:0;color:white;height:calc(100% - 5rem);display:flex;flex-direction:column;text-align:center}.tray.svelte-hlq1e>.svelte-hlq1e{visibility:hidden}.tray.svelte-hlq1e.svelte-hlq1e:hover{background:#111218;overflow:auto;border-radius:3px}.tray.svelte-hlq1e:hover>.svelte-hlq1e{visibility:visible}.tray.svelte-hlq1e h1.svelte-hlq1e{font-size:2rem;padding:0.5rem 0;border-radius:3px;margin:0}.tray.svelte-hlq1e h2.svelte-hlq1e{text-decoration:underline;margin:0 0 0.4rem}ul.svelte-hlq1e.svelte-hlq1e{list-style:none;padding:0;display:flex;flex-direction:column-reverse}a.svelte-hlq1e.svelte-hlq1e{color:white;transform:scaleY(0);transform-origin:top;transition:transform 0.5s ease;font-family:"Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif}.tab-recent.svelte-hlq1e a.svelte-hlq1e:not(:hover){text-decoration:none}a.svelte-hlq1e.svelte-hlq1e:hover{color:#0aff8c;cursor:pointer;text-decoration:underline}li.svelte-hlq1e.svelte-hlq1e{padding-bottom:0.2rem;white-space:pre}li.svelte-hlq1e.svelte-hlq1e:not(:first-of-type)::after{content:\' \';height:0;position:relative;border:1px solid #4a4a6a;display:block;margin:0 auto;border-radius:4px}dt.svelte-hlq1e.svelte-hlq1e{font-weight:bold}dd.svelte-hlq1e.svelte-hlq1e{font-style:italic}.tab.svelte-hlq1e.svelte-hlq1e{display:none;text-align:left;padding:2rem;background:#1c1825;border-top:2px solid #f47521}.tab-active.svelte-hlq1e.svelte-hlq1e{display:block;flex:1}.tray-tab-buttons.svelte-hlq1e.svelte-hlq1e{margin:0.2rem}.row.svelte-hlq1e.svelte-hlq1e:not(:last-child){margin-bottom:0.5rem}.tab-cancelled.svelte-hlq1e.svelte-hlq1e{text-align:center}',Object(s.d)(document.head,e)),Object(s.A)(this,t,z,k,s.O,{recentSubs:0,subtitles:1,alignment:2,mode:3},[-1,-1])}}var q=S;function C(t,e,n){const s=t.slice();return s[14]=e[n],s}function A(t,e,n){const s=t.slice();return s[11]=e[n],s}function B(t){let e,n,c=t[0],r=[];for(let e=0;e<c.length;e+=1)r[e]=P(A(t,c,e));const o=t=>Object(s.bb)(r[t],1,1,()=>{r[t]=null});return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=Object(s.t)()},m(t,c){for(let e=0;e<r.length;e+=1)r[e].m(t,c);Object(s.B)(t,e,c),n=!0},p(t,n){if(13&n){let l;for(c=t[0],l=0;l<c.length;l+=1){const o=A(t,c,l);r[l]?(r[l].p(o,n),Object(s.ab)(r[l],1)):(r[l]=P(o),r[l].c(),Object(s.ab)(r[l],1),r[l].m(e.parentNode,e))}for(Object(s.y)(),l=c.length;l<r.length;l+=1)o(l);Object(s.h)()}},i(t){if(!n){for(let t=0;t<c.length;t+=1)Object(s.ab)(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)Object(s.bb)(r[t]);n=!1},d(t){Object(s.q)(r,t),t&&Object(s.r)(e)}}}function U(t){let e,n=t[11].text+"";return{c(){e=Object(s.X)(n)},m(t,n){Object(s.B)(t,e,n)},p(t,c){1&c&&n!==(n=t[11].text+"")&&Object(s.R)(e,n)},i:s.G,o:s.G,d(t){t&&Object(s.r)(e)}}}function N(t){let e,n,c=t[11].phrases,r=[];for(let e=0;e<c.length;e+=1)r[e]=_(C(t,c,e));const o=t=>Object(s.bb)(r[t],1,1,()=>{r[t]=null});return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=Object(s.t)()},m(t,c){for(let e=0;e<r.length;e+=1)r[e].m(t,c);Object(s.B)(t,e,c),n=!0},p(t,n){if(1&n){let l;for(c=t[11].phrases,l=0;l<c.length;l+=1){const o=C(t,c,l);r[l]?(r[l].p(o,n),Object(s.ab)(r[l],1)):(r[l]=_(o),r[l].c(),Object(s.ab)(r[l],1),r[l].m(e.parentNode,e))}for(Object(s.y)(),l=c.length;l<r.length;l+=1)o(l);Object(s.h)()}},i(t){if(!n){for(let t=0;t<c.length;t+=1)Object(s.ab)(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)Object(s.bb)(r[t]);n=!1},d(t){Object(s.q)(r,t),t&&Object(s.r)(e)}}}function _(t){let e,n,c,r,o,l,i=t[14].text+"";return{c(){e=Object(s.s)("span"),n=Object(s.X)(i),Object(s.f)(e,"style",c=M(t[14]))},m(t,c){Object(s.B)(t,e,c),Object(s.d)(e,n),l=!0},p(t,r){(!l||1&r)&&i!==(i=t[14].text+"")&&Object(s.R)(n,i),(!l||1&r&&c!==(c=M(t[14])))&&Object(s.f)(e,"style",c)},i(n){l||(Object(s.b)(()=>{o&&o.end(1),r||(r=Object(s.n)(e,p.a,{duration:t[14].fadeIn||0})),r.start()}),l=!0)},o(n){r&&r.invalidate(),o=Object(s.o)(e,p.a,{duration:t[14].fadeOut||0}),l=!1},d(t){t&&Object(s.r)(e),t&&o&&o.end()}}}function P(t){let e,n,c,r,o,l,i,a;const b=[N,U],u=[];function d(t,e){return t[11].phrases?0:1}function f(...e){return t[10](t[11],...e)}return n=d(t),c=u[n]=b[n](t),{c(){e=Object(s.s)("p"),c.c(),r=Object(s.U)(),Object(s.f)(e,"style",o=t[3](t[11])),Object(s.f)(e,"data-sub-style",l=t[11].style),Object(s.f)(e,"title","click to search this phrase on Jisho.org"),Object(s.f)(e,"class","svelte-nduvur")},m(t,c){Object(s.B)(t,e,c),u[n].m(e,null),Object(s.d)(e,r),i=!0,a=Object(s.D)(e,"click",f)},p(a,f){let p=n;n=d(t=a),n===p?u[n].p(t,f):(Object(s.y)(),Object(s.bb)(u[p],1,1,()=>{u[p]=null}),Object(s.h)(),c=u[n],c||(c=u[n]=b[n](t),c.c()),Object(s.ab)(c,1),c.m(e,r)),(!i||1&f&&o!==(o=t[3](t[11])))&&Object(s.f)(e,"style",o),(!i||1&f&&l!==(l=t[11].style))&&Object(s.f)(e,"data-sub-style",l)},i(t){i||(Object(s.ab)(c),i=!0)},o(t){Object(s.bb)(c),i=!1},d(t){t&&Object(s.r)(e),u[n].d(),a()}}}function E(t){let e,n,c=t[1]&&B(t);return{c(){e=Object(s.s)("div"),c&&c.c(),Object(s.f)(e,"class","subtitles")},m(t,r){Object(s.B)(t,e,r),c&&c.m(e,null),n=!0},p(t,[n]){t[1]?c?(c.p(t,n),Object(s.ab)(c,1)):(c=B(t),c.c(),Object(s.ab)(c,1),c.m(e,null)):c&&(Object(s.y)(),Object(s.bb)(c,1,1,()=>{c=null}),Object(s.h)())},i(t){n||(Object(s.ab)(c),n=!0)},o(t){Object(s.bb)(c),n=!1},d(t){t&&Object(s.r)(e),c&&c.d()}}}function R(t){return t.fontScaled?`font-size: ${window.innerHeight>t.fontScalingThreshold?t.fontMax:t.fontScaled}`:""}function G(t){return t.filter(t=>!!t).join(";")}function M(t){return G([t.inline,R(t)])}function D(t,e,n){let r;Object(s.i)(t,u,t=>n(1,r=t));let{current:o=[]}=e,{styles:l={}}=e,{format:i=""}=e;const a=Object(c.a)();let d,p;const j=[b.subscribe(t=>{d=t}),f.subscribe(t=>{p=t?"inverted":"normal"})];function O(t){a("define-pauser"),window.open(`https://jisho.org/search/${encodeURIComponent(t.trim())}`)}Object(c.b)(()=>{j.forEach(t=>t())});return t.$set=t=>{"current"in t&&n(0,o=t.current),"styles"in t&&n(4,l=t.styles),"format"in t&&n(5,i=t.format)},[o,r,O,function(t){let e=[`color: ${d}`];return"ass"===i&&t.style in l&&(e.push(l[t.style].inline),e.push(R(l[t.style]))),t.verticalAlignment&&e.push(t.verticalAlignment[p]),e=e.concat([t.inline||"",R(t)]),G(e)},l,i,d,p,a,j,t=>O(t.text)]}class F extends s.a{constructor(t){var e;super(),document.getElementById("svelte-nduvur-style")||((e=Object(s.s)("style")).id="svelte-nduvur-style",e.textContent='p.svelte-nduvur{cursor:pointer;color:white;margin:0;padding:0;white-space:pre;font-family:"Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif;text-align:center}p.svelte-nduvur:hover{color:#0aff8c !important}',Object(s.d)(document.head,e)),Object(s.A)(this,t,D,E,s.O,{current:0,styles:4,format:5})}}var T=F;class I{constructor(){this.video=null,this.reasons=[]}setVideo(t){this.reasons=[],this.video=t}addPauser(t){this.reasons.includes("user-paused")&&!this.video.paused&&this.reasons.splice(this.reasons.indexOf("user-paused")),0===this.reasons.length&&this.video.paused&&this.reasons.push("user-paused"),this.reasons.push(t),this._checkPause()}removePauser(t){const e=this.reasons.indexOf(t);-1!==e&&(this.reasons.splice(e,1),this._checkPause())}_checkPause(){this.reasons.length?this.video.pause():this.video.play()}}var H=n(8),X=n.n(H),W=n(7),L=n.n(W);const V={"line-left":"0%",center:"-50%","line-right":"-100%"};class K extends L.a{constructor(t,e){super("srt",e);const n=t.replace(/\r/g,"").split("\n\n");this.subs=n.reduce((t,e)=>{let n=e.trim().split("\n");function s(){n.shift()}try{/^\d*$/.test(n[0])&&s();let[e,c]=n[0].replace(/,/g,".").match(/^([\d:\.\-> ]*)/)[0].split(/\-\->/),r=n[0].match(/([a-zA-Z].*)/);r=r&&r.length?r[1]:"";let o=[],l=[];const i=n.length-1,a=(t,e)=>{const n=r.match(new RegExp(`${t}:([\\d\\.]*)%`));return n?parseInt(n[1],10):e},b=t=>{const e=r.match(new RegExp(`${t}:([w-]*?)`));if(e)return e[1]},u=()=>{const t=r.match(/position:([\d.]*)%(?:,(\w*))?/);return t?{position:parseInt(t[1]),positionAlignment:"middle"===t[2]?"center":t[2]}:{position:50,positionAlignment:"center"}},d=5;let{position:f,positionAlignment:p="center"}=u(),j=(b("align"),a("line",90-i*d)),O=a("size",100);l.push(`position: fixed; left: ${f}vw`),p&&p in V&&o.push(`transform: translateX(${V[p]})`),o.push(`display:block; width: ${O}vw`),s();const h=n.join("\n").replace(/<\/?c.Japanese>/g,"");o.push(`font-size: ${d}vh`),o.push("text-shadow: -4px -4px 0px rgba(9, 9, 9, 255), -4px -3px 0px rgba(9, 9, 9, 255), -4px -2px 0px rgba(9, 9, 9, 255), -4px -1px 0px rgba(9, 9, 9, 255), -4px 0px 0px rgba(9, 9, 9, 255), -4px 1px 0px rgba(9, 9, 9, 255), -4px 2px 0px rgba(9, 9, 9, 255), -4px 3px 0px rgba(9, 9, 9, 255), -4px 4px 0px rgba(9, 9, 9, 255), -3px -4px 0px rgba(9, 9, 9, 255), -3px -3px 0px rgba(9, 9, 9, 255), -3px -2px 0px rgba(9, 9, 9, 255), -3px -1px 0px rgba(9, 9, 9, 255), -3px 0px 0px rgba(9, 9, 9, 255), -3px 1px 0px rgba(9, 9, 9, 255), -3px 2px 0px rgba(9, 9, 9, 255), -3px 3px 0px rgba(9, 9, 9, 255), -3px 4px 0px rgba(9, 9, 9, 255), -2px -4px 0px rgba(9, 9, 9, 255), -2px -3px 0px rgba(9, 9, 9, 255), -2px -2px 0px rgba(9, 9, 9, 255), -2px -1px 0px rgba(9, 9, 9, 255), -2px 0px 0px rgba(9, 9, 9, 255), -2px 1px 0px rgba(9, 9, 9, 255), -2px 2px 0px rgba(9, 9, 9, 255), -2px 3px 0px rgba(9, 9, 9, 255), -2px 4px 0px rgba(9, 9, 9, 255), -1px -4px 0px rgba(9, 9, 9, 255), -1px -3px 0px rgba(9, 9, 9, 255), -1px -2px 0px rgba(9, 9, 9, 255), -1px -1px 0px rgba(9, 9, 9, 255), -1px 0px 0px rgba(9, 9, 9, 255), -1px 1px 0px rgba(9, 9, 9, 255), -1px 2px 0px rgba(9, 9, 9, 255), -1px 3px 0px rgba(9, 9, 9, 255), -1px 4px 0px rgba(9, 9, 9, 255), 0px -4px 0px rgba(9, 9, 9, 255), 0px -3px 0px rgba(9, 9, 9, 255), 0px -2px 0px rgba(9, 9, 9, 255), 0px -1px 0px rgba(9, 9, 9, 255), 0px 0px 0px rgba(9, 9, 9, 255), 0px 1px 0px rgba(9, 9, 9, 255), 0px 2px 0px rgba(9, 9, 9, 255), 0px 3px 0px rgba(9, 9, 9, 255), 0px 4px 0px rgba(9, 9, 9, 255), 1px -4px 0px rgba(9, 9, 9, 255), 1px -3px 0px rgba(9, 9, 9, 255), 1px -2px 0px rgba(9, 9, 9, 255), 1px -1px 0px rgba(9, 9, 9, 255), 1px 0px 0px rgba(9, 9, 9, 255), 1px 1px 0px rgba(9, 9, 9, 255), 1px 2px 0px rgba(9, 9, 9, 255), 1px 3px 0px rgba(9, 9, 9, 255), 1px 4px 0px rgba(9, 9, 9, 255), 2px -4px 0px rgba(9, 9, 9, 255), 2px -3px 0px rgba(9, 9, 9, 255), 2px -2px 0px rgba(9, 9, 9, 255), 2px -1px 0px rgba(9, 9, 9, 255), 2px 0px 0px rgba(9, 9, 9, 255), 2px 1px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(9, 9, 9, 255), 2px 3px 0px rgba(9, 9, 9, 255), 2px 4px 0px rgba(9, 9, 9, 255), 3px -4px 0px rgba(9, 9, 9, 255), 3px -3px 0px rgba(9, 9, 9, 255), 3px -2px 0px rgba(9, 9, 9, 255), 3px -1px 0px rgba(9, 9, 9, 255), 3px 0px 0px rgba(9, 9, 9, 255), 3px 1px 0px rgba(9, 9, 9, 255), 3px 2px 0px rgba(9, 9, 9, 255), 3px 3px 0px rgba(9, 9, 9, 255), 3px 4px 0px rgba(9, 9, 9, 255), 4px -4px 0px rgba(9, 9, 9, 255), 4px -3px 0px rgba(9, 9, 9, 255), 4px -2px 0px rgba(9, 9, 9, 255), 4px -1px 0px rgba(9, 9, 9, 255), 4px 0px 0px rgba(9, 9, 9, 255), 4px 1px 0px rgba(9, 9, 9, 255), 4px 2px 0px rgba(9, 9, 9, 255), 4px 3px 0px rgba(9, 9, 9, 255), 4px 4px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(20, 20, 20, 195)");const g=i*10;t.push({start:this.timeToMs(e),end:this.timeToMs(c),verticalAlignment:{normal:`position: fixed; top: calc(${j}vh - ${g}px);`,inverted:`position: fixed; top: calc(${100-j}vh + ${g}px); transform: translateY(-100%)`},text:h,inline:l.join("; "),phrases:[{text:h,inline:o.join("; ")}]})}catch(t){}return t},[])}serialize(){return JSON.stringify(this.subs,null,4)}debugInfo(){return[{title:"Number of subtitles",detail:this.subs.length}]}}function J(t){let e,n,c,r,o,l,i;return{c(){e=Object(s.s)("div"),n=Object(s.s)("button"),n.textContent="⨯ Skip Subtitling For This Episode",c=Object(s.U)(),r=Object(s.s)("label"),r.textContent="≡ Select a subtitle file to begin",o=Object(s.U)(),l=Object(s.s)("input"),Object(s.f)(n,"class","small-button secondary svelte-1n5tabm"),Object(s.f)(r,"for","srt-upload"),Object(s.f)(r,"class","svelte-1n5tabm"),Object(s.f)(l,"type","file"),Object(s.f)(l,"id","srt-upload"),Object(s.f)(l,"accept",".srt,.ass,.ssa,.vtt"),Object(s.f)(l,"class","svelte-1n5tabm"),Object(s.f)(e,"class","column svelte-1n5tabm")},m(a,b){Object(s.B)(a,e,b),Object(s.d)(e,n),Object(s.d)(e,c),Object(s.d)(e,r),Object(s.d)(e,o),Object(s.d)(e,l),i=[Object(s.D)(n,"click",t[1]),Object(s.D)(l,"change",t[0])]},p:s.G,i:s.G,o:s.G,d(t){t&&Object(s.r)(e),Object(s.N)(i)}}}function Y(t){const e=Object(c.a)();return[function(t){const n=t.target.files[0],s=new FileReader;s.onload=t=>{const s={ass:X.a,ssa:X.a,srt:K,vtt:K},[c,r]=n.name.match(/\.(\w{3})$/);e("subtitles-loaded",new s[r](t.target.result,n.name))},s.readAsText(n)},function(){e("cancel")}]}class Z extends s.a{constructor(t){var e;super(),document.getElementById("svelte-1n5tabm-style")||((e=Object(s.s)("style")).id="svelte-1n5tabm-style",e.textContent=".column.svelte-1n5tabm.svelte-1n5tabm{display:flex;flex-direction:column}.column.svelte-1n5tabm>.svelte-1n5tabm{align-self:center;margin:0.5rem}label.svelte-1n5tabm.svelte-1n5tabm{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;display:inline-block;font-size:1.2rem}label.svelte-1n5tabm.svelte-1n5tabm:hover{background:#ffea6d}input.svelte-1n5tabm.svelte-1n5tabm{display:none}",Object(s.d)(document.head,e)),Object(s.A)(this,t,Y,J,s.O,{})}}var Q=Z;const{document:tt}=s.x;function et(t,e,n){const s=t.slice();return s[24]=e[n],s}function nt(t){let e,n;return{c(){e=Object(s.s)("button"),e.textContent="← Back",Object(s.f)(e,"class","small-button secondary svelte-1w2ba3z")},m(c,r){Object(s.B)(c,e,r),n=Object(s.D)(e,"click",t[20])},p:s.G,d(t){t&&Object(s.r)(e),n()}}}function st(t){let e,n;return{c(){e=Object(s.s)("button"),e.textContent="↺ Reselect Subtitles",Object(s.f)(e,"class","small-button secondary svelte-1w2ba3z")},m(c,r){Object(s.B)(c,e,r),n=Object(s.D)(e,"click",t[19])},p:s.G,d(t){t&&Object(s.r)(e),n()}}}function ct(t){let e,n,c,r,o,l,i,a,b,u,d,f,p,j,O,h,g,m,x,v,y,w,$,k,z,S,q,C,A,B,U,N=t[1].text+"",_=t[6],P=[];for(let e=0;e<_.length;e+=1)P[e]=ot(et(t,_,e));return{c(){e=Object(s.s)("div"),n=Object(s.s)("div"),c=Object(s.s)("h2"),c.textContent="Manual Timing",r=Object(s.U)(),o=Object(s.s)("form"),l=Object(s.s)("label"),l.textContent="Offset subtitle display times (in seconds):",i=Object(s.U)(),a=Object(s.s)("div"),b=Object(s.s)("input"),u=Object(s.U)(),d=Object(s.s)("button"),d.textContent="Use this",f=Object(s.U)(),p=Object(s.s)("p"),p.textContent="Positive numbers will delay subtitles.\n\t\t\t\t\t\tNegative numbers will show the subtitles earlier.",j=Object(s.U)(),O=Object(s.s)("div"),h=Object(s.s)("h2"),h.textContent="Automatic Timing",g=Object(s.U)(),m=Object(s.s)("div"),x=Object(s.s)("div"),v=Object(s.s)("div"),y=Object(s.s)("pre"),w=Object(s.X)(N),$=Object(s.U)(),k=Object(s.s)("span"),k.textContent="▼",z=Object(s.U)(),S=Object(s.s)("label"),S.textContent="Select a subtitle to align against",q=Object(s.U)(),C=Object(s.s)("select");for(let t=0;t<P.length;t+=1)P[t].c();A=Object(s.U)(),B=Object(s.s)("button"),B.textContent="Play the video and click here when the selected line is said",Object(s.f)(c,"class","svelte-1w2ba3z"),Object(s.f)(l,"for","manual-alignment"),Object(s.f)(l,"class","svelte-1w2ba3z"),Object(s.f)(b,"type","text"),Object(s.f)(b,"id","manual-alignment"),Object(s.f)(b,"autocomplete","off"),Object(s.f)(b,"class","svelte-1w2ba3z"),Object(s.f)(d,"class","svelte-1w2ba3z"),Object(s.f)(a,"class","row svelte-1w2ba3z"),Object(s.f)(o,"class","column svelte-1w2ba3z"),Object(s.f)(p,"class","alignment-sign-hint svelte-1w2ba3z"),Object(s.f)(n,"class","column alternate-alignment-choice svelte-1w2ba3z"),Object(s.f)(h,"class","svelte-1w2ba3z"),Object(s.f)(y,"class","svelte-1w2ba3z"),Object(s.f)(v,"class","column svelte-1w2ba3z"),Object(s.f)(k,"class","column svelte-1w2ba3z"),Object(s.f)(x,"class","selection-preview row button secondary svelte-1w2ba3z"),Object(s.f)(S,"for","reaction-subtitle-choice"),Object(s.f)(S,"class","sr svelte-1w2ba3z"),Object(s.f)(C,"id","reaction-subtitle-choice"),Object(s.f)(C,"class","svelte-1w2ba3z"),void 0===t[1]&&Object(s.b)(()=>t[23].call(C)),Object(s.f)(m,"id","reaction-subtitle-chooser"),Object(s.f)(m,"class","svelte-1w2ba3z"),Object(s.f)(B,"class","svelte-1w2ba3z"),Object(s.f)(O,"class","column alternate-alignment-choice svelte-1w2ba3z"),Object(s.f)(e,"class","row svelte-1w2ba3z")},m(N,_){Object(s.B)(N,e,_),Object(s.d)(e,n),Object(s.d)(n,c),Object(s.d)(n,r),Object(s.d)(n,o),Object(s.d)(o,l),Object(s.d)(o,i),Object(s.d)(o,a),Object(s.d)(a,b),Object(s.S)(b,t[0]),Object(s.d)(a,u),Object(s.d)(a,d),Object(s.d)(n,f),Object(s.d)(n,p),Object(s.d)(e,j),Object(s.d)(e,O),Object(s.d)(O,h),Object(s.d)(O,g),Object(s.d)(O,m),Object(s.d)(m,x),Object(s.d)(x,v),Object(s.d)(v,y),Object(s.d)(y,w),Object(s.d)(x,$),Object(s.d)(x,k),Object(s.d)(m,z),Object(s.d)(m,S),Object(s.d)(m,q),Object(s.d)(m,C);for(let t=0;t<P.length;t+=1)P[t].m(C,null);Object(s.P)(C,t[1]),Object(s.d)(O,A),Object(s.d)(O,B),U=[Object(s.D)(b,"input",t[22]),Object(s.D)(o,"submit",Object(s.L)(t[8])),Object(s.D)(C,"change",t[23]),Object(s.D)(B,"click",t[11])]},p(t,e){if(1&e&&b.value!==t[0]&&Object(s.S)(b,t[0]),2&e&&N!==(N=t[1].text+"")&&Object(s.R)(w,N),64&e){let n;for(_=t[6],n=0;n<_.length;n+=1){const s=et(t,_,n);P[n]?P[n].p(s,e):(P[n]=ot(s),P[n].c(),P[n].m(C,null))}for(;n<P.length;n+=1)P[n].d(1);P.length=_.length}2&e&&Object(s.P)(C,t[1])},d(t){t&&Object(s.r)(e),Object(s.q)(P,t),Object(s.N)(U)}}}function rt(t){let e,n,c,r,o,l,i,a,b,u,d=t[9]()+"",f=t[4]&&function(t){let e,n;return{c(){e=Object(s.X)("for "),n=Object(s.s)("span"),n.textContent=`${t[4]}`,Object(s.f)(n,"class","show-name svelte-1w2ba3z")},m(t,c){Object(s.B)(t,e,c),Object(s.B)(t,n,c)},p:s.G,d(t){t&&Object(s.r)(e),t&&Object(s.r)(n)}}}(t);return{c(){e=Object(s.s)("button"),n=Object(s.X)("Use the last alignment\n\t\t\t\t\n\t\t\t\t"),f&&f.c(),c=Object(s.U)(),r=Object(s.s)("br"),o=Object(s.X)("\n\t\t\t\t("),l=Object(s.X)(d),i=Object(s.X)(")"),a=Object(s.U)(),b=Object(s.s)("button"),b.textContent="Choose a different alignment...",Object(s.f)(e,"class","svelte-1w2ba3z"),Object(s.f)(b,"class","secondary svelte-1w2ba3z")},m(d,p){Object(s.B)(d,e,p),Object(s.d)(e,n),f&&f.m(e,null),Object(s.d)(e,c),Object(s.d)(e,r),Object(s.d)(e,o),Object(s.d)(e,l),Object(s.d)(e,i),Object(s.B)(d,a,p),Object(s.B)(d,b,p),u=[Object(s.D)(e,"click",t[10]),Object(s.D)(b,"click",t[21])]},p(t,e){t[4]&&f.p(t,e)},d(t){t&&Object(s.r)(e),f&&f.d(),t&&Object(s.r)(a),t&&Object(s.r)(b),Object(s.N)(u)}}}function ot(t){let e,n,c,r,o=t[24].text.trim()+"";return{c(){e=Object(s.s)("option"),n=Object(s.X)(o),c=Object(s.U)(),e.__value=r=t[24],e.value=e.__value},m(t,r){Object(s.B)(t,e,r),Object(s.d)(e,n),Object(s.d)(e,c)},p:s.G,d(t){t&&Object(s.r)(e)}}}function lt(t){let e,n,c,r,o;function l(t,e){return t[2]!==t[7].lastAlignment&&t[5]?nt:st}let i=l(t),a=i(t);function b(t,e){return t[2]===t[7].lastAlignment?rt:t[2]===t[7].alternatives?ct:void 0}let u=b(t),d=u&&u(t);return{c(){e=Object(s.s)("div"),n=Object(s.s)("div"),a.c(),c=Object(s.U)(),r=Object(s.s)("h1"),r.textContent="Alignment Adjustment",o=Object(s.U)(),d&&d.c(),Object(s.f)(r,"class","svelte-1w2ba3z"),Object(s.f)(n,"class","alignment-panel svelte-1w2ba3z"),Object(s.f)(e,"class","column svelte-1w2ba3z")},m(t,l){Object(s.B)(t,e,l),Object(s.d)(e,n),a.m(n,null),Object(s.d)(n,c),Object(s.d)(n,r),Object(s.d)(n,o),d&&d.m(n,null)},p(t,[e]){i===(i=l(t))&&a?a.p(t,e):(a.d(1),a=i(t),a&&(a.c(),a.m(n,c))),u===(u=b(t))&&d?d.p(t,e):(d&&d.d(1),d=u&&u(t),d&&(d.c(),d.m(n,null)))},i:s.G,o:s.G,d(t){t&&Object(s.r)(e),a.d(),d&&d.d()}}}function it(t,e,n){let{subtitles:r}=e;const o=Object(c.a)(),l=document.querySelector(".video-title"),i=l?l.textContent:"",a=`last-used-alignment-${i}`,b=parseInt(GM_getValue(a),10),u=!isNaN(b),d=(b/1e3).toFixed(2),f=r.getAlignmentCandidates(),p={lastAlignment:"last-alignment",alternatives:"alternatives"};let j=u?d:0,O=f[0],h=u?p.lastAlignment:p.alternatives;function g(t){const e=document.querySelector("video"),n="number"==typeof t?t:1e3*e.currentTime-O.start-400;GM_setValue(a,n),o("set-align",n)}return t.$set=t=>{"subtitles"in t&&n(12,r=t.subtitles)},[j,O,h,o,i,u,f,p,function(){const t=parseFloat(j);isNaN(t)?alert("Please enter a valid number!"):g(1e3*t)},function(){return 0===b?"no adjustment":b>0?`delayed by ${d} seconds`:`hastened by ${Math.abs(d)} seconds`},function(){g(b)},g,r,l,a,b,d,"",function(){h!==p.lastAlignment&&u?n(2,h=p.lastAlignment):o("reselect")},()=>o("reselect"),()=>n(2,h=p.lastAlignment),()=>n(2,h=p.alternatives),function(){j=this.value,n(0,j)},function(){O=Object(s.Q)(this),n(1,O),n(6,f)}]}class at extends s.a{constructor(t){var e;super(),tt.getElementById("svelte-1w2ba3z-style")||((e=Object(s.s)("style")).id="svelte-1w2ba3z-style",e.textContent=".column.svelte-1w2ba3z.svelte-1w2ba3z{display:flex;flex-direction:column}button.svelte-1w2ba3z.svelte-1w2ba3z{margin:0.5rem;align-self:center;max-width:20rem}.row.svelte-1w2ba3z.svelte-1w2ba3z{display:flex;flex-direction:row;justify-content:center;align-content:center}.row.svelte-1w2ba3z button.svelte-1w2ba3z{max-width:15rem}.show-name.svelte-1w2ba3z.svelte-1w2ba3z{font-style:italic}.alignment-panel.svelte-1w2ba3z.svelte-1w2ba3z{background:rgba(27, 26, 38, 0.8);align-self:center;padding:0.5rem;display:flex;flex-direction:column;border-radius:4px;justify-content:center}.alignment-panel.svelte-1w2ba3z>.svelte-1w2ba3z:not(select):not(button){color:white}h1.svelte-1w2ba3z.svelte-1w2ba3z,h2.svelte-1w2ba3z.svelte-1w2ba3z{margin:0}h1.svelte-1w2ba3z.svelte-1w2ba3z{font-size:1.3rem;border-bottom:2px solid #f47521}h2.svelte-1w2ba3z.svelte-1w2ba3z{font-size:1.1rem;border-bottom:2px solid #733a12;margin-bottom:0.2rem}.alternate-alignment-choice+.alternate-alignment-choice.svelte-1w2ba3z.svelte-1w2ba3z{margin-left:0.5rem;padding-left:0.5rem;border-left:1px solid white}p.svelte-1w2ba3z.svelte-1w2ba3z,label.svelte-1w2ba3z.svelte-1w2ba3z{max-width:14rem}.alignment-sign-hint.svelte-1w2ba3z.svelte-1w2ba3z{font-size:0.8rem}#manual-alignment.svelte-1w2ba3z.svelte-1w2ba3z{width:5rem;align-self:center}.alternate-alignment-choice.svelte-1w2ba3z.svelte-1w2ba3z:not(:hover){opacity:0.6}@media(max-width: 700px){button.svelte-1w2ba3z.svelte-1w2ba3z,input.svelte-1w2ba3z.svelte-1w2ba3z,label.svelte-1w2ba3z.svelte-1w2ba3z,pre.svelte-1w2ba3z.svelte-1w2ba3z{font-size:0.7rem !important}.alignment-sign-hint.svelte-1w2ba3z.svelte-1w2ba3z{font-size:0.6rem}button.svelte-1w2ba3z.svelte-1w2ba3z{padding:4px}}#reaction-subtitle-chooser.svelte-1w2ba3z.svelte-1w2ba3z{position:relative;cursor:pointer}#reaction-subtitle-chooser.svelte-1w2ba3z pre.svelte-1w2ba3z,span.svelte-1w2ba3z.svelte-1w2ba3z{align-self:center;pointer-events:none}#reaction-subtitle-chooser.svelte-1w2ba3z span.svelte-1w2ba3z{margin-left:1rem}#reaction-subtitle-chooser.svelte-1w2ba3z pre.svelte-1w2ba3z{z-index:1;position:relative;margin:0;font-size:1.1rem}#reaction-subtitle-chooser.svelte-1w2ba3z select.svelte-1w2ba3z{height:100%;position:absolute;top:0;left:0;opacity:0}",Object(s.d)(tt.head,e)),Object(s.A)(this,t,it,lt,s.O,{subtitles:12})}}var bt=at;const{document:ut}=s.x;function dt(t){let e;const n=new q({props:{mode:"cancelled"}});return n.$on("restart",t[6]),{c(){Object(s.m)(n.$$.fragment)},m(t,c){Object(s.F)(n,t,c),e=!0},p:s.G,i(t){e||(Object(s.ab)(n.$$.fragment,t),e=!0)},o(t){Object(s.bb)(n.$$.fragment,t),e=!1},d(t){Object(s.p)(n,t)}}}function ft(t){let e,n;const c=new T({props:{format:t[2].format,styles:t[2].styles,current:t[1],currentTime:t[5]}});c.$on("define-pauser",t[10]);const r=new q({props:{recentSubs:t[4],subtitles:t[2],alignment:t[3]}});return r.$on("restart",t[6]),r.$on("tray-pauser",t[9]),r.$on("define-pauser",t[10]),r.$on("realign",t[18]),{c(){Object(s.m)(c.$$.fragment),e=Object(s.U)(),Object(s.m)(r.$$.fragment)},m(t,o){Object(s.F)(c,t,o),Object(s.B)(t,e,o),Object(s.F)(r,t,o),n=!0},p(t,e){const n={};4&e&&(n.format=t[2].format),4&e&&(n.styles=t[2].styles),2&e&&(n.current=t[1]),c.$set(n);const s={};16&e&&(s.recentSubs=t[4]),4&e&&(s.subtitles=t[2]),8&e&&(s.alignment=t[3]),r.$set(s)},i(t){n||(Object(s.ab)(c.$$.fragment,t),Object(s.ab)(r.$$.fragment,t),n=!0)},o(t){Object(s.bb)(c.$$.fragment,t),Object(s.bb)(r.$$.fragment,t),n=!1},d(t){Object(s.p)(c,t),t&&Object(s.r)(e),Object(s.p)(r,t)}}}function pt(t){let e;const n=new bt({props:{subtitles:t[2]}});return n.$on("set-align",t[7]),n.$on("reselect",t[17]),{c(){Object(s.m)(n.$$.fragment)},m(t,c){Object(s.F)(n,t,c),e=!0},p(t,e){const s={};4&e&&(s.subtitles=t[2]),n.$set(s)},i(t){e||(Object(s.ab)(n.$$.fragment,t),e=!0)},o(t){Object(s.bb)(n.$$.fragment,t),e=!1},d(t){Object(s.p)(n,t)}}}function jt(t){let e;const n=new Q({});return n.$on("subtitles-loaded",t[8]),n.$on("cancel",t[16]),{c(){Object(s.m)(n.$$.fragment)},m(t,c){Object(s.F)(n,t,c),e=!0},p:s.G,i(t){e||(Object(s.ab)(n.$$.fragment,t),e=!0)},o(t){Object(s.bb)(n.$$.fragment,t),e=!1},d(t){Object(s.p)(n,t)}}}function Ot(t){let e,n,c,r;const o=[jt,pt,ft,dt],l=[];function i(t,e){return"prompt"===t[0]?0:"align"===t[0]?1:"play"===t[0]?2:"cancelled"===t[0]?3:-1}return~(n=i(t))&&(c=l[n]=o[n](t)),{c(){e=Object(s.s)("div"),c&&c.c(),Object(s.f)(e,"class","subtitles-app svelte-j297nn")},m(t,c){Object(s.B)(t,e,c),~n&&l[n].m(e,null),r=!0},p(t,[r]){let a=n;n=i(t),n===a?~n&&l[n].p(t,r):(c&&(Object(s.y)(),Object(s.bb)(l[a],1,1,()=>{l[a]=null}),Object(s.h)()),~n?(c=l[n],c||(c=l[n]=o[n](t),c.c()),Object(s.ab)(c,1),c.m(e,null)):c=null)},i(t){r||(Object(s.ab)(c),r=!0)},o(t){Object(s.bb)(c),r=!1},d(t){t&&Object(s.r)(e),~n&&l[n].d()}}}function ht(t,e,n){const s=new I;let r="prompt",o=[],l=null,i=null,a=-1,b=[];function u(){n(0,r="prompt"),n(2,l=null),n(1,o=[])}function d(t){let e=t[t.length-1],s=b[b.length-1];!e||s&&e.text===s.text||n(4,b=[...b,e]),b.length>10&&n(4,b=b.slice(b.length-10))}function f(){"play"===r&&(n(1,o=l.getSubs(1e3*i.currentTime-a)),d(o),requestAnimationFrame(f))}Object(c.c)(()=>{document.addEventListener("visibilitychange",()=>{document.hidden||s.removePauser("define")});let t="";setInterval(()=>{const e=document.querySelector("video").getAttribute("src");e&&e!==t&&(t=e,u())},50)});return[r,o,l,a,b,"",u,function(t){i=document.querySelector("video"),s.setVideo(i),n(3,a=t.detail),n(4,b=[]),n(0,r="play"),f()},function(t){n(2,l=t.detail),0===l.subs.length?(console.log("subtitles object failed to parse: ",l),alert("No subtitles were able to be parsed from the selected subtitle file, verify nothing is wrong with the file. If it appears normal please submit a bug report with the episode and the subtitles file you used to the issue tracker (a link can be found in the tray on the right side of the video player)!"),n(0,r="cancelled")):n(0,r="align")},function(t){t.detail?s.addPauser("tray"):s.removePauser("tray")},function(){s.addPauser("define")},i,"last-used-alignment",s,d,f,()=>n(0,r="cancelled"),()=>n(0,r="prompt"),()=>n(0,r="align")]}class gt extends s.a{constructor(t){var e;super(),ut.getElementById("svelte-j297nn-style")||((e=Object(s.s)("style")).id="svelte-j297nn-style",e.textContent='.subtitles-app.svelte-j297nn{position:relative;font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;text-align:center}.subtitles-app.svelte-j297nn>*{z-index:1000000000}.subtitles-app.svelte-j297nn button,.subtitles-app.svelte-j297nn .button{background:#fd0;border:none;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;font-size:0.9rem}.subtitles-app.svelte-j297nn .small-button{font-size:0.6rem}.subtitles-app.svelte-j297nn button:disabled,.subtitles-app.svelte-j297nn .button:disabled{background:#2a3450}.subtitles-app.svelte-j297nn button.secondary,.subtitles-app.svelte-j297nn .button.secondary{background:#11121863;border:1px solid #fd0;color:#fd0}.subtitles-app.svelte-j297nn button:not(:disabled):hover,.subtitles-app.svelte-j297nn .button:not(:disabled):hover{background:#ffea6d;cursor:pointer;color:black}.subtitles-app.svelte-j297nn .sr{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}',Object(s.d)(ut.head,e)),Object(s.A)(this,t,ht,Ot,s.O,{})}}var mt=gt;const xt=document.createElement("div");location.host.includes("crunchyroll")?document.getElementById("vilosRoot").appendChild(xt):document.body.appendChild(xt),xt.id="sheodox-jimaku-player",xt.style.position="fixed",xt.style.width="100%";new mt({target:xt})}]);
