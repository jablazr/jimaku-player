// ==UserScript==
// @name         字幕プレーヤー
// @namespace    https://github.com/sheodox
// @version      0.1.31
// @description  Study Japanese by using Japanese subtitles on VRV!
// @author       sheodox
// @match        https://static.vrv.co/vilos/player.html
// @grant        GM_getValue
// @grant        GM_setValue
// ==/UserScript==

!function(t){var e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e,n){"use strict";function r(){}n.d(e,"a",(function(){return Mt})),n.d(e,"b",(function(){return ct})),n.d(e,"c",(function(){return q})),n.d(e,"d",(function(){return m})),n.d(e,"e",(function(){return o})),n.d(e,"f",(function(){return A})),n.d(e,"g",(function(){return tt})),n.d(e,"h",(function(){return gt})),n.d(e,"i",(function(){return f})),n.d(e,"j",(function(){return U})),n.d(e,"k",(function(){return Z})),n.d(e,"l",(function(){return $t})),n.d(e,"m",(function(){return Et})),n.d(e,"n",(function(){return vt})),n.d(e,"o",(function(){return yt})),n.d(e,"p",(function(){return At})),n.d(e,"q",(function(){return $})),n.d(e,"r",(function(){return y})),n.d(e,"s",(function(){return w})),n.d(e,"t",(function(){return P})),n.d(e,"u",(function(){return kt})),n.d(e,"v",(function(){return W})),n.d(e,"w",(function(){return d})),n.d(e,"x",(function(){return wt})),n.d(e,"y",(function(){return Ot})),n.d(e,"z",(function(){return s})),n.d(e,"A",(function(){return Bt})),n.d(e,"B",(function(){return v})),n.d(e,"C",(function(){return a})),n.d(e,"D",(function(){return E})),n.d(e,"E",(function(){return x})),n.d(e,"F",(function(){return Nt})),n.d(e,"G",(function(){return r})),n.d(e,"H",(function(){return j})),n.d(e,"I",(function(){return X})),n.d(e,"J",(function(){return J})),n.d(e,"K",(function(){return St})),n.d(e,"L",(function(){return N})),n.d(e,"M",(function(){return O})),n.d(e,"N",(function(){return l})),n.d(e,"O",(function(){return u})),n.d(e,"P",(function(){return _})),n.d(e,"Q",(function(){return G})),n.d(e,"R",(function(){return R})),n.d(e,"S",(function(){return C})),n.d(e,"T",(function(){return b})),n.d(e,"U",(function(){return S})),n.d(e,"V",(function(){return k})),n.d(e,"W",(function(){return M})),n.d(e,"X",(function(){return F})),n.d(e,"Y",(function(){return ht})),n.d(e,"Z",(function(){return xt})),n.d(e,"ab",(function(){return Ct})),n.d(e,"bb",(function(){return B}));const s=t=>t;function o(t,e){for(const n in e)t[n]=e[n];return t}function c(t){return t()}function i(){return Object.create(null)}function l(t){t.forEach(c)}function a(t){return"function"==typeof t}function u(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function b(t,...e){if(null==t)return r;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function d(t){let e;return b(t,t=>e=t)(),e}function f(t,e,n){t.$$.on_destroy.push(b(e,n))}const p="undefined"!=typeof window;let j=p?()=>window.performance.now():()=>Date.now(),O=p?t=>requestAnimationFrame(t):r;const g=new Set;function h(t){g.forEach(e=>{e.c(t)||(g.delete(e),e.f())}),0!==g.size&&O(h)}function x(t){let e;return 0===g.size&&O(h),{promise:new Promise(n=>{g.add(e={c:t,f:n})}),abort(){g.delete(e)}}}function m(t,e){t.appendChild(e)}function v(t,e,n){t.insertBefore(e,n||null)}function y(t){t.parentNode.removeChild(t)}function $(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function S(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function k(t){return document.createTextNode(t)}function C(){return k(" ")}function P(){return k("")}function E(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function N(t){return function(e){return e.preventDefault(),t.call(this,e)}}function A(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function B(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function M(t){return""===t?void 0:+t}function _(t,e){e=""+e,t.data!==e&&(t.data=e)}function G(t,e){(null!=e||t.value)&&(t.value=e)}function R(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function F(t,e,n){t.classList[n?"add":"remove"](e)}function D(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let V,T,I=0,Y={};function H(t,e,n,r,s,o,c,i=0){const l=16.666/r;let a="{\n";for(let t=0;t<=1;t+=l){const r=e+(n-e)*o(t);a+=100*t+`%{${c(r,1-r)}}\n`}const u=a+`100% {${c(n,1-n)}}\n}`,b=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${i}`;if(!Y[b]){if(!V){const t=w("style");document.head.appendChild(t),V=t.sheet}Y[b]=!0,V.insertRule(`@keyframes ${b} ${u}`,V.cssRules.length)}const d=t.style.animation||"";return t.style.animation=`${d?`${d}, `:""}${b} ${r}ms linear ${s}ms 1 both`,I+=1,b}function z(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--I&&O(()=>{if(I)return;let t=V.cssRules.length;for(;t--;)V.deleteRule(t);Y={}})}function Z(t,e,n,o){if(!e)return r;const c=t.getBoundingClientRect();if(e.left===c.left&&e.right===c.right&&e.top===c.top&&e.bottom===c.bottom)return r;const{delay:i=0,duration:l=300,easing:a=s,start:u=j()+i,end:b=u+l,tick:d=r,css:f}=n(t,{from:e,to:c},o);let p,O=!0,g=!1;function h(){f&&z(t,p),O=!1}return x(t=>{if(!g&&t>=u&&(g=!0),g&&t>=b&&(d(1,0),h()),!O)return!1;if(g){const e=0+1*a((t-u)/l);d(e,1-e)}return!0}),f&&(p=H(t,0,1,l,i,a,f)),i||(g=!0),d(0,1),h}function W(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:r}=e,s=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,q(t,s)}}function q(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),s="none"===r.transform?"":r.transform;t.style.transform=`${s} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function L(t){T=t}function K(){if(!T)throw new Error("Function called outside component initialization");return T}function J(t){K().$$.on_mount.push(t)}function X(t){K().$$.on_destroy.push(t)}function U(){const t=K();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const s=D(e,n);r.slice().forEach(e=>{e.call(t,s)})}}}const Q=[],tt=[],et=[],nt=[],rt=Promise.resolve();let st=!1;function ot(){st||(st=!0,rt.then(at))}function ct(t){et.push(t)}let it=!1;const lt=new Set;function at(){if(!it){it=!0;do{for(let t=0;t<Q.length;t+=1){const e=Q[t];L(e),ut(e.$$)}for(Q.length=0;tt.length;)tt.pop()();for(let t=0;t<et.length;t+=1){const e=et[t];lt.has(e)||(lt.add(e),e())}et.length=0}while(Q.length);for(;nt.length;)nt.pop()();st=!1,it=!1,lt.clear()}}function ut(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ct)}}let bt;function dt(){return bt||(bt=Promise.resolve(),bt.then(()=>{bt=null})),bt}function ft(t,e,n){t.dispatchEvent(D(`${e?"intro":"outro"}${n}`))}const pt=new Set;let jt;function Ot(){jt={r:0,c:[],p:jt}}function gt(){jt.r||l(jt.c),jt=jt.p}function ht(t,e){t&&t.i&&(pt.delete(t),t.i(e))}function xt(t,e,n,r){if(t&&t.o){if(pt.has(t))return;pt.add(t),jt.c.push(()=>{pt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}const mt={duration:0};function vt(t,e,n){let o,c,i=e(t,n),l=!1,u=0;function b(){o&&z(t,o)}function d(){const{delay:e=0,duration:n=300,easing:a=s,tick:d=r,css:f}=i||mt;f&&(o=H(t,0,1,n,e,a,f,u++)),d(0,1);const p=j()+e,O=p+n;c&&c.abort(),l=!0,ct(()=>ft(t,!0,"start")),c=x(e=>{if(l){if(e>=O)return d(1,0),ft(t,!0,"end"),b(),l=!1;if(e>=p){const t=a((e-p)/n);d(t,1-t)}}return l})}let f=!1;return{start(){f||(z(t),a(i)?(i=i(),dt().then(d)):d())},invalidate(){f=!1},end(){l&&(b(),l=!1)}}}function yt(t,e,n){let o,c=e(t,n),i=!0;const u=jt;function b(){const{delay:e=0,duration:n=300,easing:a=s,tick:b=r,css:d}=c||mt;d&&(o=H(t,1,0,n,e,a,d));const f=j()+e,p=f+n;ct(()=>ft(t,!1,"start")),x(e=>{if(i){if(e>=p)return b(0,1),ft(t,!1,"end"),--u.r||l(u.c),!1;if(e>=f){const t=a((e-f)/n);b(1-t,t)}}return i})}return u.r+=1,a(c)?dt().then(()=>{c=c(),b()}):b(),{end(e){e&&c.tick&&c.tick(1,0),i&&(o&&z(t,o),i=!1)}}}function $t(t,e,n,o){let c=e(t,n),i=o?0:1,u=null,b=null,d=null;function f(){d&&z(t,d)}function p(t,e){const n=t.b-i;return e*=Math.abs(n),{a:i,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function O(e){const{delay:n=0,duration:o=300,easing:a=s,tick:O=r,css:g}=c||mt,h={start:j()+n,b:e};e||(h.group=jt,jt.r+=1),u?b=h:(g&&(f(),d=H(t,i,e,o,n,a,g)),e&&O(0,1),u=p(h,o),ct(()=>ft(t,e,"start")),x(e=>{if(b&&e>b.start&&(u=p(b,o),b=null,ft(t,u.b,"start"),g&&(f(),d=H(t,i,u.b,u.duration,0,a,c.css))),u)if(e>=u.end)O(i=u.b,1-i),ft(t,u.b,"end"),b||(u.b?f():--u.group.r||l(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;i=u.a+u.d*a(t/u.duration),O(i,1-i)}return!(!u&&!b)}))}return{run(t){a(c)?dt().then(()=>{c=c(),O(t)}):O(t)},end(){f(),u=b=null}}}const wt="undefined"!=typeof window?window:global;function St(t,e){xt(t,1,1,()=>{e.delete(t.key)})}function kt(t,e){t.f(),St(t,e)}function Ct(t,e,n,r,s,o,c,i,l,a,u,b){let d=t.length,f=o.length,p=d;const j={};for(;p--;)j[t[p].key]=p;const O=[],g=new Map,h=new Map;for(p=f;p--;){const t=b(s,o,p),i=n(t);let l=c.get(i);l?r&&l.p(t,e):(l=a(i,t),l.c()),g.set(i,O[p]=l),i in j&&h.set(i,Math.abs(p-j[i]))}const x=new Set,m=new Set;function v(t){ht(t,1),t.m(i,u),c.set(t.key,t),u=t.first,f--}for(;d&&f;){const e=O[f-1],n=t[d-1],r=e.key,s=n.key;e===n?(u=e.first,d--,f--):g.has(s)?!c.has(r)||x.has(r)?v(e):m.has(s)?d--:h.get(r)>h.get(s)?(m.add(r),v(e)):(x.add(s),d--):(l(n,c),d--)}for(;d--;){const e=t[d];g.has(e.key)||l(e,c)}for(;f;)v(O[f-1]);return O}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let Pt;function Et(t){t&&t.c()}function Nt(t,e,n){const{fragment:r,on_mount:s,on_destroy:o,after_update:i}=t.$$;r&&r.m(e,n),ct(()=>{const e=s.map(c).filter(a);o?o.push(...e):l(e),t.$$.on_mount=[]}),i.forEach(ct)}function At(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Bt(t,e,n,s,o,c,a=[-1]){const u=T;L(t);const b=e.props||{},d=t.$$={fragment:null,ctx:null,props:c,update:r,not_equal:o,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:a};let f=!1;d.ctx=n?n(t,b,(e,n,...r)=>{const s=r.length?r[0]:n;return d.ctx&&o(d.ctx[e],d.ctx[e]=s)&&(d.bound[e]&&d.bound[e](s),f&&function(t,e){-1===t.$$.dirty[0]&&(Q.push(t),ot(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],d.update(),f=!0,l(d.before_update),d.fragment=!!s&&s(d.ctx),e.target&&(e.hydrate?d.fragment&&d.fragment.l(function(t){return Array.from(t.childNodes)}(e.target)):d.fragment&&d.fragment.c(),e.intro&&ht(t.$$.fragment),Nt(t,e.target,e.anchor),at()),L(u)}"function"==typeof HTMLElement&&(Pt=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){At(this,1),this.$destroy=r}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}});class Mt{$destroy(){At(this,1),this.$destroy=r}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}));var r=n(0);function s(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function o(t){const e=t-1;return e*e*e+1}n.d(e,"c",(function(){return r.z}))},function(t,e,n){"use strict";var r=n(0);n.d(e,"a",(function(){return r.j})),n.d(e,"b",(function(){return r.I})),n.d(e,"c",(function(){return r.J}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}));var r=n(1);n(0);function s(t,{delay:e=0,duration:n=400,easing:s=r.c}){const o=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:s,css:t=>`opacity: ${t*o}`}}function o(t,{delay:e=0,duration:n=400,easing:s=r.b,x:o=0,y:c=0,opacity:i=0}){const l=getComputedStyle(t),a=+l.opacity,u="none"===l.transform?"":l.transform,b=a*(1-i);return{delay:e,duration:n,easing:s,css:(t,e)=>`\n\t\t\ttransform: ${u} translate(${(1-t)*o}px, ${(1-t)*c}px);\n\t\t\topacity: ${a-b*e}`}}},,,,function(t,e){t.exports=class{constructor(t,e){this.format=t,this.fileName=e,this.subs=[]}getSubs(t){return this.subs.filter(e=>e.start<=t&&e.end>=t)}timeToMs(t){const[e,n,r]=t.split(":");return 36e5*+e+6e4*+n+1e3*parseFloat(r)}firstSubtitle(){return this.subs.reduce((t,e)=>e.start<t.start?e:t,{start:1/0})}}},function(t,e,n){const r=n(7),s=t=>(t.charAt(0).toLowerCase()+t.substring(1)).replace(" ",""),o=t=>{if(t){t=(t=t.replace(/[&H]/g,"")).padStart(8,"0");const[e,n,r,s,o]=t.match(/([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i),c=t=>parseInt(t,16);return`rgba(${c(o)}, ${c(s)}, ${c(r)}, ${255-c(n)})`}},c=(t,e,n="transparent",r=0,s=0)=>{const o=t||n;r*=2,s=`${s}px`;const c=[];for(let t=-1*(e=2*(void 0===e?1:e));t<=e;t++)for(let n=-1*e;n<=e;n++)c.push(`${t}px ${n}px ${s} ${o}`);return`text-shadow: ${c.join(", ")}, ${r}px ${r}px ${s} ${n}`},i=t=>`font-family: "${t}", "Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif`;function l(t,e,n=!1){const r=new RegExp(n?`\\\\${e}\\((.*?)\\)`:`\\\\${e}([^\\\\}]*)`),s=t.match(r);if(s)return{overrides:t.replace(s[0],""),params:n?s[1].split(","):s[1]}}t.exports=class extends r{constructor(t,e){super("ass",e),t=t.replace(/\r\n/g,"\n");try{this.blocks=this.parseBlocks(t),this.subs=this.parseBlock(this.blocks.subs),this.parseInfo(this.blocks.info),this.parseSubTimings(),this.parseStyles(this.parseBlock(this.blocks.styles)),this.parseSubOverrideTags()}catch(t){console.error("ASS PARSE ERROR",t),this.subs=[]}}serialize(){return JSON.stringify({info:this.info,styles:this.styles,subs:this.subs},null,4)}debugInfo(){return[{title:"Number of styles",detail:Object.keys(this.styles).length},{title:"Number of subtitles",detail:this.subs.length}]}parseInfo(){this.info={},this.blocks.info.split("\n").forEach(t=>{const[e,n]=t.split(": ");this.info[s(e)]=n})}scaleHeight(t){return`${t/+this.info.playResY*100}vh`}scaleWidth(t){return`${t/+this.info.playResX*100}vw`}parseBlocks(t){const e=t.split(/\n(?=\[)/),n=t=>e.find(e=>{e=e.trim();const[n,r]=e.match(/^\[(.*?)]/);return r===t}).replace(/.*\n/,"").trim();return{info:n("Script Info"),styles:n("V4+ Styles"),subs:n("Events")}}parseBlock(t){const[e,...n]=t.split("\n"),r=(t,e=1/0)=>{let[n,r,s]=t.match(/(\w*): (.*)/);return s=s.split(","),s.length>e&&(s[e-1]=s.slice(e-1).join(","),s.splice(e,1/0)),{type:r,attributes:s}},o=r(e);return n.reduce((t,e)=>{if(!e||";"===e.charAt(0)||0===e.indexOf("Comment: "))return t;const n=r(e,o.attributes.length),c={dataType:n.type.toLowerCase()};return o.attributes.forEach((t,e)=>{t=t.trim();const r=s(t);c[r]=n.attributes[e]}),c.style="*Default"===c.style?"Default":c.style,t.push(c),t},[])}parseSubTimings(){this.subs.forEach(t=>{t.start=this.timeToMs(t.start),t.end=this.timeToMs(t.end)})}parseStyles(t){const e={};t.forEach(t=>{for(const e of Object.keys(t).filter(t=>/colour/i.test(t)))t[e]=o(t[e]);t.name="*Default"===t.name?"Default":t.name;const n=[],{primaryColour:r,secondaryColour:s,outlineColour:l,backColour:a,borderStyle:u,outline:b,shadow:d,fontname:f,fontsize:p,bold:j,italic:O,underline:g,strikeOut:h}=t;r&&n.push(`color: ${r}`),f&&n.push(i(f)),"1"===u?n.push(c(l,b,a,d)):"3"===u&&n.push(`background-color: ${a}`),"-1"===j&&n.push("font-weight: bold"),"-1"===O&&n.push("font-style: italic"),"-1"!==g&&"-1"!==h||n.push(`text-decoration: ${"-1"===g?"underline":""} ${"-1"===h?"line-through":""}`),e[t.name]={inline:n.join(";"),...this.genScaledFont(p),raw:t}}),this.styles=e}genScaledFont(t){return{fontScaled:this.scaleHeight(.75*t),fontMax:`${t}px`,fontScalingThreshold:+this.info.playResY,fontRaw:t}}parseSubOverrideTags(){this.subs.forEach(t=>{if(t.rawText=t.text,t.text=t.text.replace("\\N","\n"),!/{.+?}/.test(t.text))return;t.phrases=[];const e=t=>t.replace(/{.*?}/g,""),n=function*(t){const e=/({.*?}[^{]*)/g;let n;const r=t.indexOf("{");for(r>0&&(yield t.substring(0,r));null!==(n=e.exec(t));)yield n[1]}(t.text);let r=[];for(const u of n){const n=[],b={text:e(u),fadeIn:0,fadeOut:0,inline:""};let d,f,p,j,O,g=u.match(/{.*?}/),h=g?g[0]:"";function s(t,e=!1,n=(()=>{})){const r=l(h,t,e);r&&(n(r.params),h=r.overrides)}function a(t,e,n){const r=t.map((t,n)=>{const r=Array.isArray(e)?e[n]:e,s=l(h,t,r);if(s)return h=s.overrides,s.params});r.some(t=>void 0!==t)&&n(...r)}if(s("fscx"),s("fscy"),s("3c",!1,t=>{d=t}),s("4c",!1,t=>{f=t}),s("bord",!1,t=>{p=t}),s("shad",!1,t=>{j=t}),s("blur",!1,t=>{O=t}),s("be",!1,t=>{O=t}),[d,f,p,j,O].some(t=>void 0!==t)){const e=this.styles[t.style],n=(t,n)=>void 0!==t?t:e.raw[n];e&&(d=n(o(d),"outlineColour"),f=n(o(f),"backColour"),p=n(p,"outline"),j=n(j,"shadow"),r.push(c(d,p,f,j,O)))}a(["pos","an","org"],[!0,!1,!0],(t,e="5",s)=>{if(t){const[o,c]=t;n.push(`position: fixed; left: ${this.scaleWidth(o)}; top: ${this.scaleHeight(c)}`);const i={1:"50%, -150%",2:"-50%, -150%",3:"-150%, -150%",4:"50%, -50%",5:"-50%, -50%",6:"-150%, -50%",7:"50%, 50%",8:"-50%, 50%",9:"-150%, 50%"}[e];if(n.push(`transform: translate(${i})`),s){const[t,e]=s;r.push(`transform-origin: ${this.scaleWidth(t)} ${this.scaleHeight(e)}`)}}}),a(["frx","fry","frz"],!1,(t,e,s)=>{const o=[],c=(t,e,n=1)=>{if(void 0!==t)return t=parseFloat(t)*n,o.push(`rotate3d(${e.join(", ")}, ${t}deg)`)};c(t,[1,0,0]),c(s,[0,0,1],-1),c(e,[0,1,0]),o.length&&(n.push("perspective: 200px"),r.push(`display: block; transform: ${o.join(" ")}`))}),s("fad",!0,([e,n])=>{b.fadeIn=e,b.fadeOut=n,t.end-=n}),s("fsp",!1,t=>{r.push(`letter-spacing: ${t}px`)}),s("fs",!1,t=>{Object.assign(b,this.genScaledFont(t))});const x=[];s("u",!1,t=>{x.push("underline")}),s("s",!1,t=>{x.push("line-through")}),r.push(`text-decoration: ${x.length?x.join(" "):"none"}`),s("b",!1,t=>{r.push(`font-weight: ${t?"bold":"normal"}`)}),s("i",!1,t=>{r.push(`font-style: ${t?"italic":"normal"}`)}),s("fn",!1,t=>{r.push(i(t))}),s("1c",!1,t=>{r.push(`color: ${o(t)}`)}),s("r",!1,t=>{if(t){const e=this.styles[t];r=[e.inline],Object.assign(b,this.genScaledFont(e.fontRaw))}else r=[]}),b.inline=r.join(";"),t.phrases.push(b),n.length&&(t.inline=n.join(";"))}t.text=e(t.text)})}}},,function(t,e,n){"use strict";n.r(e);var r=n(0),s=n(2);const o=[];function c(t,e=r.G){let n;const s=[];function c(e){if(Object(r.O)(t,e)&&(t=e,n)){const e=!o.length;for(let e=0;e<s.length;e+=1){const n=s[e];n[1](),o.push(n,t)}if(e){for(let t=0;t<o.length;t+=2)o[t][0](o[t+1]);o.length=0}}}return{set:c,update:function(e){c(e(t))},subscribe:function(o,i=r.G){const l=[o,i];return s.push(l),1===s.length&&(n=e(c)||r.G),o(t),()=>{const t=s.indexOf(l);-1!==t&&s.splice(t,1),0===s.length&&(n(),n=null)}}}}const i={subtitleFallbackColor:"#FFFFFF",showSubtitlesOnVideo:!0,pauseWhenTrayOpen:!0,invertVerticalAlignment:!0},l=Object.assign({},i,GM_getValue("settings-store",{})),a={};Object.keys(i).forEach(t=>{(a[t]=c(l[t])).subscribe(e=>{l[t]=e,GM_setValue("settings-store",l)})});const u=a.subtitleFallbackColor,b=a.showSubtitlesOnVideo,d=a.pauseWhenTrayOpen,f=a.invertVerticalAlignment;var p=n(3),j=n(1);function O(t,e,n){const s=getComputedStyle(t),o="none"===s.transform?"":s.transform,c=e.from.width/t.clientWidth,i=e.from.height/t.clientHeight,l=(e.from.left-e.to.left)/c,a=(e.from.top-e.to.top)/i,u=Math.sqrt(l*l+a*a),{delay:b=0,duration:d=(t=>120*Math.sqrt(t)),easing:f=j.b}=n;return{delay:b,duration:Object(r.C)(d)?d(u):d,easing:f,css:(t,e)=>`transform: ${o} translate(${e*l}px, ${e*a}px);`}}function g(t){return"[object Date]"===Object.prototype.toString.call(t)}function h(t,e){if(t===e||t!=t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const n=e.map((e,n)=>h(t[n],e));return t=>n.map(e=>e(t))}if("object"===n){if(!t||!e)throw new Error("Object cannot be null");if(g(t)&&g(e)){t=t.getTime();const n=(e=e.getTime())-t;return e=>new Date(t+e*n)}const n=Object.keys(e),r={};return n.forEach(n=>{r[n]=h(t[n],e[n])}),t=>{const e={};return n.forEach(n=>{e[n]=r[n](t)}),e}}if("number"===n){const n=e-t;return e=>t+e*n}throw new Error(`Cannot interpolate ${n} values`)}function x(t,e,n){const r=t.slice();return r[31]=e[n],r}function m(t,e,n){const r=t.slice();return r[34]=e[n],r[36]=n,r}function v(t){let e,n,s,o,c,i,l,a,u,b,d,f,p,j,O,g,h,v,y,S,k,C,P,E,N,A,B,M,_,G,R,F,D,V,T,I,Y,H,z,Z,W,q,L,K,J,X,U,Q,tt,et,nt,rt,st,ot,ct,it,lt,at,ut,bt,dt,ft,pt,jt,Ot,gt,ht,xt=[],mt=new Map,vt=t[1].fileName+"",yt=t[2]>0?"+":"",$t=(t[2]/1e3).toFixed(1)+"",wt=t[0];const St=t=>t[34].text;for(let e=0;e<wt.length;e+=1){let n=m(t,wt,e),r=St(n);mt.set(r,xt[e]=$(r,n))}let kt=t[1].debugInfo(),Ct=[];for(let e=0;e<kt.length;e+=1)Ct[e]=w(x(t,kt,e));return{c(){e=Object(r.s)("div"),n=Object(r.s)("button"),s=Object(r.V)("Recent Subtitles"),c=Object(r.S)(),i=Object(r.s)("button"),l=Object(r.V)("Settings"),u=Object(r.S)(),b=Object(r.s)("button"),d=Object(r.V)("Debug"),p=Object(r.S)(),j=Object(r.s)("div"),O=Object(r.s)("h2"),O.textContent="Recent Subtitles",g=Object(r.S)(),h=Object(r.s)("ul");for(let t=0;t<xt.length;t+=1)xt[t].c();v=Object(r.S)(),y=Object(r.s)("div"),S=Object(r.s)("h2"),S.textContent="Settings",k=Object(r.S)(),C=Object(r.s)("div"),P=Object(r.s)("button"),P.textContent="Reselect subtitles",E=Object(r.S)(),N=Object(r.s)("button"),N.textContent="Realign subtitles",A=Object(r.S)(),B=Object(r.s)("div"),M=Object(r.s)("label"),M.textContent="Subtitle fallback color:",_=Object(r.S)(),G=Object(r.s)("input"),R=Object(r.S)(),F=Object(r.s)("div"),D=Object(r.s)("input"),V=Object(r.S)(),T=Object(r.s)("label"),T.textContent="Show subs over video",I=Object(r.S)(),Y=Object(r.s)("div"),H=Object(r.s)("input"),z=Object(r.S)(),Z=Object(r.s)("label"),Z.textContent="Pause when tray is open",W=Object(r.S)(),q=Object(r.s)("div"),L=Object(r.s)("input"),K=Object(r.S)(),J=Object(r.s)("label"),J.textContent="Invert subtitle vertical alignment (i.e. if subtitles should be near the bottom this will make them show near the top).\n\t\t\t\t\tYou'll likely want this enabled if you intend to watch with VRV's subtitles at the same time.",X=Object(r.S)(),U=Object(r.s)("div"),Q=Object(r.s)("h2"),Q.textContent="Debug Information",tt=Object(r.S)(),et=Object(r.s)("dl"),nt=Object(r.s)("dt"),nt.textContent="Subtitles File",rt=Object(r.s)("dd"),st=Object(r.V)(vt),ot=Object(r.s)("dt"),ot.textContent="Alignment",ct=Object(r.s)("dd"),it=Object(r.V)(yt),lt=Object(r.V)($t),at=Object(r.V)(" seconds");for(let t=0;t<Ct.length;t+=1)Ct[t].c();ut=Object(r.S)(),bt=Object(r.s)("div"),dt=Object(r.s)("a"),ft=Object(r.V)("⬇ Download Parsed Subtitles"),jt=Object(r.S)(),Ot=Object(r.s)("div"),Ot.innerHTML='<a target="_blank" href="https://github.com/sheodox/jimaku-player/issues" rel="noopener noreferrer" class="svelte-rtgo25">Issue? Report it here!</a>',n.disabled=o="recent"===t[4],i.disabled=a="settings"===t[4],b.disabled=f="debug"===t[4],Object(r.f)(e,"class","tray-tab-buttons svelte-rtgo25"),Object(r.f)(O,"class","svelte-rtgo25"),Object(r.f)(h,"class","recent-subs svelte-rtgo25"),Object(r.f)(j,"class","tab tab-recent svelte-rtgo25"),Object(r.X)(j,"tab-active","recent"===t[4]),Object(r.f)(S,"class","svelte-rtgo25"),Object(r.f)(C,"class","row svelte-rtgo25"),Object(r.f)(M,"for","subtitle-color"),Object(r.f)(G,"type","color"),Object(r.f)(G,"id","subtitle-color"),Object(r.f)(B,"class","row svelte-rtgo25"),Object(r.f)(D,"id","show-subs"),Object(r.f)(D,"type","checkbox"),Object(r.f)(T,"for","show-subs"),Object(r.f)(F,"class","row svelte-rtgo25"),Object(r.f)(H,"id","pause-on-tray"),Object(r.f)(H,"type","checkbox"),Object(r.f)(Z,"for","pause-on-tray"),Object(r.f)(Y,"class","row svelte-rtgo25"),Object(r.f)(L,"id","invert-subtitle-alignment"),Object(r.f)(L,"type","checkbox"),Object(r.f)(J,"for","invert-subtitle-alignment"),Object(r.f)(q,"class","row svelte-rtgo25"),Object(r.f)(y,"class","tab tab-settings svelte-rtgo25"),Object(r.X)(y,"tab-active","settings"===t[4]),Object(r.f)(Q,"class","svelte-rtgo25"),Object(r.f)(nt,"class","svelte-rtgo25"),Object(r.f)(rt,"class","svelte-rtgo25"),Object(r.f)(ot,"class","svelte-rtgo25"),Object(r.f)(ct,"class","svelte-rtgo25"),Object(r.f)(dt,"href",pt=t[13]()),Object(r.f)(dt,"download","parsed-subtitles.json"),Object(r.f)(dt,"class","svelte-rtgo25"),Object(r.f)(bt,"class","row svelte-rtgo25"),Object(r.f)(Ot,"class","row svelte-rtgo25"),Object(r.f)(U,"class","tab tab-debug svelte-rtgo25"),Object(r.X)(U,"tab-active","debug"===t[4])},m(o,a){Object(r.B)(o,e,a),Object(r.d)(e,n),Object(r.d)(n,s),Object(r.d)(e,c),Object(r.d)(e,i),Object(r.d)(i,l),Object(r.d)(e,u),Object(r.d)(e,b),Object(r.d)(b,d),Object(r.B)(o,p,a),Object(r.B)(o,j,a),Object(r.d)(j,O),Object(r.d)(j,g),Object(r.d)(j,h);for(let t=0;t<xt.length;t+=1)xt[t].m(h,null);Object(r.B)(o,v,a),Object(r.B)(o,y,a),Object(r.d)(y,S),Object(r.d)(y,k),Object(r.d)(y,C),Object(r.d)(C,P),Object(r.d)(C,E),Object(r.d)(C,N),Object(r.d)(y,A),Object(r.d)(y,B),Object(r.d)(B,M),Object(r.d)(B,_),Object(r.d)(B,G),Object(r.Q)(G,t[6]),Object(r.d)(y,R),Object(r.d)(y,F),Object(r.d)(F,D),D.checked=t[7],Object(r.d)(F,V),Object(r.d)(F,T),Object(r.d)(y,I),Object(r.d)(y,Y),Object(r.d)(Y,H),H.checked=t[8],Object(r.d)(Y,z),Object(r.d)(Y,Z),Object(r.d)(y,W),Object(r.d)(y,q),Object(r.d)(q,L),L.checked=t[9],Object(r.d)(q,K),Object(r.d)(q,J),Object(r.B)(o,X,a),Object(r.B)(o,U,a),Object(r.d)(U,Q),Object(r.d)(U,tt),Object(r.d)(U,et),Object(r.d)(et,nt),Object(r.d)(et,rt),Object(r.d)(rt,st),Object(r.d)(et,ot),Object(r.d)(et,ct),Object(r.d)(ct,it),Object(r.d)(ct,lt),Object(r.d)(ct,at);for(let t=0;t<Ct.length;t+=1)Ct[t].m(et,null);Object(r.d)(U,ut),Object(r.d)(U,bt),Object(r.d)(bt,dt),Object(r.d)(dt,ft),Object(r.d)(U,jt),Object(r.d)(U,Ot),gt=!0,ht=[Object(r.D)(n,"click",t[21]),Object(r.D)(i,"click",t[22]),Object(r.D)(b,"click",t[23]),Object(r.D)(P,"click",t[25]),Object(r.D)(N,"click",t[26]),Object(r.D)(G,"input",t[27]),Object(r.D)(D,"change",t[28]),Object(r.D)(H,"change",t[29]),Object(r.D)(L,"change",t[30])]},p(t,e){if((!gt||16&e[0]&&o!==(o="recent"===t[4]))&&(n.disabled=o),(!gt||16&e[0]&&a!==(a="settings"===t[4]))&&(i.disabled=a),(!gt||16&e[0]&&f!==(f="debug"===t[4]))&&(b.disabled=f),5121&e[0]){const n=t[0];Object(r.y)();for(let t=0;t<xt.length;t+=1)xt[t].r();xt=Object(r.ab)(xt,e,St,1,t,n,mt,h,r.u,$,null,m);for(let t=0;t<xt.length;t+=1)xt[t].a();Object(r.h)()}if(16&e[0]&&Object(r.X)(j,"tab-active","recent"===t[4]),64&e[0]&&Object(r.Q)(G,t[6]),128&e[0]&&(D.checked=t[7]),256&e[0]&&(H.checked=t[8]),512&e[0]&&(L.checked=t[9]),16&e[0]&&Object(r.X)(y,"tab-active","settings"===t[4]),(!gt||2&e[0])&&vt!==(vt=t[1].fileName+"")&&Object(r.P)(st,vt),(!gt||4&e[0])&&yt!==(yt=t[2]>0?"+":"")&&Object(r.P)(it,yt),(!gt||4&e[0])&&$t!==($t=(t[2]/1e3).toFixed(1)+"")&&Object(r.P)(lt,$t),2&e[0]){let n;for(kt=t[1].debugInfo(),n=0;n<kt.length;n+=1){const r=x(t,kt,n);Ct[n]?Ct[n].p(r,e):(Ct[n]=w(r),Ct[n].c(),Ct[n].m(et,null))}for(;n<Ct.length;n+=1)Ct[n].d(1);Ct.length=kt.length}16&e[0]&&Object(r.X)(U,"tab-active","debug"===t[4])},i(t){if(!gt){for(let t=0;t<wt.length;t+=1)Object(r.Y)(xt[t]);gt=!0}},o(t){for(let t=0;t<xt.length;t+=1)Object(r.Z)(xt[t]);gt=!1},d(t){t&&Object(r.r)(e),t&&Object(r.r)(p),t&&Object(r.r)(j);for(let t=0;t<xt.length;t+=1)xt[t].d();t&&Object(r.r)(v),t&&Object(r.r)(y),t&&Object(r.r)(X),t&&Object(r.r)(U),Object(r.q)(Ct,t),Object(r.N)(ht)}}}function y(t){let e,n,s,o,c,i;return{c(){e=Object(r.s)("div"),n=Object(r.s)("div"),s=Object(r.s)("button"),s.textContent="Select Subtitles",o=Object(r.S)(),c=Object(r.s)("div"),c.innerHTML='<a target="_blank" href="https://github.com/sheodox/jimaku-player/issues" rel="noopener noreferrer" class="svelte-rtgo25">Issue? Report it here!</a>',Object(r.f)(n,"class","row svelte-rtgo25"),Object(r.f)(c,"class","row svelte-rtgo25"),Object(r.f)(e,"class","tab tab-active tab-cancelled svelte-rtgo25")},m(l,a){Object(r.B)(l,e,a),Object(r.d)(e,n),Object(r.d)(n,s),Object(r.d)(e,o),Object(r.d)(e,c),i=Object(r.D)(s,"click",t[20])},p:r.G,i:r.G,o:r.G,d(t){t&&Object(r.r)(e),i()}}}function $(t,e){let n,s,o,c,i,l,a,u,b,d,f,j=e[34].text+"",g=r.G;return{key:t,first:null,c(){n=Object(r.s)("li"),s=Object(r.s)("a"),o=Object(r.V)(j),i=Object(r.S)(),Object(r.f)(s,"target","_blank"),Object(r.f)(s,"href",c=`https://jisho.org/search/${encodeURIComponent(e[34].text.trim())}`),Object(r.f)(s,"rel","noopener noreferrer"),Object(r.f)(s,"class","svelte-rtgo25"),Object(r.f)(n,"style",l=e[12](e[36])),Object(r.f)(n,"class","svelte-rtgo25"),this.first=n},m(t,c){Object(r.B)(t,n,c),Object(r.d)(n,s),Object(r.d)(s,o),Object(r.d)(n,i),d=!0,f=Object(r.D)(s,"click",e[24])},p(t,e){(!d||1&e[0])&&j!==(j=t[34].text+"")&&Object(r.P)(o,j),(!d||1&e[0]&&c!==(c=`https://jisho.org/search/${encodeURIComponent(t[34].text.trim())}`))&&Object(r.f)(s,"href",c),(!d||1&e[0]&&l!==(l=t[12](t[36])))&&Object(r.f)(n,"style",l)},r(){b=n.getBoundingClientRect()},f(){Object(r.v)(n),g(),Object(r.c)(n,b)},a(){g(),g=Object(r.k)(n,b,O,{duration:200})},i(t){d||(Object(r.b)(()=>{u&&u.end(1),a||(a=Object(r.n)(n,p.b,{y:-50,duration:200})),a.start()}),d=!0)},o(t){a&&a.invalidate(),u=Object(r.o)(n,p.b,{y:50,duration:200}),d=!1},d(t){t&&Object(r.r)(n),t&&u&&u.end(),f()}}}function w(t){let e,n,s,o,c=t[31].title+"",i=t[31].detail+"";return{c(){e=Object(r.s)("dt"),n=Object(r.V)(c),s=Object(r.s)("dd"),o=Object(r.V)(i),Object(r.f)(e,"class","svelte-rtgo25"),Object(r.f)(s,"class","svelte-rtgo25")},m(t,c){Object(r.B)(t,e,c),Object(r.d)(e,n),Object(r.B)(t,s,c),Object(r.d)(s,o)},p(t,e){2&e[0]&&c!==(c=t[31].title+"")&&Object(r.P)(n,c),2&e[0]&&i!==(i=t[31].detail+"")&&Object(r.P)(o,i)},d(t){t&&Object(r.r)(e),t&&Object(r.r)(s)}}}function S(t){let e,n,s,o,c,i,l;const a=[y,v],u=[];function b(t,e){return"cancelled"===t[3]?0:"normal"===t[3]?1:-1}return~(o=b(t))&&(c=u[o]=a[o](t)),{c(){e=Object(r.s)("div"),n=Object(r.s)("h1"),n.textContent="字幕プレーヤー",s=Object(r.S)(),c&&c.c(),Object(r.f)(n,"class","svelte-rtgo25"),Object(r.f)(e,"class","tray svelte-rtgo25"),Object(r.R)(e,"right",t[5]+"rem")},m(c,a){Object(r.B)(c,e,a),Object(r.d)(e,n),Object(r.d)(e,s),~o&&u[o].m(e,null),i=!0,l=[Object(r.D)(e,"mouseenter",t[14](!0)),Object(r.D)(e,"mouseleave",t[14](!1))]},p(t,n){let s=o;o=b(t),o===s?~o&&u[o].p(t,n):(c&&(Object(r.y)(),Object(r.Z)(u[s],1,1,()=>{u[s]=null}),Object(r.h)()),~o?(c=u[o],c||(c=u[o]=a[o](t),c.c()),Object(r.Y)(c,1),c.m(e,null)):c=null),(!i||32&n[0])&&Object(r.R)(e,"right",t[5]+"rem")},i(t){i||(Object(r.Y)(c),i=!0)},o(t){Object(r.Z)(c),i=!1},d(t){t&&Object(r.r)(e),~o&&u[o].d(),Object(r.N)(l)}}}function k(t,e,n){let o,i,l,a,p;Object(r.i)(t,u,t=>n(6,i=t)),Object(r.i)(t,b,t=>n(7,l=t)),Object(r.i)(t,d,t=>n(8,a=t)),Object(r.i)(t,f,t=>n(9,p=t));const O=Object(s.a)(),g={hidden:-26,shown:0},x=function(t,e={}){const n=c(t);let s,o=t;function i(c,i){if(null==t)return n.set(t=c),Promise.resolve();o=c;let l=s,a=!1,{delay:u=0,duration:b=400,easing:d=j.c,interpolate:f=h}=Object(r.e)(Object(r.e)({},e),i);const p=Object(r.H)()+u;let O;return s=Object(r.E)(e=>{if(e<p)return!0;a||(O=f(t,c),"function"==typeof b&&(b=b(t,c)),a=!0),l&&(l.abort(),l=null);const r=e-p;return r>b?(n.set(t=c),!1):(n.set(t=O(d(r/b))),!0)}),s.promise}return{set:i,update:(e,n)=>i(e(o,t),n),subscribe:n.subscribe}}(g.hidden,{duration:300,easing:j.b});Object(r.i)(t,x,t=>n(5,o=t));let{recentSubs:m=[]}=e,{subtitles:v={}}=e,{alignment:y=0}=e,{mode:$="normal"}=e;let w="recent";return t.$set=t=>{"recentSubs"in t&&n(0,m=t.recentSubs),"subtitles"in t&&n(1,v=t.subtitles),"alignment"in t&&n(2,y=t.alignment),"mode"in t&&n(3,$=t.mode)},[m,v,y,$,w,o,i,l,a,p,O,x,function(t){return`font-size: ${20*(.5+(t+1)/m.length*.5)}px`},function(){const t=new Blob([v.serialize()],{type:"application/json"});return URL.createObjectURL(t)},function(t){return()=>{x.set(t?g.shown:g.hidden),t&&!Object(r.w)(d)||O("tray-pauser",t)}},g,!1,!0,!0,function(t){return e=>{O(t,e.target.checked)}},()=>O("restart"),()=>n(4,w="recent"),()=>n(4,w="settings"),()=>n(4,w="debug"),()=>O("define-pauser"),()=>O("restart"),()=>O("realign"),function(){i=this.value,u.set(i)},function(){l=this.checked,b.set(l)},function(){a=this.checked,d.set(a)},function(){p=this.checked,f.set(p)}]}class C extends r.a{constructor(t){var e;super(),document.getElementById("svelte-rtgo25-style")||((e=Object(r.s)("style")).id="svelte-rtgo25-style",e.textContent='.tray.svelte-rtgo25.svelte-rtgo25{width:28rem;margin-top:0.5rem;background:rgba(255, 255, 255, 0.2);position:fixed;right:0;top:0;color:white;height:calc(100% - 5rem);display:flex;flex-direction:column}.tray.svelte-rtgo25>.svelte-rtgo25{visibility:hidden}.tray.svelte-rtgo25.svelte-rtgo25:hover{background:#111218;overflow:auto;border-radius:3px}.tray.svelte-rtgo25:hover>.svelte-rtgo25{visibility:visible}.tray.svelte-rtgo25 h1.svelte-rtgo25{font-size:2rem;padding:0.5rem 0;border-radius:3px;margin:0}.tray.svelte-rtgo25 h2.svelte-rtgo25{text-decoration:underline;margin:0 0 0.4rem}ul.svelte-rtgo25.svelte-rtgo25{list-style:none;padding:0;display:flex;flex-direction:column-reverse}a.svelte-rtgo25.svelte-rtgo25{color:white;transform:scaleY(0);transform-origin:top;transition:transform 0.5s ease;font-family:"Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif}.tab-recent.svelte-rtgo25 a.svelte-rtgo25:not(:hover){text-decoration:none}a.svelte-rtgo25.svelte-rtgo25:hover{color:#0aff8c;cursor:pointer;text-decoration:underline}li.svelte-rtgo25.svelte-rtgo25{padding-bottom:0.2rem;white-space:pre}li.svelte-rtgo25.svelte-rtgo25:not(:first-of-type)::after{content:\' \';height:0;position:relative;border:1px solid #4a4a6a;display:block;margin:0 auto;border-radius:4px}dt.svelte-rtgo25.svelte-rtgo25{font-weight:bold}dd.svelte-rtgo25.svelte-rtgo25{font-style:italic}.tab.svelte-rtgo25.svelte-rtgo25{display:none;text-align:left;padding:2rem;background:#1c1825;border-top:2px solid #f47521}.tab-active.svelte-rtgo25.svelte-rtgo25{display:block;flex:1}.tray-tab-buttons.svelte-rtgo25.svelte-rtgo25{margin:0.2rem}.row.svelte-rtgo25.svelte-rtgo25:not(:last-child){margin-bottom:0.5rem}.tab-cancelled.svelte-rtgo25.svelte-rtgo25{text-align:center}',Object(r.d)(document.head,e)),Object(r.A)(this,t,k,S,r.O,{recentSubs:0,subtitles:1,alignment:2,mode:3},[-1,-1])}}var P=C;function E(t,e,n){const r=t.slice();return r[14]=e[n],r}function N(t,e,n){const r=t.slice();return r[11]=e[n],r}function A(t){let e,n,s=t[0],o=[];for(let e=0;e<s.length;e+=1)o[e]=G(N(t,s,e));const c=t=>Object(r.Z)(o[t],1,1,()=>{o[t]=null});return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=Object(r.t)()},m(t,s){for(let e=0;e<o.length;e+=1)o[e].m(t,s);Object(r.B)(t,e,s),n=!0},p(t,n){if(13&n){let i;for(s=t[0],i=0;i<s.length;i+=1){const c=N(t,s,i);o[i]?(o[i].p(c,n),Object(r.Y)(o[i],1)):(o[i]=G(c),o[i].c(),Object(r.Y)(o[i],1),o[i].m(e.parentNode,e))}for(Object(r.y)(),i=s.length;i<o.length;i+=1)c(i);Object(r.h)()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)Object(r.Y)(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)Object(r.Z)(o[t]);n=!1},d(t){Object(r.q)(o,t),t&&Object(r.r)(e)}}}function B(t){let e,n=t[11].text+"";return{c(){e=Object(r.V)(n)},m(t,n){Object(r.B)(t,e,n)},p(t,s){1&s&&n!==(n=t[11].text+"")&&Object(r.P)(e,n)},i:r.G,o:r.G,d(t){t&&Object(r.r)(e)}}}function M(t){let e,n,s=t[11].phrases,o=[];for(let e=0;e<s.length;e+=1)o[e]=_(E(t,s,e));const c=t=>Object(r.Z)(o[t],1,1,()=>{o[t]=null});return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=Object(r.t)()},m(t,s){for(let e=0;e<o.length;e+=1)o[e].m(t,s);Object(r.B)(t,e,s),n=!0},p(t,n){if(1&n){let i;for(s=t[11].phrases,i=0;i<s.length;i+=1){const c=E(t,s,i);o[i]?(o[i].p(c,n),Object(r.Y)(o[i],1)):(o[i]=_(c),o[i].c(),Object(r.Y)(o[i],1),o[i].m(e.parentNode,e))}for(Object(r.y)(),i=s.length;i<o.length;i+=1)c(i);Object(r.h)()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)Object(r.Y)(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)Object(r.Z)(o[t]);n=!1},d(t){Object(r.q)(o,t),t&&Object(r.r)(e)}}}function _(t){let e,n,s,o,c,i,l=t[14].text+"";return{c(){e=Object(r.s)("span"),n=Object(r.V)(l),Object(r.f)(e,"style",s=V(t[14]))},m(t,s){Object(r.B)(t,e,s),Object(r.d)(e,n),i=!0},p(t,o){(!i||1&o)&&l!==(l=t[14].text+"")&&Object(r.P)(n,l),(!i||1&o&&s!==(s=V(t[14])))&&Object(r.f)(e,"style",s)},i(n){i||(Object(r.b)(()=>{c&&c.end(1),o||(o=Object(r.n)(e,p.a,{duration:t[14].fadeIn||0})),o.start()}),i=!0)},o(n){o&&o.invalidate(),c=Object(r.o)(e,p.a,{duration:t[14].fadeOut||0}),i=!1},d(t){t&&Object(r.r)(e),t&&c&&c.end()}}}function G(t){let e,n,s,o,c,i,l,a;const u=[M,B],b=[];function d(t,e){return t[11].phrases?0:1}function f(...e){return t[10](t[11],...e)}return n=d(t),s=b[n]=u[n](t),{c(){e=Object(r.s)("p"),s.c(),o=Object(r.S)(),Object(r.f)(e,"style",c=t[3](t[11])),Object(r.f)(e,"data-sub-style",i=t[11].style),Object(r.f)(e,"title","click to search this phrase on Jisho.org"),Object(r.f)(e,"class","svelte-ko7cxi")},m(t,s){Object(r.B)(t,e,s),b[n].m(e,null),Object(r.d)(e,o),l=!0,a=Object(r.D)(e,"click",f)},p(a,f){let p=n;n=d(t=a),n===p?b[n].p(t,f):(Object(r.y)(),Object(r.Z)(b[p],1,1,()=>{b[p]=null}),Object(r.h)(),s=b[n],s||(s=b[n]=u[n](t),s.c()),Object(r.Y)(s,1),s.m(e,o)),(!l||1&f&&c!==(c=t[3](t[11])))&&Object(r.f)(e,"style",c),(!l||1&f&&i!==(i=t[11].style))&&Object(r.f)(e,"data-sub-style",i)},i(t){l||(Object(r.Y)(s),l=!0)},o(t){Object(r.Z)(s),l=!1},d(t){t&&Object(r.r)(e),b[n].d(),a()}}}function R(t){let e,n,s=t[1]&&A(t);return{c(){e=Object(r.s)("div"),s&&s.c(),Object(r.f)(e,"class","subtitles")},m(t,o){Object(r.B)(t,e,o),s&&s.m(e,null),n=!0},p(t,[n]){t[1]?s?(s.p(t,n),Object(r.Y)(s,1)):(s=A(t),s.c(),Object(r.Y)(s,1),s.m(e,null)):s&&(Object(r.y)(),Object(r.Z)(s,1,1,()=>{s=null}),Object(r.h)())},i(t){n||(Object(r.Y)(s),n=!0)},o(t){Object(r.Z)(s),n=!1},d(t){t&&Object(r.r)(e),s&&s.d()}}}function F(t){return t.fontScaled?`font-size: ${window.innerHeight>t.fontScalingThreshold?t.fontMax:t.fontScaled}`:""}function D(t){return t.filter(t=>!!t).join(";")}function V(t){return D([t.inline,F(t)])}function T(t,e,n){let o;Object(r.i)(t,b,t=>n(1,o=t));let{current:c=[]}=e,{styles:i={}}=e,{format:l=""}=e;const a=Object(s.a)();let d,p;const j=[u.subscribe(t=>{d=t}),f.subscribe(t=>{p=t?"inverted":"normal"})];function O(t){a("define-pauser"),window.open(`https://jisho.org/search/${encodeURIComponent(t.trim())}`)}Object(s.b)(()=>{j.forEach(t=>t())});return t.$set=t=>{"current"in t&&n(0,c=t.current),"styles"in t&&n(4,i=t.styles),"format"in t&&n(5,l=t.format)},[c,o,O,function(t){let e=[`color: ${d}`];return"ass"===l&&t.style in i&&(e.push(i[t.style].inline),e.push(F(i[t.style]))),t.verticalAlignment&&e.push(t.verticalAlignment[p]),e=e.concat([t.inline||"",F(t)]),D(e)},i,l,d,p,a,j,t=>O(t.text)]}class I extends r.a{constructor(t){var e;super(),document.getElementById("svelte-ko7cxi-style")||((e=Object(r.s)("style")).id="svelte-ko7cxi-style",e.textContent='p.svelte-ko7cxi{cursor:pointer;color:white;margin:0;padding:0;white-space:pre;font-family:"Source Han Sans", "源ノ角ゴシック", "Hiragino Sans", "HiraKakuProN-W3", "Hiragino Kaku Gothic ProN W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "Noto Sans", "Noto Sans CJK JP", "メイリオ", Meiryo, "游ゴシック", YuGothic, "ＭＳ Ｐゴシック", "MS PGothic", "ＭＳ ゴシック", "MS Gothic", sans-serif}p.svelte-ko7cxi:hover{color:#0aff8c !important}',Object(r.d)(document.head,e)),Object(r.A)(this,t,T,R,r.O,{current:0,styles:4,format:5})}}var Y=I;class H{constructor(){this.video=null,this.reasons=[]}setVideo(t){this.reasons=[],this.video=t}addPauser(t){this.reasons.includes("user-paused")&&!this.video.paused&&this.reasons.splice(this.reasons.indexOf("user-paused")),0===this.reasons.length&&this.video.paused&&this.reasons.push("user-paused"),this.reasons.push(t),this._checkPause()}removePauser(t){const e=this.reasons.indexOf(t);-1!==e&&(this.reasons.splice(e,1),this._checkPause())}_checkPause(){this.reasons.length?this.video.pause():this.video.play()}}var z=n(8),Z=n.n(z),W=n(7),q=n.n(W);const L={"line-left":"0%",center:"-50%","line-right":"-100%"};class K extends q.a{constructor(t,e){super("srt",e);const n=t.replace(/\r/g,"").split("\n\n");this.subs=n.reduce((t,e)=>{let n=e.trim().split("\n");function r(){n.shift()}try{/^\d*$/.test(n[0])&&r();let[e,s]=n[0].replace(/,/g,".").match(/^([\d:\.\-> ]*)/)[0].split(/\-\->/),o=n[0].match(/([a-zA-Z].*)/);o=o&&o.length?o[1]:"";let c=[],i=[];const l=n.length-1,a=(t,e)=>{const n=o.match(new RegExp(`${t}:([\\d\\.]*)%`));return n?parseInt(n[1],10):e},u=t=>{const e=o.match(new RegExp(`${t}:([w-]*?)`));if(e)return e[1]},b=()=>{const t=o.match(/position:([\d.]*)%(?:,(\w*))?/);return t?{position:parseInt(t[1]),positionAlignment:"middle"===t[2]?"center":t[2]}:{position:50,positionAlignment:"center"}},d=5;let{position:f,positionAlignment:p="center"}=b(),j=(u("align"),a("line",90-l*d)),O=a("size",100);i.push(`position: fixed; left: ${f}vw`),p&&p in L&&c.push(`transform: translateX(${L[p]})`),c.push(`display:block; width: ${O}vw`),r();const g=n.join("\n").replace(/<\/?c.Japanese>/g,"");c.push(`font-size: ${d}vh`),c.push("text-shadow: -4px -4px 0px rgba(9, 9, 9, 255), -4px -3px 0px rgba(9, 9, 9, 255), -4px -2px 0px rgba(9, 9, 9, 255), -4px -1px 0px rgba(9, 9, 9, 255), -4px 0px 0px rgba(9, 9, 9, 255), -4px 1px 0px rgba(9, 9, 9, 255), -4px 2px 0px rgba(9, 9, 9, 255), -4px 3px 0px rgba(9, 9, 9, 255), -4px 4px 0px rgba(9, 9, 9, 255), -3px -4px 0px rgba(9, 9, 9, 255), -3px -3px 0px rgba(9, 9, 9, 255), -3px -2px 0px rgba(9, 9, 9, 255), -3px -1px 0px rgba(9, 9, 9, 255), -3px 0px 0px rgba(9, 9, 9, 255), -3px 1px 0px rgba(9, 9, 9, 255), -3px 2px 0px rgba(9, 9, 9, 255), -3px 3px 0px rgba(9, 9, 9, 255), -3px 4px 0px rgba(9, 9, 9, 255), -2px -4px 0px rgba(9, 9, 9, 255), -2px -3px 0px rgba(9, 9, 9, 255), -2px -2px 0px rgba(9, 9, 9, 255), -2px -1px 0px rgba(9, 9, 9, 255), -2px 0px 0px rgba(9, 9, 9, 255), -2px 1px 0px rgba(9, 9, 9, 255), -2px 2px 0px rgba(9, 9, 9, 255), -2px 3px 0px rgba(9, 9, 9, 255), -2px 4px 0px rgba(9, 9, 9, 255), -1px -4px 0px rgba(9, 9, 9, 255), -1px -3px 0px rgba(9, 9, 9, 255), -1px -2px 0px rgba(9, 9, 9, 255), -1px -1px 0px rgba(9, 9, 9, 255), -1px 0px 0px rgba(9, 9, 9, 255), -1px 1px 0px rgba(9, 9, 9, 255), -1px 2px 0px rgba(9, 9, 9, 255), -1px 3px 0px rgba(9, 9, 9, 255), -1px 4px 0px rgba(9, 9, 9, 255), 0px -4px 0px rgba(9, 9, 9, 255), 0px -3px 0px rgba(9, 9, 9, 255), 0px -2px 0px rgba(9, 9, 9, 255), 0px -1px 0px rgba(9, 9, 9, 255), 0px 0px 0px rgba(9, 9, 9, 255), 0px 1px 0px rgba(9, 9, 9, 255), 0px 2px 0px rgba(9, 9, 9, 255), 0px 3px 0px rgba(9, 9, 9, 255), 0px 4px 0px rgba(9, 9, 9, 255), 1px -4px 0px rgba(9, 9, 9, 255), 1px -3px 0px rgba(9, 9, 9, 255), 1px -2px 0px rgba(9, 9, 9, 255), 1px -1px 0px rgba(9, 9, 9, 255), 1px 0px 0px rgba(9, 9, 9, 255), 1px 1px 0px rgba(9, 9, 9, 255), 1px 2px 0px rgba(9, 9, 9, 255), 1px 3px 0px rgba(9, 9, 9, 255), 1px 4px 0px rgba(9, 9, 9, 255), 2px -4px 0px rgba(9, 9, 9, 255), 2px -3px 0px rgba(9, 9, 9, 255), 2px -2px 0px rgba(9, 9, 9, 255), 2px -1px 0px rgba(9, 9, 9, 255), 2px 0px 0px rgba(9, 9, 9, 255), 2px 1px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(9, 9, 9, 255), 2px 3px 0px rgba(9, 9, 9, 255), 2px 4px 0px rgba(9, 9, 9, 255), 3px -4px 0px rgba(9, 9, 9, 255), 3px -3px 0px rgba(9, 9, 9, 255), 3px -2px 0px rgba(9, 9, 9, 255), 3px -1px 0px rgba(9, 9, 9, 255), 3px 0px 0px rgba(9, 9, 9, 255), 3px 1px 0px rgba(9, 9, 9, 255), 3px 2px 0px rgba(9, 9, 9, 255), 3px 3px 0px rgba(9, 9, 9, 255), 3px 4px 0px rgba(9, 9, 9, 255), 4px -4px 0px rgba(9, 9, 9, 255), 4px -3px 0px rgba(9, 9, 9, 255), 4px -2px 0px rgba(9, 9, 9, 255), 4px -1px 0px rgba(9, 9, 9, 255), 4px 0px 0px rgba(9, 9, 9, 255), 4px 1px 0px rgba(9, 9, 9, 255), 4px 2px 0px rgba(9, 9, 9, 255), 4px 3px 0px rgba(9, 9, 9, 255), 4px 4px 0px rgba(9, 9, 9, 255), 2px 2px 0px rgba(20, 20, 20, 195)"),t.push({start:this.timeToMs(e),end:this.timeToMs(s),verticalAlignment:{normal:`position: fixed; top: ${j}vh;`,inverted:`position: fixed; top: ${100-j}vh; transform: translateY(-100%)`},text:g,inline:i.join("; "),phrases:[{text:g,inline:c.join("; ")}]})}catch(t){}return t},[])}serialize(){return JSON.stringify(this.subs,null,4)}debugInfo(){return[{title:"Number of subtitles",detail:this.subs.length}]}}function J(t){let e,n,s,o,c,i,l;return{c(){e=Object(r.s)("div"),n=Object(r.s)("button"),n.textContent="⨯ Skip Subtitling For This Episode",s=Object(r.S)(),o=Object(r.s)("label"),o.textContent="≡ Select a subtitle file to begin",c=Object(r.S)(),i=Object(r.s)("input"),Object(r.f)(n,"class","small-button svelte-1n5tabm"),Object(r.f)(o,"for","srt-upload"),Object(r.f)(o,"class","svelte-1n5tabm"),Object(r.f)(i,"type","file"),Object(r.f)(i,"id","srt-upload"),Object(r.f)(i,"accept",".srt,.ass,.ssa,.vtt"),Object(r.f)(i,"class","svelte-1n5tabm"),Object(r.f)(e,"class","column svelte-1n5tabm")},m(a,u){Object(r.B)(a,e,u),Object(r.d)(e,n),Object(r.d)(e,s),Object(r.d)(e,o),Object(r.d)(e,c),Object(r.d)(e,i),l=[Object(r.D)(n,"click",t[1]),Object(r.D)(i,"change",t[0])]},p:r.G,i:r.G,o:r.G,d(t){t&&Object(r.r)(e),Object(r.N)(l)}}}function X(t){const e=Object(s.a)();return[function(t){const n=t.target.files[0],r=new FileReader;r.onload=t=>{const r={ass:Z.a,ssa:Z.a,srt:K,vtt:K},[s,o]=n.name.match(/\.(\w{3})$/);e("subtitles-loaded",new r[o](t.target.result,n.name))},r.readAsText(n)},function(){e("cancel")}]}class U extends r.a{constructor(t){var e;super(),document.getElementById("svelte-1n5tabm-style")||((e=Object(r.s)("style")).id="svelte-1n5tabm-style",e.textContent=".column.svelte-1n5tabm.svelte-1n5tabm{display:flex;flex-direction:column}.column.svelte-1n5tabm>.svelte-1n5tabm{align-self:center;margin:0.5rem}label.svelte-1n5tabm.svelte-1n5tabm{background:#fd0;border:none;cursor:pointer;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;display:inline-block;font-size:1.2rem}label.svelte-1n5tabm.svelte-1n5tabm:hover{background:#ffea6d}input.svelte-1n5tabm.svelte-1n5tabm{display:none}",Object(r.d)(document.head,e)),Object(r.A)(this,t,X,J,r.O,{})}}var Q=U;const{document:tt}=r.x;function et(t){let e,n,s,o,c,i,l,a,u,b,d,f,p,j,O,g,h="number"==typeof t[3]&&!isNaN(t[3]),x=t[0].text+"",m=h&&function(t){let e,n,s,o,c,i,l,a=t[4]()+"";return{c(){e=Object(r.s)("button"),n=Object(r.V)("Use the last alignment for "),s=Object(r.s)("span"),s.textContent=`${t[2]}`,o=Object(r.V)(" ("),c=Object(r.V)(a),i=Object(r.V)(")"),Object(r.f)(s,"class","show-name svelte-n31nxo"),Object(r.f)(e,"class","svelte-n31nxo")},m(a,u){Object(r.B)(a,e,u),Object(r.d)(e,n),Object(r.d)(e,s),Object(r.d)(e,o),Object(r.d)(e,c),Object(r.d)(e,i),l=Object(r.D)(e,"click",t[5])},p:r.G,d(t){t&&Object(r.r)(e),l()}}}(t);return{c(){e=Object(r.s)("div"),n=Object(r.s)("button"),n.textContent="↺ Reselect Subtitles",s=Object(r.S)(),o=Object(r.s)("div"),m&&m.c(),c=Object(r.S)(),i=Object(r.s)("button"),i.innerHTML="No alignment adjustment<br>(use when you know the subtitles are timed properly)",l=Object(r.S)(),a=Object(r.s)("button"),a.textContent="Enter alignment manually",u=Object(r.S)(),b=Object(r.s)("button"),d=Object(r.V)("⇌ Click when the first line is said:\n\t\t"),f=Object(r.s)("br"),p=Object(r.S)(),j=Object(r.s)("pre"),O=Object(r.V)(x),Object(r.f)(n,"class","small-button svelte-n31nxo"),Object(r.f)(i,"class","svelte-n31nxo"),Object(r.f)(a,"class","svelte-n31nxo"),Object(r.f)(o,"class","row svelte-n31nxo"),Object(r.f)(b,"class","svelte-n31nxo"),Object(r.f)(e,"class","alignment-buttons svelte-n31nxo")},m(h,x){Object(r.B)(h,e,x),Object(r.d)(e,n),Object(r.d)(e,s),Object(r.d)(e,o),m&&m.m(o,null),Object(r.d)(o,c),Object(r.d)(o,i),Object(r.d)(o,l),Object(r.d)(o,a),Object(r.d)(e,u),Object(r.d)(e,b),Object(r.d)(b,d),Object(r.d)(b,f),Object(r.d)(b,p),Object(r.d)(b,j),Object(r.d)(j,O),g=[Object(r.D)(n,"click",t[11]),Object(r.D)(i,"click",t[12]),Object(r.D)(a,"click",t[6]),Object(r.D)(b,"click",t[7])]},p(t,[e]){h&&m.p(t,e),1&e&&x!==(x=t[0].text+"")&&Object(r.P)(O,x)},i:r.G,o:r.G,d(t){t&&Object(r.r)(e),m&&m.d(),Object(r.N)(g)}}}function nt(t,e,n){let{firstSubtitle:r={}}=e;const o=Object(s.a)(),c=document.querySelector(".video-title"),i=c?c.textContent:"",l=`last-used-alignment-${i}`,a=parseInt(GM_getValue(l),10),u=(a/1e3).toFixed(1);function b(t){const e=document.querySelector("video"),n="number"==typeof t?t:1e3*e.currentTime-r.start-400;GM_setValue(l,n),o("set-align",n)}return t.$set=t=>{"firstSubtitle"in t&&n(0,r=t.firstSubtitle)},[r,o,i,a,function(){return 0===a?"no adjustment":a>0?`subtitles delayed by ${u} seconds`:`subtitles hastened by ${Math.abs(u)} seconds`},function(){b(a)},function(){const t=parseFloat(prompt("Enter an alignment in seconds. Positive numbers are for when the subtitles need to be delayed (subtitle file starts too soon). \nNegative numbers will play the subtitles earlier (subtitle file is too late).",u||""));isNaN(t)||b(1e3*t)},b,c,l,u,()=>o("reselect"),()=>b(0)]}class rt extends r.a{constructor(t){var e;super(),tt.getElementById("svelte-n31nxo-style")||((e=Object(r.s)("style")).id="svelte-n31nxo-style",e.textContent=".alignment-buttons.svelte-n31nxo.svelte-n31nxo{display:flex;flex-direction:column}.alignment-buttons.svelte-n31nxo button.svelte-n31nxo{margin:0.5rem;align-self:center}.row.svelte-n31nxo.svelte-n31nxo{display:flex;flex-direction:row;justify-content:center}.row.svelte-n31nxo button.svelte-n31nxo{max-width:15rem}.show-name.svelte-n31nxo.svelte-n31nxo{font-style:italic}",Object(r.d)(tt.head,e)),Object(r.A)(this,t,nt,et,r.O,{firstSubtitle:0})}}var st=rt;const{document:ot}=r.x;function ct(t){let e;const n=new P({props:{mode:"cancelled"}});return n.$on("restart",t[6]),{c(){Object(r.m)(n.$$.fragment)},m(t,s){Object(r.F)(n,t,s),e=!0},p:r.G,i(t){e||(Object(r.Y)(n.$$.fragment,t),e=!0)},o(t){Object(r.Z)(n.$$.fragment,t),e=!1},d(t){Object(r.p)(n,t)}}}function it(t){let e,n;const s=new Y({props:{format:t[2].format,styles:t[2].styles,current:t[1],currentTime:t[5]}});s.$on("define-pauser",t[10]);const o=new P({props:{recentSubs:t[4],subtitles:t[2],alignment:t[3]}});return o.$on("restart",t[6]),o.$on("tray-pauser",t[9]),o.$on("define-pauser",t[10]),o.$on("realign",t[18]),{c(){Object(r.m)(s.$$.fragment),e=Object(r.S)(),Object(r.m)(o.$$.fragment)},m(t,c){Object(r.F)(s,t,c),Object(r.B)(t,e,c),Object(r.F)(o,t,c),n=!0},p(t,e){const n={};4&e&&(n.format=t[2].format),4&e&&(n.styles=t[2].styles),2&e&&(n.current=t[1]),s.$set(n);const r={};16&e&&(r.recentSubs=t[4]),4&e&&(r.subtitles=t[2]),8&e&&(r.alignment=t[3]),o.$set(r)},i(t){n||(Object(r.Y)(s.$$.fragment,t),Object(r.Y)(o.$$.fragment,t),n=!0)},o(t){Object(r.Z)(s.$$.fragment,t),Object(r.Z)(o.$$.fragment,t),n=!1},d(t){Object(r.p)(s,t),t&&Object(r.r)(e),Object(r.p)(o,t)}}}function lt(t){let e;const n=new st({props:{firstSubtitle:t[2].firstSubtitle()}});return n.$on("set-align",t[7]),n.$on("reselect",t[17]),{c(){Object(r.m)(n.$$.fragment)},m(t,s){Object(r.F)(n,t,s),e=!0},p(t,e){const r={};4&e&&(r.firstSubtitle=t[2].firstSubtitle()),n.$set(r)},i(t){e||(Object(r.Y)(n.$$.fragment,t),e=!0)},o(t){Object(r.Z)(n.$$.fragment,t),e=!1},d(t){Object(r.p)(n,t)}}}function at(t){let e;const n=new Q({});return n.$on("subtitles-loaded",t[8]),n.$on("cancel",t[16]),{c(){Object(r.m)(n.$$.fragment)},m(t,s){Object(r.F)(n,t,s),e=!0},p:r.G,i(t){e||(Object(r.Y)(n.$$.fragment,t),e=!0)},o(t){Object(r.Z)(n.$$.fragment,t),e=!1},d(t){Object(r.p)(n,t)}}}function ut(t){let e,n,s,o;const c=[at,lt,it,ct],i=[];function l(t,e){return"prompt"===t[0]?0:"align"===t[0]?1:"play"===t[0]?2:"cancelled"===t[0]?3:-1}return~(n=l(t))&&(s=i[n]=c[n](t)),{c(){e=Object(r.s)("div"),s&&s.c(),Object(r.f)(e,"class","subtitles-app svelte-1noo31a")},m(t,s){Object(r.B)(t,e,s),~n&&i[n].m(e,null),o=!0},p(t,[o]){let a=n;n=l(t),n===a?~n&&i[n].p(t,o):(s&&(Object(r.y)(),Object(r.Z)(i[a],1,1,()=>{i[a]=null}),Object(r.h)()),~n?(s=i[n],s||(s=i[n]=c[n](t),s.c()),Object(r.Y)(s,1),s.m(e,null)):s=null)},i(t){o||(Object(r.Y)(s),o=!0)},o(t){Object(r.Z)(s),o=!1},d(t){t&&Object(r.r)(e),~n&&i[n].d()}}}function bt(t,e,n){const r=new H;let o="prompt",c=[],i=null,l=null,a=-1,u=[];function b(){n(0,o="prompt"),n(2,i=null),n(1,c=[])}function d(t){let e=t[t.length-1],r=u[u.length-1];!e||r&&e.text===r.text||n(4,u=[...u,e]),u.length>10&&n(4,u=u.slice(u.length-10))}function f(){"play"===o&&(n(1,c=i.getSubs(1e3*l.currentTime-a)),d(c),requestAnimationFrame(f))}Object(s.c)(()=>{document.addEventListener("visibilitychange",()=>{document.hidden||r.removePauser("define")});let t="";setInterval(()=>{const e=document.querySelector("video").getAttribute("src");e&&e!==t&&(t=e,b())},50)});return[o,c,i,a,u,"",b,function(t){l=document.querySelector("video"),r.setVideo(l),n(3,a=t.detail),n(4,u=[]),n(0,o="play"),f()},function(t){n(2,i=t.detail),0===i.subs.length?(console.log("subtitles object failed to parse: ",i),alert("No subtitles were able to be parsed from the selected subtitle file, verify nothing is wrong with the file. If it appears normal please submit a bug report with the episode and the subtitles file you used to the issue tracker (a link can be found in the tray on the right side of the video player)!"),n(0,o="cancelled")):n(0,o="align")},function(t){t.detail?r.addPauser("tray"):r.removePauser("tray")},function(){r.addPauser("define")},l,"last-used-alignment",r,d,f,()=>n(0,o="cancelled"),()=>n(0,o="prompt"),()=>n(0,o="align")]}class dt extends r.a{constructor(t){var e;super(),ot.getElementById("svelte-1noo31a-style")||((e=Object(r.s)("style")).id="svelte-1noo31a-style",e.textContent=".subtitles-app.svelte-1noo31a{position:relative}.subtitles-app.svelte-1noo31a>*{z-index:1000000000}.subtitles-app.svelte-1noo31a button{background:#fd0;border:none;padding:10px;line-height:1;font-weight:bold;color:black;text-transform:uppercase;font-size:0.9rem}.subtitles-app.svelte-1noo31a .small-button{font-size:0.6rem}.subtitles-app.svelte-1noo31a button:disabled{background:#2a3450}.subtitles-app.svelte-1noo31a button:not(:disabled):hover{background:#ffea6d;cursor:pointer}",Object(r.d)(ot.head,e)),Object(r.A)(this,t,bt,ut,r.O,{})}}var ft=dt;const pt=document.createElement("div");document.body.appendChild(pt),pt.id="sheodox-jimaku-player",pt.style.height="100%",pt.style.width="100%";new ft({target:pt})}]);
